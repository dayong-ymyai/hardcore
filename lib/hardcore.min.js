!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("hardcore",[],t):"object"==typeof exports?exports.hardcore=t():e.hardcore=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(o){if(a[o])return a[o].exports;var n=a[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,o){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=15)}([function(e,t,a){"use strict";var o=e.exports={checkPhone:function(){return!navigator||!!navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)},guid:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},getElementByAttr:function(e,t,a,o){for(var n=e.getElementsByTagName(t),r=[],i=0;i<n.length;i++)n[i].getAttribute(a)==o&&r.push(n[i]);return r},clear:function(e){e.ctx.clearRect(0,0,e.width,e.height)},nodeInfo:function(e){var t="Node "+e.key+": "+e.text+"\n";return e.group?t+="member of "+e.group:t+="top-level node",t},linkInfo:function(e){return"Link:\nfrom "+e.from+" to "+e.to},groupInfo:function(e){var t=e.adornedPart,a=t.memberParts.count,o=0;return t.memberParts.each(function(e){e instanceof go.Link&&o++}),"Group "+t.data.key+": "+t.data.text+"\n"+a+" members including "+o+" links"},queue:function(){this.data=[],this.enqueue=function(e){this.data.unshift(e)},this.dequeue=function(){this.data.pop()}},tdTravelTdpDataWidth:function(e,t,a,n){var r=new o.queue;console.log("queue:",r),r.enqueue(e);for(var i=null;!r.isEmpty();)if(i=r.dequeue(),a.push(n(i)),i.isparent){var d=t.findNodeDataForKey(i.isparent);if(d)for(r.enqueue(d);d.next&&d.next!=d.key&&(d=t.findNodeDataForKey(d.next));)r.enqueue(d)}},tdTravelTdpData:function(e,t,a,n){if(e){try{a.push(n(e))}catch(e){return void console.log(e)}if(e.isparent){var r=t.findNodeDataForKey(e.isparent);o.tdTravelTdpData(r,t,a,n)}if(e.next&&e.next!=e.key){var i=t.findNodeDataForKey(e.next);o.tdTravelTdpData(i,t,a,n)}}},deleteOldData:function(e){var t,a;for(var o in window.localStorage)if(window.localStorage.hasOwnProperty(o)&&o.startsWith("TDCurrent"))try{t=JSON.parse(window.localStorage.getItem(o)),a=(new Date).getTime()-t.modelData.updatedAt,a/1e3>86400*e&&(console.log("delete old data:"+o),window.localStorage.removeItem(o))}catch(e){console.error(e);continue}},saveModelToLocalStorage:function(e,t){if(console.log("存储model到localStorage，只保留最近三天的"),t.modelData.updatedAt=(new Date).getTime(),!window.localStorage)return void console.error("浏览器不支持localStorage");o.deleteOldData(3);try{window.localStorage.setItem("TDCurrent"+e,t.toJson())}catch(e){o.deleteOldData(1)}},checkModel:function(e){function t(t){return e.findNodeDataForKey(t)?"exist":"not exist"}var a=(e.nodeDataArray,e.findNodeDataForKey(1)),n=[];o.tdTravelTdpData(a,e,n,function(e){var a="check key:"+e.key+",level:"+e.level+",parent:"+e.parent+",isparent:"+e.isparent+",prev:"+e.prev+",next:"+e.next;e.next&&"not exist"==t(e.next)&&console.error("data "+e.key+" next指向的节点不存在, data: "+a),e.isparent&&"not exist"==t(e.isparent)&&console.error("data "+e.key+" isparent指向的节点不存在, data: "+a),e.parent&&"not exist"==t(e.parent)&&console.error("data "+e.key+" parent指向的节点不存在, data: "+a),e.prev&&"not exist"==t(e.prev)&&console.error("data "+e.key+" prev指向的节点不存在, data: "+a)})},tdTransToNum:function(e,t){arguments.length<=1&&(t=0);var a=t;try{return a=parseFloat(e)}catch(e){return a}},simulateEnterWithAlt:function(t){var a=t.diagram;if(a.currentTool.currentTextEditor){var o=function(e){var t=e;if(console.log("textblock catched the key:"+t),t.which&&(13==t.keyCode&&t.altKey||10==t.keyCode&&t.ctrlKey)){var o=this.selectionStart,n=this.selectionEnd,r=this.value;return this.value=r.slice(0,o)+"\n"+r.slice(n),this.selectionStart=this.selectionEnd=o+1,!1}return!(13==t.keyCode&&!t.altKey)||(a.currentTool.isActive&&a.currentTool.acceptText(go.TextEditingTool.LostFocus),!1)};a.currentTool.currentTextEditor.mainElement.onkeypress=null,a.currentTool.currentTextEditor.mainElement.onkeypress=o;var n=a.currentTool.currentTextEditor.mainElement.value;e.exports.checkPhone()&&(a.currentTool.currentTextEditor.mainElement.selectionStart=n.length,a.currentTool.currentTextEditor.mainElement.selectionEnd=n.length)}},travelParts:function(e,t){var a=e.diagram;t(e);var o=e.containingGroup;o&&o.data.parent==e.data.key&&t(o);for(var n,r,i,d,l=[e];l.length>0;)if(n=l.pop(),n.data.isparent)for(i=a.findNodeForKey(n.data.isparent),r=n.findLinksTo(i).first(),t(r),t(i),o=i.containingGroup,o&&o.data.parent==i.data.key&&t(o),l.push(i);i.data.next;)d=a.findNodeForKey(i.data.next),r=i.findLinksTo(d).first(),t(r),t(d),o=d.containingGroup,o&&o.data.parent==d.data.key&&t(o),l.push(d),i=d}}},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),r=go.GraphObject.make;go.GraphObject.defineBuilder("CircleButton",function(e){function t(e,t){return null!==e.diagram.findObjectAt(e.documentPoint,function(e){for(;null!==e.panel;){if(e.isActionable)return e;e=e.panel}return e},function(e){return e===t})}var a=go.GraphObject.make(go.Panel,"Auto",{isActionable:!0,enabledChanged:function(e,t){var a=e.findObject("ButtonBorder");null!==a&&(a.fill=t?e._buttonFillNormal:e._buttonFillDisabled)},cursor:"pointer",_buttonFillNormal:"#F5F5F5",_buttonStrokeNormal:"#BDBDBD",_buttonFillOver:"#E0E0E0",_buttonStrokeOver:"#9E9E9E",_buttonFillPressed:"#BDBDBD",_buttonStrokePressed:"#9E9E9E",_buttonFillDisabled:"#E5E5E5"},go.GraphObject.make(go.Shape,{name:"ButtonBorder",figure:"Circle",spot1:new go.Spot(0,0,2.76142374915397,2.761423749153969),spot2:new go.Spot(1,1,-2.76142374915397,-2.761423749153969),parameter1:2,parameter2:2,fill:"#F5F5F5",stroke:"#BDBDBD"}));return a.mouseEnter=function(e,t,a){if(t.isEnabledObject()){var o=t.findObject("ButtonBorder");if(o instanceof go.Shape){var n=t._buttonFillOver;t._buttonFillNormal=o.fill,o.fill=n,n=t._buttonStrokeOver,t._buttonStrokeNormal=o.stroke,o.stroke=n}}},a.mouseLeave=function(e,t,a){if(t.isEnabledObject()){var o=t.findObject("ButtonBorder");o instanceof go.Shape&&(o.fill=t._buttonFillNormal,o.stroke=t._buttonStrokeNormal)}},a.actionDown=function(e,t){if(t.isEnabledObject()&&null!==t._buttonFillPressed&&0===e.button){var a=t.findObject("ButtonBorder");if(a instanceof go.Shape){var o=e.diagram,n=o.skipsUndoManager;o.skipsUndoManager=!0;var r=t._buttonFillPressed;t._buttonFillOver=a.fill,a.fill=r,r=t._buttonStrokePressed,t._buttonStrokeOver=a.stroke,a.stroke=r,o.skipsUndoManager=n}}},a.actionUp=function(e,a){if(a.isEnabledObject()&&null!==a._buttonFillPressed&&0===e.button){var o=a.findObject("ButtonBorder");if(o instanceof go.Shape){var n=e.diagram,r=n.skipsUndoManager;n.skipsUndoManager=!0,t(e,a)?(o.fill=a._buttonFillOver,o.stroke=a._buttonStrokeOver):(o.fill=a._buttonFillNormal,o.stroke=a._buttonStrokeNormal),n.skipsUndoManager=r}}},a.actionCancel=function(e,a){if(a.isEnabledObject()&&null!==a._buttonFillPressed){var o=a.findObject("ButtonBorder");if(o instanceof go.Shape){var n=e.diagram,r=n.skipsUndoManager;n.skipsUndoManager=!0,t(e,a)?(o.fill=a._buttonFillOver,o.stroke=a._buttonStrokeOver):(o.fill=a._buttonFillNormal,o.stroke=a._buttonStrokeNormal),n.skipsUndoManager=r}}},a.actionMove=function(e,a){if(a.isEnabledObject()&&null!==a._buttonFillPressed){var o=e.diagram;if(0===o.firstInput.button&&(o.currentTool.standardMouseOver(),t(e,a))){var n=a.findObject("ButtonBorder");if(n instanceof go.Shape){var r=o.skipsUndoManager;o.skipsUndoManager=!0;var i=a._buttonFillPressed;n.fill!==i&&(n.fill=i),i=a._buttonStrokePressed,n.stroke!==i&&(n.stroke=i),o.skipsUndoManager=r}}}},a});var i=function(){function e(t){o(this,e);this.diagram=t.diagram,this.nodeProperties=this.getNodeProperties(),this.binding=this.getBinding()}return n(e,[{key:"getNodeProperties",value:function(){this.diagram;return{}}},{key:"getNodeSelectionAdornmentTemplate",value:function(){return r(go.Adornment,"Auto",r(go.Shape,"Rectangle",{fill:null,stroke:"dodgerblue",strokeWidth:3}),r(go.Placeholder))}},{key:"getBinding",value:function(){return[new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("angle","angle").makeTwoWay(),new go.Binding("copyable","copyable").makeTwoWay()]}},{key:"getTextBuild",value:function(){return r(go.TextBlock,{name:"TEXT",alignment:new go.Spot(.5,.4),font:"bold 18px 幼圆",editable:!0,stroke:"black",isMultiline:!0,overflow:go.TextBlock.OverflowClip,wrap:go.TextBlock.WrapDesiredSize,textAlign:"center",spacingAbove:4,spacingBelow:4,portId:"TEXT",stretch:go.GraphObject.Uniform},new go.Binding("textAlign","textAlign",function(e){return["start","center","end"].indexOf(e)>-1?e:"center"}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return helpers.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return helpers.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("width","width",function(e){return e-30}).ofObject("main"),new go.Binding("text","text").makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay())}},{key:"getNodeTemplate",value:function(){console.log("NodeBase.getNodeTemplate");var e=this;return r(go.Node,e.nodeProperties,e.binding)}},{key:"click",value:function(e,t){t.diagram.__trtd.nodeClickListener&&t.diagram.__trtd.nodeClickListener(t)}},{key:"doubleClick",value:function(e,t){e.diagram.__trtd.selectText(e,t)}},{key:"mouseOver",value:function(e,t){e.diagram.__trtd.showNodeRemarkTips(e,t)}},{key:"mouseLeave",value:function(e,t){e.diagram.__trtd.removeNodeRemarkTips()}},{key:"mouseDragEnter",value:function(e,t){var a=t.part,o=e.diagram.selection.first();if(o instanceof go.Node&&"3"!=o.category&&"text"!=o.category&&1!=o.key){var n=a.findObject("SHAPE");n&&(n._prevFill=n.fill,n.fill="darkred")}}},{key:"mouseDragLeave",value:function(e,t){var a=t.part,o=a.findObject("SHAPE");o&&o._prevFill&&(o.fill=o._prevFill)}},{key:"mouseDrop",value:function(e,t){var a=t.part,o=e.diagram.selection.first();if(o instanceof go.Node&&"3"!=o.data.category&&"text"!=o.data.category&&1!=o.data.key)if(a.data.isparent){for(var n=e.diagram.findNodeForKey(a.data.isparent);n.data.next;)n=e.diagram.findNodeForKey(n.data.next);if(n.data.key==o.data.key)return;e.diagram.__trtd.setNodeAsSibling(o,n)}else e.diagram.__trtd.setNodeAsChildren(o,a)}}]),e}();e.exports=i},function(e,t,a){"use strict";function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var n=go.GraphObject.make;e.exports=function(e){return n(go.Node,"Auto",o({name:"NODE",_controlExpand:!0,layerName:"Background",zOrder:20,locationSpot:go.Spot.Center,resizeCellSize:new go.Size(10,10),locationObjectName:"SHAPE",resizable:!0,resizeObjectName:"SHAPE",rotatable:!0,rotateObjectName:"SHAPE",doubleClick:function(e,t){console.log(t.data),t.diagram.__trtd.nodeDoubleClickListener&&t.diagram.__trtd.nodeDoubleClickListener(t)},click:function(e,t){console.log(t.data),t.diagram.__trtd.nodeClickListener&&t.diagram.__trtd.nodeClickListener(t)},selectable:!0,movable:!0,angle:0,layoutConditions:go.Part.LayoutStandard,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,resizeAdornmentTemplate:e.__trtd.nodeResizeAdornmentTemplate(),contextMenu:e.__trtd.nodeContextMenu,selectionAdornmentTemplate:function(){var e=go.GraphObject.make;return e(go.Adornment,"Spot",e(go.Panel,"Auto",e(go.Shape,{fill:null,stroke:"blue",strokeWidth:1}),e(go.Placeholder)),e(go.Panel,"Vertical",{name:"ButtonIcon1",alignment:new go.Spot(0,1,-20,20),alignmentFocus:go.Spot.Center,width:60,height:60,isActionable:!0},e(go.Shape,"Circle",{fill:"rgba(1,1,1,0)",strokeWidth:0,stroke:"green",width:50,height:50})))}()},"contextMenu",function(){var e=go.GraphObject.make;return e(go.Adornment,"Vertical",e("ContextMenuButton",e(go.TextBlock,"删除"),{click:function(e,t){e.diagram.commandHandler.deleteSelection()}}),e("ContextMenuButton",e(go.TextBlock,"居中"),{click:function(e,t){centerPicture()}}),e("ContextMenuButton",e(go.TextBlock,"等宽高"),{click:function(e,t){equalWidthHeightPicture()}}),e("ContextMenuButton",e(go.TextBlock,"原始比例",{stroke:"gray"}),{click:function(e,t){}}),e("ContextMenuButton",e(go.TextBlock,"至于顶层"),{click:function(e,t){bringToLayer("Foreground")}}),e("ContextMenuButton",e(go.TextBlock,"至于底层"),{click:function(e,t){bringToLayer("Background")}}),e("ContextMenuButton",e(go.TextBlock,"上移一层"),{click:function(e,t){bringToLayer(null)}}),e("ContextMenuButton",e(go.TextBlock,"固定",new go.Binding("text","",function(e,t){var a=t.part;return void 0!=a.data.selectable?a.data.selectable?"固定":"取消固定":"固定"})),{name:"fixnode",click:function(e,t){var a=t.diagram,o=t.part;a.startTransaction(),a.model.setDataProperty(o.data,"selectable",void 0!=o.data.selectable&&!o.data.selectable),a.commitTransaction()}}))}()),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("layerName","layerName",function(e,t){return e||""}).makeTwoWay(function(e){return e}),n(go.TextBlock,new go.Binding("text","text")),n(go.Picture,{name:"SHAPE"},{successFunction:function(e,t){e.width&&e.height||e.part.data.width&&e.part.data.height||(e.width=e.element.width,e.height=e.element.height)}},{sourceCrossOrigin:function(e){return""}},new go.Binding("source","picture",function(e){return e+"?"+Date.now()}).makeTwoWay(function(e){return e?e=e.replace(/\?.*$/g,""):""}),new go.Binding("width","width",function(e,t){return e}).makeTwoWay(function(e){return e}),new go.Binding("height","height",function(e,t){return e}).makeTwoWay(function(e){return e}),new go.Binding("angle","pictureangle").makeTwoWay(),new go.Binding("opacity","opacity",function(e,t){return e?parseFloat(e):1}).makeTwoWay(function(e){return e})))}},function(e,t,a){"use strict";var o=go.GraphObject.make;e.exports=function(e){var t={figure:"Rectangle",fill:"rgba(0,0,0,0)",strokeWidth:1,stroke:"rgba(0,0,0,0)",fontSize:15,font:"sans-serif"};return o(go.Node,"Spot",{_controlExpand:!0,layerName:"Foreground",movable:!0,locationSpot:go.Spot.Center,resizeCellSize:new go.Size(10,10),locationObjectName:"SHAPE",resizable:!0,resizeObjectName:"SHAPE",rotatable:!0,location:new go.Point(0,0),toMaxLinks:1,layoutConditions:go.Part.LayoutStandard,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,contextMenu:e.__trtd.getNodeContextMenu(),doubleClick:function(e,t){e.diagram.__trtd.selectText(e,t)}},new go.Binding("locationSpot","locationSpot",function(e){return console.log("locationSpot1"),go.Spot.parse(e)}).makeTwoWay(function(e){return console.log("locationSpot2"),go.Spot.stringify(e)}),new go.Binding("deletable","deletable").makeTwoWay(),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("angle","angle").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("layerName","layerName",function(e,t){return e||""}).makeTwoWay(function(e){return e}),o(go.Shape,{strokeDashArray:null,name:"SHAPE",figure:"Rectangle",fill:"rgba(0,0,0,0)",fromLinkable:!0,toLinkable:!0,cursor:"pointer",minSize:new go.Size(50,50),strokeWidth:2,stroke:"rgba(0,0,0,0)",portId:"",width:150},new go.Binding("strokeDashArray","strokeDashArray",function(e){return[e.split()[0],e.split()[1]]}).makeTwoWay(function(e){return e[0]+" "+e[1]}),new go.Binding("fill","fill",function(e,t){return e instanceof go.Brush?e.color:e}).makeTwoWay(),new go.Binding("width","width",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("height","height",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("stroke","stroke",function(e){return e instanceof go.Brush?e.stroke:e}).makeTwoWay(),new go.Binding("strokeWidth","strokeWidth",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("figure","figure").makeTwoWay(),{figure:t.figure,fill:t.fill,strokeWidth:t.strokeWidth,stroke:t.stroke}),o(go.Shape,{name:"SHAPE_Back",figure:"Rectangle",fill:"rgba(0,0,0,0)",strokeWidth:0},new go.Binding("width","width",function(e){return e}).ofObject("SHAPE"),new go.Binding("height","height",function(e){return e}).ofObject("SHAPE")),o(go.TextBlock,{name:"TEXT",alignment:new go.Spot(.5,.5),font:"bold "+e.__trtd.InitialFontSize+"px 幼圆",editable:!0,stroke:"black",isMultiline:!0,overflow:go.TextBlock.OverflowClip,wrap:go.TextBlock.WrapDesiredSize,textAlign:"center",spacingAbove:4,spacingBelow:4,portId:"TEXT",stretch:go.GraphObject.Fill},new go.Binding("textAlign","textAlign",function(e){return _.contains(["start","center","end"],e)?e:"center"}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return helpers.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return helpers.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("width","width",function(e){return e}).ofObject("SHAPE"),new go.Binding("text","text").makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay()))}},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(t.diagram.model.setDataProperty(e,"strokeWidth",t.diagram.__trtd.tdCurrentTheme.borderWidth),t.diagram.model.setDataProperty(e,"stroke",t.diagram.__trtd.tdCurrentTheme.borderColor),null==t.diagram.__trtd.tdCurrentTheme.colorRange)t.diagram.model.setDataProperty(e,"fill",randomColor({luminosity:"light",count:1})[0]);else if(t.diagram.__trtd.tdCurrentTheme.colorRange instanceof Array){var a="white";a=e.level>=t.diagram.__trtd.tdCurrentTheme.colorRange.length?t.diagram.__trtd.tdCurrentTheme.colorRange[e.level%t.diagram.__trtd.tdCurrentTheme.colorRange.length]:t.diagram.__trtd.tdCurrentTheme.colorRange[e.level],t.diagram.model.setDataProperty(e,"fill",a)}else if("random"==t.diagram.__trtd.tdCurrentTheme.colorRange)if(e.prev){var o=t.diagram.findNodeForKey(e.prev);o?t.diagram.model.setDataProperty(e,"fill",o.data.fill):t.diagram.model.setDataProperty(e,"fill",randomColor({luminosity:"light",count:1})[0])}else t.diagram.model.setDataProperty(e,"fill",randomColor({luminosity:"light",count:1})[0]);else"white"==t.diagram.__trtd.tdCurrentTheme.colorRange?t.diagram.model.setDataProperty(e,"fill","white"):t.diagram.model.setDataProperty(e,"fill","rgba(0,0,0,0)");return e}function d(e,t,a){var o,n=t;for(a||(a=0);n.parent&&n.level!=a;)(o=e.findNodeDataForKey(n.parent))&&(n=o);return n}function l(e,t){for(var a=t.diagram,o=e;o.data.parent&&o.data.parent!=t.data.key;)o=a.findNodeForKey(o.data.parent);return null!=o.data.parent}function c(e){if(null!=e.data.parent){var t=e.diagram,a=e.diagram.model;if(e.data.prev){var o=t.findNodeForKey(e.data.prev);if(e.data.next){var n=t.findNodeForKey(e.data.next);a.setDataProperty(o.data,"next",n.data.key),a.setDataProperty(n.data,"prev",o.data.key);var r=o.findLinksTo(e).first();a.setToKeyForLinkData(r.data,n.data.key);var r=e.findLinksTo(n).first();a.removeLinkData(r.data)}else{a.setDataProperty(o.data,"next",null);var r=o.findLinksTo(e).first();a.removeLinkData(r.data)}}else{var i=t.findNodeForKey(e.data.parent);if(e.data.next){var n=t.findNodeForKey(e.data.next);a.setDataProperty(i.data,"isparent",n.data.key),a.setDataProperty(n.data,"prev",null);var r=i.findLinksTo(e).first();a.setToKeyForLinkData(r.data,n.data.key),r=e.findLinksTo(n).first(),a.removeLinkData(r.data)}else{if(!i)return;a.setDataProperty(i.data,"isparent",null);var r=i.findLinksTo(e).first();r&&a.removeLinkData(r.data);var d=i.containingGroup;d&&(a.setDataProperty(i.data,"group",d.data.group),a.removeNodeData(d.data))}}a.setDataProperty(e.data,"parent",null),a.setDataProperty(e.data,"prev",null),a.setDataProperty(e.data,"next",null)}}function s(e,t){var a=t.diagram,o=a.__trtd.tdCurrentTheme;return null!=o.linkColor&&a.model.setDataProperty(e,"color",o.linkColor),e}function g(e,t){if(null==e.data.group&&null!=e.data.isparent){var a=o.findNodeForKey(e.data.isparent);if(a){var o=e.diagram,n=o.model,r={isGroup:!0,parent:e.data.key,key:"g_"+e.data.key,group:t,level:e.data.level};n.addNodeData(r),n.setDataProperty(e.data,"group",r.key);var i=a.containingGroup;for(i?n.setDataProperty(i.data,"group",r.key):n.setDataProperty(a.data,"group",r.key);a.data.next;)a=o.findNodeForKey(a.data.next),i=a.containingGroup,i?n.setDataProperty(i.data,"group",r.key):n.setDataProperty(a.data,"group",r.key)}}}function u(e,t){var a=(e.diagram,e.diagram),o=a.selection.first();if(o){var n=d(a.model,o.data,0);a.startTransaction("ControlAutoLayout"),b.tdTravelTdpData(n,a.model,[],function(e){a.findNodeForKey(e.key).containingGroup&&a.findNodeForKey(e.key).containingGroup.layout&&(a.findNodeForKey(e.key).containingGroup.layout.isInitial=t,a.findNodeForKey(e.key).containingGroup.layout.isOngoing=t)}),n.group&&a.findNodeForKey(n.group)?(a.findNodeForKey(n.group).layout.isInitial=t,a.findNodeForKey(n.group).layout.isOngoing=t):(a.layout.isInitial=t,a.layout.isOngoing=t)}else a.nodes.each(function(e){a.findNodeForKey(e.data.key).layout&&(a.findNodeForKey(e.data.key).layout.isInitial=t,a.findNodeForKey(e.data.key).layout.isOngoing=t)}),a.layout.isInitial=t,a.layout.isOngoing=t;a.commitTransaction("ControlAutoLayout")}function p(e){if(e){var t=e.containingGroup;t&&(t.layout.isInitial=!0,t.layout.isOngoing=!0)}}function m(e,t){var a=t.diagram.__trtd.tdCurrentTheme;return a.groupStrokeWidth&&t.diagram.model.setDataProperty(e,"strokeWidth",a.groupStrokeWidth),a.groupStroke&&(e.stroke=a.groupStroke,t.diagram.model.setDataProperty(e,"stroke",a.groupStroke)),a.groupColor&&(e.fill=a.groupColor,t.diagram.model.setDataProperty(e,"fill",a.groupColor)),e}function f(e){if(e.data.isparent){var t=e.location.copy(),a=(new go.Point(0,0),e.diagram.findNodeForKey(e.data.isparent)),o=a.location.copy(),n=new go.Point(o.x-t.x,o.y-t.y),r=n.copy().rotate(-90);return new go.Point(r.x+t.x,r.y+t.y)}var t=e.location.copy(),i=y(e.actualBounds.width+100,225);return t.offset(i[0],i[1]),t}function h(e,t){var a=t.location.copy(),o=e.location.copy(),n=new go.Point(o.x-a.x,o.y-a.y),r=new go.Point(0,0);if(e.data.next){var i=e.diagram.findNodeForKey(e.data.next),d=i.location.copy(),l=new go.Point(d.x-a.x,d.y-a.y),c=new go.Point((n.x+l.x)/2,(n.y+l.y)/2),s=r.directionPoint(c)-r.directionPoint(n);c=n.rotate(s);var g=y(20,r.directionPoint(c));c.offset(g[0],g[1]);return new go.Point(c.x+a.x,c.y+a.y)}if(e.data.prev&&e.diagram.findNodeForKey(e.data.prev)){var u=e.diagram.findNodeForKey(e.data.prev).location.copy(),p=new go.Point(u.x-a.x,u.y-a.y),s=r.directionPoint(n)-r.directionPoint(p);console.log("angle:"+s),s>45&&(s=45)}else var s=60;var m=n.rotate(s),g=y(20,r.directionPoint(m));return m.offset(g[0],g[1]),m=new go.Point(m.x+a.x,m.y+a.y)}function y(e,t){var a,o;return t>=0&&t<=90?(a=e*Math.sin(t*Math.PI/180),o=e*Math.cos(t*Math.PI/180),[o,a]):t>90&&t<=180?(a=e*Math.sin((180-t)*Math.PI/180),o=e*Math.cos((180-t)*Math.PI/180),[-o,a]):t>180&&t<=270?(a=e*Math.sin((t-180)*Math.PI/180),o=e*Math.cos((t-180)*Math.PI/180),[-o,-a]):t>270&&t<=360?(a=e*Math.sin((360-t)*Math.PI/180),o=e*Math.cos((360-t)*Math.PI/180),[o,-a]):void 0}function v(e,t,a){var o=a.diagram;if(e.next){var n=o.model.findNodeDataForKey(e.next);return t.push(n),v(n,t,a)}return t}Object.defineProperty(t,"__esModule",{value:!0});var k=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),w=a(16),b=a(0),T=a(11).Trtd,x=a(14),S=a(7),P=a(2),D=a(5),_=(a(3),a(6)),B=a(35),N=go.GraphObject.make,O=["#FFBFBF","#E9BFFF","#D1FF72","#00A2E8","#99D9EA"],A=function(e){function t(e,a){o(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return r.config=a,r.modelChangedListener=a.modelChangedListener,r.type=a.type,r.diagram={},r.model=a.model,r.initDiagramBase(e,a),r.initDiagram(e,a),r.initListener(),r.model&&r.initModel(),r}return r(t,e),k(t,[{key:"initDiagram",value:function(e,t){var a={},o=Object.assign(a,t.diagramConfig);this.diagram.setProperties(o),this.addNodeTemplate(),this.addLinkTemplate(),this.addGroupTemplate()}},{key:"getTdData",value:function(){return this.diagram.model.toJson()}},{key:"getDefaultCustomMenuDivStr",value:function(){return'\n        <ul>\n            <li trtd_action="addFollower"><a class="i18n" data-lang="insertsl">插入同级节点</a></li>\n            <li trtd_action="startNewSpiral"><a class="i18n" data-lang="icn">插入子节点</a></li>\n            <li trtd_action="apiDuplicateNode"><a class="i18n" data-lang="duplicateNode">复制节点</a></li>\n            <li trtd_action="apiDeleteSelection"><a class="i18n" data-lang="remove">删除</a></li>\n            <li trtd_action="orderChildNode"><a class="i18n" data-lang="ordernode">子节点编号</a></li>\n            <li trtd_action="clearOrderChildNode"><a class="i18n" data-lang="clearordernode">取消子节点编号</a></li>\n            <li trtd_action="clearNodeTextMenu"><a class="i18n" data-lang="emptynodetext">清空节点文本</a></li>\n            <li trtd_action="apiInsertTianpanNode"><a class="i18n" data-lang="insertnodetianpan">插入天盘节点</a></li>\n            <li trtd_action="addTextNode"><a class="i18n" data-lang="inserttext">插入文本</a></li>\n            <li trtd_action="locateRootNodeMenu"><a class="i18n" data-lang="locaterootnode">定位根节点</a></li>\n            <li trtd_action="showAllNodesMenu"><a class="i18n" data-lang="displayallnodes">显示所有节点</a></li>\n            <li trtd_action="fixPictureMenu"><a class="i18n" data-lang="fixnode">固定节点</a></li>\n            <li trtd_action="activePictureMenu"><a class="i18n" data-lang="cancelfix">取消固定</a></li>\n\n            <li trtd_action="delYunpanAxis"><a class="i18n" data-lang="cancelfix">删除 CTRL+DEL</a></li>\n            <li trtd_action="addYunpanAxis"><a class="i18n" data-lang="cancelfix">增加 CTRL+X/Y</a></li>\n        </ul>\n        '}},{key:"getShowContextMenus",value:function(e){var t="";if(e){if("autoText"==e.data.category)return"apiDeleteSelection";if("picGroup"==e.data.category)return"apiDeleteSelection";"8"==e.data.category&&(t="apiDeleteSelection,"),"text"==e.data.category&&(t="apiDeleteSelection,apiDuplicateNode"),"3"==e.data.category&&(t="apiDeleteSelection,",e.selectable?t+=",fixPictureMenu":t+=",activePictureMenu"),"0"!=e.data.category&&"1"!=e.data.category&&"2"!=e.data.category&&""!=e.data.category||(t="apiDeleteSelection,apiDuplicateNode,addFollower,startNewSpiral,orderChildNode,clearOrderChildNode"),"yunpanx"!=e.data.category&&"yunpany"!=e.data.category||(t="delYunpanAxis,addYunpanAxis")}else t="addTextNode,apiInsertTianpanNode";return t}},{key:"apiInsertTianpanNode",value:function(){var e=this.diagram;e.startTransaction();var t={key:b.guid(),text:"双击编辑内容",level:0,radius:100,fill:"white",category:"0",strokeWidth:2,stroke:"black",font:"bold 18px 幼圆",textStroke:"black",newAdd:!0,angle:5};t.loc=go.Point.stringify(e.lastInput.documentPoint),e.model.addNodeData(t),e.commitTransaction()}},{key:"fixPictureMenu",value:function(){var e=this.diagram,t=e.findPartAt(e.lastInput.documentPoint,!1);e.startTransaction(),e.model.setDataProperty(t.data,"selectable",void 0!=t.data.selectable&&!t.data.selectable),e.commitTransaction()}},{key:"activePictureMenu",value:function(){this.fixPictureMenu()}},{key:"addTextNode",value:function(e){console.log("eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee:");var t=this.diagram;t.startTransaction();var a={text:e||x.trans("blankText"),category:"autoText"};a.loc=go.Point.stringify(t.lastInput.documentPoint),t.model.addNodeData(a),t.commitTransaction()}},{key:"guid",value:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},{key:"initModel",value:function(e){e&&(this.model=e),console.log("initModel");var t=go.Model.fromJson(this.model);"dipan"==t.modelData.currentType&&(t.nodeDataArray=t.nodeDataArray.filter(function(e){if(!e.isGroup)return delete e.group,!0}),t.linkDataArray=[]),t.modelData.currentType||(t.modelData.currentType=this.type),["jin","shui","wheel","huo"].indexOf(this.type)>-1&&(t.modelData.currentType="tianpan"),console.log(" tmpModel.modelData.currentType"),this.diagram.layout.isInitial=!1,t.modelData.type=this.type;for(var a=0;a<t.nodeDataArray.length;a++)"waveGroup"==t.nodeDataArray[a].category&&(t.nodeDataArray[a].centerTextAngle||(t.nodeDataArray[a].centerTextAngle="independent"),t.nodeDataArray[a].centerTextMode||(t.nodeDataArray[a].centerTextMode="independent"),t.nodeDataArray[a].maxOlive||(t.nodeDataArray[a].maxOlive=50)),"yunGroup"==t.nodeDataArray[a].category&&(t.nodeDataArray[a].shapeStrokes||(t.nodeDataArray[a].shapeStrokes=["RGBA(237,28,36,0.3)","RGBA(255,192,0,0.3)","RGBA(255,255,0,0.3)","RGBA(146,208,80,0.3)","RGBA(192,200,250,0.3)","RGBA(255,178,125,0.3)","RGBA(209,110,210,0.3)","RGBA(248,163,62,0.3)","RGBA(248,161,164,0.3)","RGBA(244,115,120,0.3)"]),t.nodeDataArray[a].beginSpark||(t.nodeDataArray[a].beginSpark="line"),null==t.nodeDataArray[a].showShape&&(t.nodeDataArray[a].showShape=!0)),"shape"==t.nodeDataArray[a].category&&"background"==t.nodeDataArray[a].role&&(t.nodeDataArray[a].visible=!0),t.nodeDataArray[a].role&&t.nodeDataArray[a].role.indexOf("labelText")>-1&&(t.nodeDataArray[a].movable=!0),"labelGroup"==t.nodeDataArray[a].category&&(t.nodeDataArray[a].selectable=!1);this.diagram.model=t,this.diagram.updateAllTargetBindings()}},{key:"loadModel",value:function(e){this.initModel(e)}},{key:"initListener",value:function(){console.log("initListener")}},{key:"addGroupTemplate",value:function(){this.diagram.groupTemplateMap.add("",N(go.Group,"Auto",{layerName:"Background",selectable:!1,pickable:!1,locationSpot:go.Spot.Center,ungroupable:!0,alignment:go.Spot.Center,click:function(e){},contextClick:function(e){},alignmentFocus:go.Spot.Center,selectionAdornmentTemplate:N(go.Adornment,"Spot",N(go.Panel,"Auto",N(go.Shape,"Circle",{stroke:"dodgerblue",strokeWidth:2,fill:null},new go.Binding("width","",function(e){var t=myDiagram.selection.first();if(t instanceof go.Group)return t.actualBounds.width}),new go.Binding("height","",function(e){var t=myDiagram.selection.first();if(t instanceof go.Group)return t.actualBounds.height})),N(go.Placeholder)),N(go.Panel,"Horizontal",{alignment:go.Spot.Top,alignmentFocus:go.Spot.Bottom})),copyable:!1},{layout:N(w,{isRealtime:!1,radius:NaN,clockwise:!0,isInitial:!1}),layoutConditions:go.Part.LayoutStandard&~go.Part.LayoutNodeSized&~go.Part.LayoutAdded},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),N(go.Panel,"Auto",N(go.Shape,"Circle",{name:"SHAPE",fill:"rgba(212,230,188,0)",stroke:null,spot1:new go.Spot(.01,.01),spot2:new go.Spot(.99,.99)},new go.Binding("stroke","stroke",function(e){return e instanceof go.Brush?e.stroke:e}).makeTwoWay(),new go.Binding("strokeWidth","strokeWidth",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("figure","figure").makeTwoWay(),new go.Binding("desiredSize","radius",function(e){var t=parseInt(e||100);return new go.Size(t,t)}).makeTwoWay(function(e){return e.width})),N(go.Placeholder,{margin:0}))))}},{key:"addNodeTemplate",value:function(){var e=this.diagram;this.addNodeTemplateBase(),e.nodeTemplateMap.add("0",S(this.diagram)),e.nodeTemplateMap.add("1",S(this.diagram)),e.nodeTemplateMap.add("2",S(this.diagram)),e.nodeTemplateMap.add("3",P(this.diagram)),e.nodeTemplateMap.add("4",D(this.diagram)),e.nodeTemplateMap.add("",S(this.diagram)),e.nodeTemplateMap.add("8",_(this.diagram))}},{key:"addLinkTemplate",value:function(){this.diagram.linkTemplateMap.add("",B(this.diagram))}},{key:"setNodeAsChildren",value:function(e,t){if(!l(t,e)&&t.data.isparent!=e.data.key){var a=e.diagram,o=e.diagram.model;if(o.startTransaction("setNodeAsChildren"),c(e),t.data.isparent){var n=a.findNodeForKey(t.data.isparent);o.setDataProperty(t.data,"isparent",e.data.key),o.setDataProperty(n.data,"prev",e.data.key),o.setDataProperty(e.data,"next",n.data.key),o.setDataProperty(e.data,"parent",t.data.key);var r=t.findLinksTo(n).first();o.setToKeyForLinkData(r.data,e.data.key);var i=o.copyLinkData(r.data);i.from=e.data.key,i.to=n.data.key,o.addLinkData(i)}else{o.setDataProperty(t.data,"isparent",e.data.key),o.setDataProperty(e.data,"next",null),o.setDataProperty(e.data,"parent",t.data.key);var i={from:t.data.key,to:e.data.key,level:t.data.level+1,isTreeLink:!0};i.strokeWidth=2,s(i,e),o.addLinkData(i);var d={isGroup:!0,group:t.data.group,parent:t.data.key,key:"g_"+t.data.key,level:t.data.level};o.addNodeData(d),o.setDataProperty(t.data,"group",d.key)}var u=e.containingGroup;u&&u.data.parent==e.data.key?o.setDataProperty(u.data,"group",t.data.group):null==e.data.parent&&null!=e.data.isparent?g(e,t.data.group):o.setDataProperty(e.data,"group",t.data.group);var p=e.data.level-t.data.level-1;b.travelParts(e,function(e){o.setDataProperty(e.data,"level",e.data.level-p)}),o.commitTransaction("setNodeAsChildren")}}},{key:"setNodeAsSibling",value:function(e,t){if(!l(t,e)&&t.data.next!=e.data.key){var a=e.diagram,o=e.diagram.model;if(o.startTransaction("setNodeAsSibling"),c(e),null!=t.data.next){var n=a.findNodeForKey(t.data.next);o.setDataProperty(t.data,"next",e.data.key),o.setDataProperty(e.data,"next",n.data.key),o.setDataProperty(e.data,"prev",t.data.key),o.setDataProperty(n.data,"prev",e.data.key),o.setDataProperty(e.data,"parent",t.data.parent);var r=t.findLinksTo(n).first();o.setToKeyForLinkData(r.data,e.data.key);var i=o.copyLinkData(r.data);i.from=e.data.key,i.to=n.data.key,o.addLinkData(i)}else{o.setDataProperty(t.data,"next",e.data.key),o.setDataProperty(e.data,"next",null),o.setDataProperty(e.data,"prev",t.data.key),o.setDataProperty(e.data,"parent",t.data.parent),o.setDataProperty(e.data,"fill",t.data.fill);var d=t.findLinksInto().first(),i=o.copyLinkData(d.data);i.from=t.data.key,i.to=e.data.key,o.addLinkData(i)}var s=e.data.level-t.data.level;b.travelParts(e,function(e){o.setDataProperty(e.data,"level",e.data.level-s)});var u=e.containingGroup,p=a.findNodeForKey(t.data.parent);if(u&&u.data.parent==e.data.key?o.setDataProperty(e.containingGroup.data,"group",p.data.group):null==e.data.parent&&null!=e.data.isparent?g(e,p.data.group):o.setDataProperty(e.data,"group",p.data.group),p&&p.containingGroup){var m=p.containingGroup;m&&(m.layout.isOngoing=!0,m.layout.isValidLayout=!1)}o.commitTransaction("setNodeAsSibling")}}},{key:"setNodeAsChildren",value:function(e,t){if(!l(t,e)&&t.data.isparent!=e.data.key){var a=e.diagram,o=e.diagram.model;if(o.startTransaction("setNodeAsChildren"),c(e),t.data.isparent){var n=a.findNodeForKey(t.data.isparent);o.setDataProperty(t.data,"isparent",e.data.key),o.setDataProperty(n.data,"prev",e.data.key),o.setDataProperty(e.data,"next",n.data.key),o.setDataProperty(e.data,"parent",t.data.key);var r=t.findLinksTo(n).first();o.setToKeyForLinkData(r.data,e.data.key);var i=o.copyLinkData(r.data);i.from=e.data.key,i.to=n.data.key,o.addLinkData(i)}else{o.setDataProperty(t.data,"isparent",e.data.key),o.setDataProperty(e.data,"next",null),o.setDataProperty(e.data,"parent",t.data.key);var i={from:t.data.key,to:e.data.key,level:t.data.level+1,isTreeLink:!0};i.strokeWidth=2,s(i,e),o.addLinkData(i);var d={isGroup:!0,group:t.data.group,parent:t.data.key,key:"g_"+t.data.key,level:t.data.level};o.addNodeData(d),o.setDataProperty(t.data,"group",d.key)}var u=e.containingGroup;u&&u.data.parent==e.data.key?o.setDataProperty(u.data,"group",t.data.group):null==e.data.parent&&null!=e.data.isparent?g(e,t.data.group):o.setDataProperty(e.data,"group",t.data.group);var p=e.data.level-t.data.level-1;b.travelParts(e,function(e){o.setDataProperty(e.data,"level",e.data.level-p)}),o.commitTransaction("setNodeAsChildren")}}},{key:"deleteSelection",value:function(e){var t=this.diagram,a=t.commandHandler,o=t.selection.first();if(o&&!(o instanceof go.Group)&&1!=o.data.key&&"g_1"!=o.data.key){for(var n=null,r=["next","prev","parent"],i=0;i<r.length;i++)if(o.data[r[i]]){n=t.findNodeForKey(o.data[r[i]]);break}t.startTransaction("deleteSelection1");try{if(o instanceof go.Link)return;t.startTransaction("sub"),this.deleteNode(o,e),t.commitTransaction("sub"),go.CommandHandler.prototype.deleteSelection.call(a)}catch(e){console.log(e),t.commitTransaction("deleteSelection1")}t.commitTransaction("deleteSelection1"),n&&t.select(n)}}},{key:"deleteNode",value:function(e,t){console.log("deleteNodedeleteNodedeleteNodedeleteNode");var a=this.diagram,o=null;if(e instanceof go.Group&&e.memberParts.each(function(e){e.data.isparent&&(o=e)}),(e=null==o?e:o)instanceof go.Node){var n=e.findNodesInto().first()?e.findNodesInto().first():null,r=e.data.next?a.findNodeForKey(e.data.next):null;if(r)var i=r.findLinksInto().first();else var i=null;var d=e.findLinksInto().first(),l={};l=b.extend(l,e.data);var c=e.findLinksInto().first()?e.findLinksInto().first().data:null,s={};if(s=b.extend(s,c),delete s.__gohashid,delete s.points,e.data.group)var g=a.findNodeForKey(e.data.group);else var g=null;try{if(e.data.isparent){var u=[],p=[];a.nodes.each(function(t){t.isMemberOf(g)&&t.data.key!=e.data.key&&(u.push(t.data),t.findLinksInto().count>0&&p.push(t.findLinksInto().first().data))}),o&&u.push(e.data),a.model.removeNodeDataCollection(u),a.model.removeLinkDataCollection(p),a.model.removeNodeData(g.data)}if(null!=n){if(n.data.key==l.parent)if(null==r){var m=a.findNodeForKey(n.data.group),f=a.findNodeForKey(n.data.parent);"Root"!==n.data.category&&(f?a.model.setDataProperty(n.data,"group",f.data.group):m&&m.data.group?a.model.setDataProperty(n.data,"group",m.data.group):a.model.setDataProperty(n.data,"group",void 0)),a.model.setDataProperty(n.data,"isparent",void 0),m&&a.model.removeNodeData(m.data)}else s.from=n.data.key,s.to=r.data.key,a.model.setDataProperty(r.data,"prev",void 0),a.model.addLinkData(s),a.model.setDataProperty(a.model.findNodeDataForKey(l.parent),"isparent",r.data.key);else a.model.setDataProperty(n.data,"next",null==r?null:r.data.key),null!=r&&(s.from=n.data.key,s.to=r.data.key,a.model.setDataProperty(r.data,"prev",n.data.key),a.model.addLinkData(s));d&&a.model.removeLinkData(d.data),i&&a.model.removeLinkData(i.data)}}catch(e){console.log(e.message)}}a.isModified=!0}},{key:"addLevelNodeData",value:function(e){var t=(null==window.localStorage.getItem("isautolayout")||window.localStorage.getItem("isautolayout"),e.diagram),a=(e.data.next,(t.model.nodeDataArray.length+1).toString()),o={key:a,text:x.trans("dce"),color:"yellow"};t.model.makeNodeDataKeyUnique(o),a=o.key;var n=null,r=null,d=t.model.findNodeDataForKey(e.data.parent).group;e.findNodesOutOf().each(function(t){t.data.level==e.data.level&&(n=t)});var r=null;e.findLinksOutOf().each(function(t){t.data.level==e.data.level&&(r=t)}),t.model.startTransaction(),o=i(o,e);null!=n&&(o.next=n.data.key,t.model.setDataProperty(n.data,"prev",o.key)),d&&(o.group=d),o.level=e.data.level,o.radius=e.data.radius,o.fill=e.data.fill,o.parent=e.data.parent,o.prev=e.data.key,o.strokeWidth=e.data.strokeWidth,o.stroke=e.data.stroke,o.font=e.data.font,o.textStroke=e.findObject("TEXT").stroke,e.data.figure&&(o.figure=e.data.figure),o.loc=e.data.loc;var l=e.location.copy();if(e.data.parent){var c=t.findNodeForKey(e.data.parent);c&&(l=h(e,c))}o.loc=go.Point.stringify(l),e.data.width&&(o.width=e.data.width),e.data.height&&(o.height=e.data.height),o.category=e.data.category,o.newAdd=!0,t.model.addNodeData(o);var g={from:e.data.key,to:o.key};if(g.level=e.data.level,g.color=o.fill,g.isTreeLink=!0,g=s(g,e),g.strokeWidth=2,e.findLinksInto()&&e.findLinksInto().first()?(g.color=e.findLinksInto().first().data.color,g.strokeWidth=e.findLinksInto().first().data.strokeWidth,g.toArrow=e.findLinksInto().first().data.toArrow,g.strokeDashArray=e.findLinksInto().first().data.strokeDashArray):g=s(g,e),t.model.addLinkData(g,e),t.model.setDataProperty(e.data,"next",a),null!=r){var u={};u=b.extend(u,r.data),delete u.__gohashid,delete u.points,u.from=o.key,u.to=r.data.to,t.model.removeLinkData(r.data),t.model.addLinkData(u)}return t.model.commitTransaction(),t.isModified=!0,o}},{key:"addFollower",value:function(e,t){if(!e)var e=this.diagram.lastInput;var a=e.diagram,o=a.selection.first();if(o){var n=o.diagram;if(null!==o&&o instanceof go.Node&&!(o instanceof go.Group)&&0!=o.findLinksInto().count){if(a.toolManager.textEditingTool.isActive){var r=a.selection.first().findObject("TEXT");r.text=a.toolManager.textEditingTool.currentTextEditor.innerText,a.toolManager.textEditingTool.stopTool()}o.data.level>=3?(u(e,!1),p(o)):u(e,!0),a.model.startTransaction("all");var i=this.addLevelNodeData(o);if(a.model.commitTransaction("all"),void 0!==t&&1==t){var d=n.findNodeForData(i);d&&n.select(d),a.isModified=!0;var r=a.selection.first().findObject("TEXT");r&&a.commandHandler.editTextBlock(r),b.simulateEnterWithAlt(e)}}}}},{key:"startNewSpiral",value:function(e){var t=this.diagram,a=t.lastInput,o=t.selection.first();if(o){var n=o.diagram;if(null!==o&&o instanceof go.Node&&!(o instanceof go.Group)&&(!o.data.isparent||!t.findNodeForKey(o.data.isparent)||t.findNodeForKey(o.data.isparent).visible)){o.data.level>=2?(u(a,!1),p(o)):u(a,!0),t.startTransaction(),t.startTransaction("addChildNodeData");var r=this.addChildNodeData(o);if(t.commitTransaction("addChildNodeData"),t.commitTransaction(),void 0!==e&&1==e){var i=t.findNodeForData(r);i&&t.centerRect(i.actualBounds),n.select(i);var d=t.selection.first().findObject("TEXT");d&&t.commandHandler.editTextBlock(d),b.simulateEnterWithAlt(a)}}}}},{key:"addChildNodeData",value:function(e){console.log("===================天盘");var t=(null==window.localStorage.getItem("isautolayout")||window.localStorage.getItem("isautolayout"),e.diagram),a=arguments[1]?arguments[1]:null;var o=(t.model.nodeDataArray.length+1).toString(),n={key:o,text:x.trans("dce")};t.model.makeNodeDataKeyUnique(n),o=n.key;var r=t.findNodeForKey(e.data.isparent),d=null;if(e.findLinksOutOf().each(function(t){t.data.level>e.data.level&&(d=t)}),n.level=e.data.level+1,n.parent=e.data.key,n.prev=void 0,e.data.isparent&&null!=r&&(n.next=r.data.key,t.model.setDataProperty(r.data,"prev",n.key)),null!=a&&(n.istemp=!0,n.text=""),0==e.data.level?n.radius=Math.max(.75*e.data.radius,100):e.data.radius?n.radius=Math.max(e.data.radius-5,50):n.radius=Math.max(InitialFontSize-10*e.data.level,50),null!=r&&e.containingGroup&&(n.group=e.containingGroup.data.key),null==r){var l={isGroup:!0,group:e.data.group,parent:e.data.key,fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",strokeWidth:0,level:e.data.level};l=m(l,e),t.model.addNodeData(l),t.model.setGroupKeyForNodeData(e.data,l.key),n.group=l.key}n.fill=O[n.level%5],n.category=e.data.category,n.loc=go.Point.stringify(f(e)),n.strokeWidth=2,e.data.figure&&(n.figure=e.data.figure),e.data.picture&&(n.picture=e.data.picture),e.data.width&&(n.width=e.data.width),e.data.height&&(n.height=e.data.height),n=i(n,e),n.font=e.data.font,n.textStroke=e.findObject("TEXT").stroke,t.model.setDataProperty(e.data,"isparent",o),n.newAdd=!0,t.model.addNodeData(n);var c={from:e.data.key,to:n.key};c.level=n.level,c.isTreeLink=!0,c.strokeWidth=2;var g=null;if(g=e.findLinksInto().first(),null!=d?(c.toArrow=d.data.toArrow,c.strokeDashArray=d.data.strokeDashArray,c.color=d.data.color,c.strokeWidth=2):null!=g?(c.toArrow=g.data.toArrow,c.strokeDashArray=g.data.strokeDashArray,c.color=g.data.color,c.strokeWidth=2):c=s(c,e),"dipan"!=e.data.category&&"Root"!=e.data.category||(c.category="dipan"),t.model.addLinkData(c),null!=d){var u={};u=b.extend(u,d.data),delete u.__gohashid,delete u.points,u.from=n.key,u.to=d.data.to,t.model.removeLinkData(d.data),t.model.addLinkData(u)}return t.isModified=!0,n}},{key:"moveWithinNodes",value:function(e){var t=this.diagram,a=t.selection.first();if(a){if(!a)return void t.select(t.findNodeForKey(1));switch(e){case"left":if(a.data.prev){var o=t.findNodeForKey(a.data.prev);o&&t.select(o)}break;case"up":if(a.data.parent){var o=t.findNodeForKey(a.data.parent);o&&t.select(o)}break;case"right":if(a.data.next){var o=t.findNodeForKey(a.data.next);o&&t.select(o)}break;case"down":if(a.data.isparent){var o=t.findNodeForKey(a.data.isparent);o&&t.select(o)}}}}},{key:"selectText",value:function(e){var t=this.diagram;if(t.selection.first()){var a=t.selection.first().findObject("TEXT");a&&t.commandHandler.editTextBlock(a),b.simulateEnterWithAlt(e)}}},{key:"dokeyDownFn",value:function(e){var t=this.diagram,a=this,o=this.diagram,e=o.lastInput,n=o.commandHandler;if(e.event.altKey){if("Q"==e.key)return void autoLayoutAll();if("R"==e.key)return void centerNode();if("C"==e.key)return void centerCurrentNode();if("A"==e.key)return void zoomToFit()}if(e.event.keyCode>=65&&e.event.keyCode<=90&&!e.event.altKey&&!e.event.ctrlKey&&!e.event.shiftKey)return e.bubbles=!1,this.selectText(e,t),!0;if(13===e.event.keyCode){var r=o.selection.first();r&&r.data.parent&&this.addFollower(e,!0),r&&!r.data.parent&&a.startNewSpiral(!0)}else 9===e.event.keyCode?a.startNewSpiral(!0):"t"===e.key?n.canCollapseSubGraph()?n.collapseSubGraph():n.canExpandSubGraph()&&n.expandSubGraph():"Del"==e.key?e.diagram.commandHandler.deleteSelection():113==e.event.keyCode?this.selectText(e,t):37==e.event.keyCode?this.moveWithinNodes("left",t):38==e.event.keyCode?this.moveWithinNodes("up",t):39==e.event.keyCode?this.moveWithinNodes("right",t):40==e.event.keyCode?this.moveWithinNodes("down",t):go.CommandHandler.prototype.doKeyDown.call(n);e.bubbles=!1}},{key:"downloadImage",value:function(){return this.diagram.makeImageData({scale:1,background:"#ffffff",type:"image/png",maxSize:new go.Size(9e3,9e3)})}},{key:"getNodeSelectionAdornmentTemplate",value:function(){return N(go.Adornment,"Spot",N(go.Panel,"Auto",N(go.Shape,{figure:"Circle",fill:"rgba(255,0,120,0.2)",stroke:"#767678",strokeWidth:12},new go.Binding("stroke","",function(e,t){return e.stroke?tinycolor(e.stroke).saturate().toString():"#767678"}),new go.Binding("strokeWidth","",function(e,t){return e.strokeWidth?e.strokeWidth+5:6}),new go.Binding("width","",function(e,t){return e.radius||150}),new go.Binding("height","",function(e,t){return e.radius||150})),N(go.Placeholder)),N("Button",{name:"AddChild",toolTip:N(go.Adornment,"Auto",N(go.Shape,{fill:"#FFFFCC"}),N(go.TextBlock,{textAlign:"center",margin:new go.Margin(8,4,4,4)},new go.Binding("text","",function(e){return"增加子节点"}))),alignment:go.Spot.Top,alignmentFocus:go.Spot.Bottom,width:30,height:30,click:function(e){e.diagram.__trtd.startNewSpiral()}},N(go.Shape,"PlusLine",{stroke:"#770077",desiredSize:new go.Size(15,15)})),N("Button",{name:"AddLevel",toolTip:N(go.Adornment,"Auto",N(go.Shape,{fill:"#FFFFCC"}),N(go.TextBlock,{textAlign:"center",margin:new go.Margin(8,4,4,4)},new go.Binding("text","",function(e){return"增加同级节点"}))),alignment:new go.Spot(1,.5,15,0),width:30,height:30,click:function(e){e.diagram.__trtd.addFollower(e)}},N(go.Shape,"PlusLine",{stroke:"#227700",desiredSize:new go.Size(15,15)}),new go.Binding("visible","level",function(e){return 0!=e})))}},{key:"orderChildNode",value:function(e){var t=this.diagram,a=[],o=t.selection.first();if(console.log("node",o),o){if(t.startTransaction(),console.log("node.data",o.data),o.data.isparent){var n=t.model.findNodeDataForKey(o.data.isparent);a.push(n),v(n,a,this);for(var r=/^(\d+\、+)|(\d+\.+)/g,i=0;i<a.length;i++)r.test(a[i].text)?t.model.setDataProperty(a[i],"text",a[i].text.replace(r,i+1+".")):""==a[i].text?t.model.setDataProperty(a[i],"text",i+1):t.model.setDataProperty(a[i],"text",i+1+"."+a[i].text)}else console.log("无子节点！");t.commitTransaction()}}},{key:"clearOrderChildNode",value:function(e){var t=this.diagram,a=[],o=t.selection.first();if(console.log("node",o),o){if(t.startTransaction(),console.log("node.data",o.data),o.data.isparent){var n=t.model.findNodeDataForKey(o.data.isparent);a.push(n),v(n,a,this);for(var r=/^(\d+\、+)|(\d+\.+)/g,i=0;i<a.length;i++)r.test(a[i].text)&&t.model.setDataProperty(a[i],"text",a[i].text.replace(r,""))}else console.log("无子节点！");t.commitTransaction()}}}]),t}(T);A.go=go,t.default=A,e.exports=t.default},function(e,t,a){"use strict";var o=go.GraphObject.make;e.exports=function(e){return o(go.Node,"Auto",{_controlExpand:!0,layerName:"default",locationSpot:go.Spot.Center,resizeCellSize:new go.Size(10,10),locationObjectName:"SHAPE",resizable:!0,resizeObjectName:"SHAPE",rotatable:!1,doubleClick:function(e,t){interactions.selectText(e,t)},layoutConditions:go.Part.LayoutStandard,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,resizeAdornmentTemplate:e.__trtd.nodeResizeAdornmentTemplate(),contextMenu:e.__trtd.getNodeContextMenu(),selectionAdornmentTemplate:e.__trtd.getNodeSelectionAdornmentTemplate()},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("isShadowed","isShadowed").makeTwoWay(),o(go.Panel,"Spot",o(go.Picture,{name:"SHAPE"},{sourceCrossOrigin:function(e){return"Anonymous"}},new go.Binding("source","picture",function(e){return e+"?"+Date.now()}).makeTwoWay(function(e){return e?e=e.replace(/\?.*$/g,""):""}),new go.Binding("width","width",function(e,t){return e}).makeTwoWay(function(e){return e}),new go.Binding("height","height",function(e,t){return e}).makeTwoWay(function(e){return e})),o(go.TextBlock,{name:"TEXT",alignment:new go.Spot(.5,.5),font:"bold "+e.__trtd.InitialFontSize+"px 幼圆",stroke:"black",isMultiline:!0,overflow:go.TextBlock.OverflowClip,wrap:go.TextBlock.WrapDesiredSize,textAlign:"center",spacingAbove:4,spacingBelow:4,portId:"TEXT",stretch:go.GraphObject.Fill},new go.Binding("textAlign","textAlign",function(e){return _.contains(["start","center","end"],e)?e:"center"}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("maxSize","width",function(e){var t=e/2*Math.sqrt(2);return new go.Size(t,t)}).ofObject("SHAPE"),new go.Binding("text","text").makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay())),{toolTip:o(go.Adornment,"Auto",o(go.Shape,{fill:"#FFFFCC"}),o(go.TextBlock,{margin:4},new go.Binding("text","",function(e){return e.text})))})}},function(e,t,a){"use strict";function o(e){var t=e.diagram;t.startTransaction();var a={text:"双击编辑文本",category:"text"};a.loc=go.Point.stringify(t.lastInput.documentPoint),t.model.addNodeData(a),t.commitTransaction()}var n=go.GraphObject.make,r=a(9);e.exports=function(e){return n(go.Node,"Spot",{name:"NODE",_controlExpand:!0,layerName:"Background",locationSpot:go.Spot.Center,resizeCellSize:new go.Size(10,10),locationObjectName:"BACKGROUND",resizable:!0,resizeObjectName:"BACKGROUND",rotatable:!0,rotateObjectName:"BACKGROUND",click:function(e,t){},doubleClick:function(e,t){o(e)},selectable:!0,selectionObjectName:"BACKGROUND",movable:!0,angle:0,layoutConditions:go.Part.LayoutStandard,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,resizeAdornmentTemplate:e.__trtd.nodeResizeAdornmentTemplate(),contextMenu:e.__trtd.getNodeContextMenu()},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("deletable","deletable").makeTwoWay(),n(go.Shape,{name:"SHAPE",geometryString:r.threeWheel,fill:"black",strokeWidth:5,stroke:"black",minSize:new go.Size(50,50)},new go.Binding("fill","fill").makeTwoWay(function(e){return e}),new go.Binding("stroke","stroke").makeTwoWay(function(e){return e}),new go.Binding("strokeWidth","strokeWidth").makeTwoWay(function(e){return e}),new go.Binding("desiredSize","desiredSize",function(e){return e}).ofObject("BACKGROUND"),new go.Binding("angle","angle",function(e){return e}).ofObject("BACKGROUND"),new go.Binding("geometryString","geometryValue",function(e){return r[e]})),n(go.Shape,"Rectangle",{name:"BACKGROUND",fill:"rgba(1,1,1,0)",stroke:"rgba(1,1,1,0)"},new go.Binding("desiredSize","desiredSize",function(e,t){return e?go.Size.parse(e):t.part.findObject("SHAPE").measuredBounds.size}).makeTwoWay(function(e){return go.Size.stringify(e)}),new go.Binding("angle","angle").makeTwoWay(function(e){return e})))}},function(e,t,a){"use strict";var o=go.GraphObject.make;e.exports=function(e){var t={figure:"Circle",fill:"white",strokeWidth:2,stroke:"black",fontSize:15,font:"sans-serif"};return o(go.Node,"Spot",{_controlExpand:!0,layerName:"default",locationSpot:go.Spot.Center,resizeCellSize:new go.Size(10,10),locationObjectName:"SHAPE",resizable:!0,resizeObjectName:"SHAPE",rotatable:!1,location:new go.Point(0,0),click:function(e,t){console.log(t.data),t.diagram.__trtd.nodeClickListener&&t.diagram.__trtd.nodeClickListener(t)},doubleClick:function(e,t){e.diagram.__trtd.selectText(e,t)},toMaxLinks:1,layoutConditions:go.Part.LayoutStandard,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,resizeAdornmentTemplate:e.__trtd.nodeResizeAdornmentTemplate(),contextMenu:e.__trtd.getNodeContextMenu(),selectionAdornmentTemplate:e.__trtd.getNodeSelectionAdornmentTemplate(),mouseOver:function(t,a){e.__trtd.showNodeRemarkTips(t,a)},mouseLeave:function(t,a){e.__trtd.removeNodeRemarkTips()},mouseDragEnter:function(e,t){var a=t.part,o=e.diagram.selection.first();if(o instanceof go.Node&&"3"!=o.category&&"text"!=o.category&&1!=o.key){var n=a.findObject("SHAPE");n&&(n._prevFill=n.fill,n.fill="darkred")}},mouseDragLeave:function(e,t){var a=t.part,o=a.findObject("SHAPE");o&&o._prevFill&&(o.fill=o._prevFill)},mouseDrop:function(e,t){var a=t.part,o=e.diagram.selection.first();if(o instanceof go.Node&&"3"!=o.data.category&&"text"!=o.data.category&&1!=o.data.key)if(a.data.isparent){for(var n=e.diagram.findNodeForKey(a.data.isparent);n.data.next;)n=e.diagram.findNodeForKey(n.data.next);if(n.data.key==o.data.key)return;e.diagram.__trtd.setNodeAsSibling(o,n)}else e.diagram.__trtd.setNodeAsChildren(o,a)}},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("deletable","deletable").makeTwoWay(),o(go.Shape,{strokeDashArray:null,name:"SHAPE",figure:"Circle",fill:"rgba(0,0,0,0)",fromLinkable:!0,toLinkable:!0,cursor:"pointer",minSize:new go.Size(50,50),strokeWidth:2,stroke:"black",portId:""},new go.Binding("strokeDashArray","strokeDashArray",function(e){try{var t=[parseInt(e.split(" ")[0]),parseInt(e.split(" ")[1])]}catch(e){var t=null}return t}).makeTwoWay(function(e){return e[0]+" "+e[1]}),new go.Binding("fill","fill",function(e,t){return e instanceof go.Brush?e.color:e}).makeTwoWay(),new go.Binding("desiredSize","radius",function(e){var t=parseInt(e||100);return new go.Size(t,t)}).makeTwoWay(function(e){return e.width}),new go.Binding("stroke","stroke",function(e){return e instanceof go.Brush?e.stroke:e}).makeTwoWay(),new go.Binding("strokeWidth","strokeWidth",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("figure","figure").makeTwoWay(),{figure:t.figure,fill:t.fill,strokeWidth:t.strokeWidth,stroke:t.stroke}),o(go.Shape,{name:"SHAPE_Back",figure:"Rectangle",fill:"rgba(128,128,128,0)",fromLinkable:!0,toLinkable:!0,strokeWidth:0},new go.Binding("desiredSize","width",function(e){var t=e/2*Math.sqrt(2);return new go.Size(t-3,t-3)}).ofObject("SHAPE")),o(go.Panel,"Table",o(go.RowColumnDefinition,{column:0,width:0}),o(go.Shape,"Rectangle",{row:0,column:0,fill:"rgba(0,255,0,0)",strokeWidth:0}),o(go.Panel,"Auto",{row:1,column:0},o(go.Shape,"RoundedRectangle",{fill:"rgba(0,0,0,0)",strokeWidth:0}),o(go.Picture,{alignment:go.Spot.Left,click:function(e){alert("picture clicked")},name:"Picture",desiredSize:new go.Size(10,10)})),o(go.Shape,"Rectangle",{row:2,column:0,fill:"rgba(0,0,0,0)",strokeWidth:0}),o(go.Panel,"Auto",{row:0,column:1,rowSpan:3},o(go.TextBlock,{name:"TEXT",alignment:new go.Spot(.5,.5),font:"bold "+e.__trtd.InitialFontSize+"px 幼圆",stroke:"black",isMultiline:!0,overflow:go.TextBlock.OverflowClip,wrap:go.TextBlock.WrapDesiredSize,textAlign:"center",spacingAbove:4,spacingBelow:4,portId:"TEXT",stretch:go.GraphObject.Fill,click:function(e,t){}},new go.Binding("textAlign","textAlign",function(e){return _.contains(["start","center","end"],e)?e:"center"}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("width","width",function(e){return e/2*Math.sqrt(2)}).ofObject("SHAPE"),new go.Binding("text","text").makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay()))))}},function(e,t,a){(function(e){function o(e,t){this._id=e,this._clearFn=t}var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;t.setTimeout=function(){return new o(r.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new o(r.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},a(18),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(t,a(13))},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={threeWheel:"M 225 0 C 100.736 0 0 100.735 0 225 s 100.736 225 225 225 c 124.265 0 225.001 -100.734 225.001 -225 C 450.002 100.735 349.265 0 225 0 Z M 225 1.515 c 62.006 0 118.106 25.257 158.591 66.037 c -38.634 133.172 -160.888 157.047 -160.888 157.047 l 0.047 0.083 h -0.051 C 123.453 130.609 19.61 161.966 9.597 165.291 C 35.716 70.857 122.255 1.515 225 1.515 Z M 1.517 225 c 0 -20.075 2.663 -39.524 7.627 -58.035 c 6.686 -2.295 111.992 -36.362 212.807 58.54 c -3.347 10.815 -36.032 125.634 54.089 217.118 c -16.395 3.83 -33.479 5.859 -51.04 5.859 C 101.575 448.482 1.517 348.428 1.517 225 Z M 277.292 442.318 c -89.298 -94.891 -57.746 -204.506 -53.915 -216.53 l 0.076 0.135 c 0 0 126.301 -26.492 161.022 -157.465 c 39.584 40.319 64.008 95.575 64.008 156.542 C 448.483 330.418 375.489 418.773 277.292 442.318 Z",fireWheel:"M225.000,450.000 C100.736,450.000 -0.000,349.264 -0.000,225.000 C-0.000,100.736 100.736,-0.000 225.000,-0.000 C349.264,-0.000 450.000,100.736 450.000,225.000 C450.000,349.264 349.264,450.000 225.000,450.000 ZM225.000,448.000 C338.085,448.000 431.498,363.821 446.026,254.709 C432.978,302.699 389.123,338.000 337.000,338.000 C274.592,338.000 224.000,287.408 224.000,225.000 C224.000,163.696 174.304,114.000 113.000,114.000 C51.696,114.000 2.000,163.696 2.000,225.000 C2.000,348.159 101.841,448.000 225.000,448.000 ZM225.000,2.000 C111.915,2.000 18.502,86.179 3.974,195.291 C17.022,147.301 60.877,112.000 113.000,112.000 C175.408,112.000 226.000,162.592 226.000,225.000 C226.000,286.304 275.696,336.000 337.000,336.000 C398.304,336.000 448.000,286.304 448.000,225.000 C448.000,225.000 448.000,225.000 448.000,225.000 C448.000,101.841 348.159,2.000 225.000,2.000 Z",goldWheel:"M449.993,0.008 L225.395,287.495 L355.004,449.995 L94.004,449.995 L224.597,287.502 L-0.008,0.008 L449.993,0.008 Z",waterWheel:"M268.000,443.000 C299.658,443.000 328.270,429.976 348.785,409.000 L351.564,409.000 C330.601,431.167 300.917,445.000 268.000,445.000 C204.487,445.000 153.000,393.513 153.000,330.000 C153.000,282.847 181.389,242.341 222.000,224.593 L222.000,224.508 C263.076,207.589 292.000,167.180 292.000,120.000 C292.000,57.592 241.408,7.000 179.000,7.000 C148.889,7.000 121.551,18.800 101.296,38.000 L98.382,38.000 C119.136,17.594 147.595,5.000 179.000,5.000 C242.513,5.000 294.000,56.487 294.000,120.000 C294.000,167.153 265.611,207.659 225.000,225.407 L225.000,225.478 C183.921,242.396 155.000,282.817 155.000,330.000 C155.000,392.408 205.592,443.000 268.000,443.000 Z"};t.default=o,e.exports=t.default},function(e,t,a){"use strict";function o(e){setTimeout(function(){try{if(console.log("check overflow"),!e.text)return;if(e.text&&""==e.text.trim())return;if(e.lineCount%2!=0){if("\n"==e.text[e.text.length-1])return void(e.text=e.text.substring(0,e.text.length-1));e.text=e.text+"\n"}}catch(e){console.error(e)}},100)}function n(e,t,a,o){var n,r=o.data.textAngle||"vertical";e.data.order%2==0?(t&&(n=t.data.nangle?t.data.textAngle||r:r,"horizontal"==n&&(t.locationSpot=new go.Spot(1,1,0,0),t.angle=0),t.__location=e.location.copy().offset(e.naturalBounds.width/2,0),t.__location=d(o.location,t.__location,e.angle),t.data.nloc?t.__offset?t.location=t.__location.copy().subtract(t.__offset):t.__offset=t.__location.copy().subtract(t.location):(t.location=e.location.copy().offset(e.naturalBounds.width/2,-e.naturalBounds.height/2),t.location=d(o.location,t.location,e.angle),delete t.__switchOrder),"vertical"==n&&(t.locationSpot=new go.Spot(.5,1,0,0),t.angle=e.angle)),a&&(n=a.data.nangle?a.data.textAngle||r:r,"horizontal"==n&&(a.locationSpot=new go.Spot(0,0,0,0),a.angle=0),console.log("xuxuxuxuxxuxu",a.data.order),a.__location=e.location.copy().offset(e.naturalBounds.width/2,0),a.__location=d(o.location,a.__location,e.angle),a.data.nloc?a.__offset?a.location=a.__location.copy().subtract(a.__offset):a.__offset=a.__location.copy().subtract(a.location):(a.location=e.location.copy().offset(e.naturalBounds.width/2,e.naturalBounds.height/2),a.location=d(o.location,a.location,e.angle),delete a.__switchOrder),"vertical"==n&&(a.locationSpot=new go.Spot(.5,0,0,0),a.angle=e.angle))):(t&&(n=t.data.nangle?t.data.textAngle||r:r,t.__location=e.location.copy().offset(e.naturalBounds.width/2,0),t.__location=d(o.location,t.__location,e.angle),t.data.nloc?t.__offset?t.location=t.__location.copy().subtract(t.__offset):t.__offset=t.__location.copy().subtract(t.location):(t.location=e.location.copy().offset(e.naturalBounds.width/2,e.naturalBounds.height/2),t.location=d(o.location,t.location,e.angle),delete t.__switchOrder),"horizontal"==n&&(t.locationSpot=new go.Spot(0,0,0,0),t.angle=0),"vertical"==n&&(t.locationSpot=new go.Spot(.5,0,0,0),t.angle=e.angle)),a&&(n=a.data.nangle?a.data.textAngle||r:r,a.__location=e.location.copy().offset(e.naturalBounds.width/2,0),a.__location=d(o.location,a.__location,e.angle),a.data.nloc?a.__offset?a.location=a.__location.copy().subtract(a.__offset):a.__offset=a.__location.copy().subtract(a.location):(a.location=e.location.copy().offset(e.naturalBounds.width/2,-e.naturalBounds.height/2),a.location=d(o.location,a.location,e.angle),delete a.__switchOrder),"horizontal"==n&&(a.locationSpot=new go.Spot(1,1,0,0),a.angle=0),"vertical"==n&&(a.locationSpot=new go.Spot(.5,1,0,0),a.angle=e.angle)))}function r(e,t,a){for(var r,i,c,s,g,u=[],p=a.data.oliveWidth,m=a.data.oliveHeight,f=a.data.shiStroke,h=a.data.xuStroke,y=a.data.centerStroke||"#3f5369",v=a.data.oliveType||"Ellipse",k=a.data.haveTail||!1,w=a.data.textAngle||"vertical",b=2*p/3,T=[],x=[],S=[];e.next();){var P=e.value;"shiText"==P.data.role&&T.push(P),"xuText"==P.data.role&&x.push(P),"centerText"==P.data.role&&S.push(P),P instanceof go.Node&&("line"==P.data.category&&(r=P,P.location=a.location.copy().offset(0,0),P.angle=a.angle),"wave"==P.data.category&&("Ellipse"==v?(P.diagram.model.setDataProperty(P.data,"oliveType","Ellipse"),P.diagram.model.setDataProperty(P.data,"desiredSize",p+" "+m)):(P.diagram.model.setDataProperty(P.data,"oliveType","Wave"),"waveTail"==P.data.role?(P.diagram.model.setDataProperty(P.data,"desiredSize",p/2+" "+m),P.diagram.model.setDataProperty(P.data,"selectable",!1)):P.diagram.model.setDataProperty(P.data,"desiredSize",p+" "+m)),P.angle=a.angle,b+=P.naturalBounds.width,u.push(P)))}b=u.length*p+2*p/3,k&&(b=u.length*p),console.log("maxHeight:0,maxWidth:0"),r.findObject("SHAPE").width=b,r.diagram.model.setDataProperty(r.data,"stroke",y),a.containingGroup.layout.isOngoing=!0,a.containingGroup.layout.isValidLayout=!1,a.resizeObject.width=b,a.resizeObject.height=m,a.waveCount=u.length,c=a.data.xuStrokeWidth,i=a.data.shiStrokeWidth,s=a.data.shiStrokeDashArray,g=a.data.xuStrokeDashArray,u=u.sort(function(e,t){return Number(e.data.order)-Number(t.data.order)});var D=null,_=null;u.forEach(function(e,t){var r=t+1;_=e.__oldOrder?e.__oldOrder:e.data.order,delete e.__oldOrder,T[t]=e.diagram.findNodeForKey(e.data.shiText),x[t]=e.diagram.findNodeForKey(e.data.xuText),e.data.isNew||"waveTail"==e.data.role||_%2!=r%2&&(T[t].data.nloc?(e.diagram.model.setDataProperty(T[t].data,"nloc",null),T[t].__oldLocation=T[t].location):T[t].__offset&&e.diagram.model.setDataProperty(T[t].data,"nloc",!0),x[t].data.nloc?(e.diagram.model.setDataProperty(x[t].data,"nloc",null),x[t].__oldLocation=x[t].location):x[t].__offset&&e.diagram.model.setDataProperty(x[t].data,"nloc",!0)),e.diagram.model.setDataProperty(e.data,"order",r),e.data.nalign||e.diagram.model.setDataProperty(e.data,"textAlign","center"),f&&e.diagram.model.setDataProperty(e.data,"shiStroke",f),h&&e.diagram.model.setDataProperty(e.data,"xuStroke",h),c&&e.diagram.model.setDataProperty(e.data,"xuStrokeWidth",c),i&&e.diagram.model.setDataProperty(e.data,"shiStrokeWidth",i),s&&e.diagram.model.setDataProperty(e.data,"shiStrokeDashArray",s),g&&e.diagram.model.setDataProperty(e.data,"xuStrokeDashArray",g),e.location=a.location.copy().offset(p*(r-1),0);var u=!1;if("independent"==a.data.centerTextAngle){if(!e.data.centerText){var m=e.location.copy().offset(e.naturalBounds.width/2,0);m=d(a.location,m,e.angle);var y={text:e.data.text,minSize:p-30+" 30",deletable:!1,textAlign:e.data.textAlign,font:e.data.font||"18px 'Microsoft YaHei'",textStroke:e.data.textStroke,category:"autoText",key:l.guid(),width:p-30,role:"centerText",level:0,group:e.data.group,order:r,visible:!1,layerName:"Foreground",locationSpot:go.Spot.stringify(new go.Spot(.5,.5,0,0)),selectable:!1,olive:e.data.key,loc:go.Point.stringify(m),angle:0};e.diagram.model.addNodeData(y),e.diagram.model.setDataProperty(e.data,"centerText",y.key),u=!0}var v=e.diagram.findNodeForKey(e.data.centerText);if(v){if(v.data.nalign||e.diagram.model.setDataProperty(v.data,"textAlign","center"),e.data.nangle||("vertical"==w&&(e.diagram.model.setDataProperty(v.data,"visible",!1),e.diagram.model.setDataProperty(e.data,"textVisible",!0)),"horizontal"==w&&(e.diagram.model.setDataProperty(v.data,"visible",!0),e.diagram.model.setDataProperty(e.data,"textVisible",!1),e.diagram.model.setDataProperty(v.data,"angle",0))),!u){var m=e.location.copy().offset(e.naturalBounds.width/2,0);m=d(a.location,m,e.angle),e.diagram.model.setDataProperty(v.data,"loc",go.Point.stringify(m))}e.diagram.model.setDataProperty(v.data,"order",r),v.data.nwidth||e.diagram.model.setDataProperty(v.data,"width",p-30),e.diagram.model.setDataProperty(v.data,"minSize",p-30+" 30"),l.checkPhone()&&(v.layerName="Background")}}e.text&&""!=e.text.trim()&&o(e.findObject("TEXT")),T[t]&&(T[t].desiredSize.width||T[t].updateTargetBindings(),e.diagram.model.setDataProperty(T[t].data,"showBorder",!0),T[t].data.nwidth||e.diagram.model.setDataProperty(T[t].data,"width",p),e.diagram.model.setDataProperty(T[t].data,"minSize",p-30+" 30"),e.diagram.model.setDataProperty(T[t].data,"order",r),T[t].data.ncolor||e.diagram.model.setDataProperty(T[t].data,"textStroke",f)),x[t]&&(x[t].desiredSize.width||x[t].updateTargetBindings(),e.diagram.model.setDataProperty(x[t].data,"minSize",p-30+" 30"),e.diagram.model.setDataProperty(x[t].data,"showBorder",!0),x[t].data.nwidth||e.diagram.model.setDataProperty(x[t].data,"width",p),x[t].data.nalign||e.diagram.model.setDataProperty(x[t].data,"textAlign","center"),e.diagram.model.setDataProperty(x[t].data,"order",r),x[t].data.ncolor||e.diagram.model.setDataProperty(x[t].data,"textStroke",h)),e.__location=d(a.location,e.location.copy(),e.angle),n(e,T[t],x[t],a),e.location=e.__location,D=e,e.diagram.model.setDataProperty(e.data,"isNew",null)})}function i(){go.Layout.call(this)}function d(e,t,a){if(e.equals(t))return t;var o=new go.Point(0,0).subtract(e.copy());return t.copy().offset(o.x,o.y).rotate(a).copy().offset(-o.x,-o.y)}var l=a(0);go.Diagram.inherit(i,go.Layout),i.prototype.doLayout=function(e){console.log("WaveGroupLayout.doLayout");var t=this.diagram;t.model.startTransaction("WaveGroupLayout"),r(this.collectParts(e).iterator,t,this.group),go.Layout.prototype.doLayout.call(this,e),t.model.commitTransaction("WaveGroupLayout")},e.exports=i,e.exports.layoutWaveGroup=r,e.exports.adjustTextAngle=n},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){var t=new go.Set(go.Part),a=e.first();if(a)if(a.containingGroup&&"labelGroup"==a.containingGroup.data.category){var o=a.containingGroup.findSubGraphParts().iterator;for(t.add(a.containingGroup);o.next();){var n=o.value;t.add(n)}}else c.travelParts(a,function(e){t.add(e)});else t.addAll(e);return go.DraggingTool.prototype.computeEffectiveCollection.call(this,t)}function r(e,t,a,o){if(!(e.findLinksOutOf().count>=2||e.findLinksOutOf().count>=1&&1==e.data.key))return e.data.group===a.data.group}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),l=go.GraphObject.make,c=a(0),s=a(3),g=a(2),u=a(12),p=function(){function e(t,a){o(this,e),console.log("trtd base"),this.config=a,this.modelChangedListener=a.modelChangedListener,this.showContextMenuListener=a.showContextMenuListener,this.hideContextMenuListener=a.hideContextMenuListener,this.ViewportBoundsChangedListener=a.ViewportBoundsChangedListener,this.cxElement=a.cxElement,this.deleteCallback=a.deleteCallback,this.useDefaultContext=null==a.useDefaultContext||a.useDefaultContext,this.defaultCxElement=null,this.type=a.type,this.div=t,this.containerDivId=a.containerDivId||"mainbox",this.diagram={},null!=a.model&&"object"==i(a.model)&&(console.log("dsfdf"),a.model=JSON.stringify(a.model)),this.model=a.model,this.tpid=a.tpid||Date.now(),this.InitialFontSize=18,this.tdCurrentTheme={id:6,borderWidth:2,borderColor:"black",groupColor:"rgba(0,0,0,0)",groupStroke:"rgba(0,0,0,0)",groupStrokeWidth:0,themeName:"黑白",linkColor:"black",colorRange:"white"},this.nodeClickListener=a.nodeClickListener,this.nodeDoubleClickListener=a.nodeDoubleClickListener,this.isModified=!1,this.lastModified=0,this.modifiedIndex=0}return d(e,[{key:"initDiagram",value:function(){console.log("基类方法，子类需要实现，用来初始化画布")}},{key:"addNodeTemplate",value:function(){console.log("基类方法，子类需要实现，用来初始化节点模板")}},{key:"resetZoom",value:function(e){this.diagram.commandHandler.resetZoom(e)}},{key:"getDefaultCustomMenuDivStr",value:function(){return console.log("基类方法，子类需要实现，设置默认自定义菜单"),'\n        <ul>\n            <li trtd_action="addLevelNodeMenu"><a class="i18n" data-lang="insertsl">插入同级节点</a></li>\n            <li trtd_action="addChildNodeMenu"><a class="i18n" data-lang="icn">插入子节点</a></li>\n            <li trtd_action="duplicateNode"><a class="i18n" data-lang="duplicateNode">复制节点</a></li>\n            <li trtd_action="deleteNodeMenu"><a class="i18n" data-lang="remove">删除</a></li>\n            <li trtd_action="orderChildNode"><a class="i18n" data-lang="ordernode">子节点编号</a></li>\n            <li trtd_action="clearOrderChildNode"><a class="i18n" data-lang="clearordernode">取消子节点编号</a></li>\n            <li trtd_action="clearNodeTextMenu"><a class="i18n" data-lang="emptynodetext">清空节点文本</a></li>\n            <li trtd_action="insertTianpanMenu"><a class="i18n" data-lang="insertnodetianpan">插入天盘节点</a></li>\n            <li trtd_action="insertTextMenu"><a class="i18n" data-lang="inserttext">插入文本</a></li>\n            <li trtd_action="locateRootNodeMenu"><a class="i18n" data-lang="locaterootnode">定位根节点</a></li>\n            <li trtd_action="showAllNodesMenu"><a class="i18n" data-lang="displayallnodes">显示所有节点</a></li>\n            <li trtd_action="fixPictureMenu"><a class="i18n" data-lang="fixnode">固定节点</a></li>\n            <li trtd_action="activePictureMenu"><a class="i18n" data-lang="cancelfix">取消固定</a></li>\n        \n            <li trtd_action="delYunpanAxis"><a class="i18n" data-lang="cancelfix">删除 CTRL+DEL</a></li>\n            <li trtd_action="addYunpanAxis"><a class="i18n" data-lang="cancelfix">增加 CTRL+X/Y</a></li>\n            <li trtd_action="addFollowerGround"><a class="i18n" data-lang="insertsl">增加同级节点</a></li>\n            <li trtd_action="addNewCircle"><a class="i18n" data-lang="icn">增加子节点</a></li>\n            <li trtd_action="apiDeleteSelection"><a class="i18n" data-lang="remove">删除</a></li>\n        </ul>\n        '}},{key:"getShowContextMenus",value:function(e){console.log("基类方法，子类需要实现，显示默认自定义带单时控制哪些菜单需要显示");var t="";return!e||e.data.isGroup?t="locateRootNodeMenu,showAllNodesMenu,insertTextMenu,insertTianpanMenu":(e instanceof go.Group||e.data.category&&""!=e.data.category&&"0"!=e.data.category&&"1"!=e.data.category&&"4"!=e.data.category||(t="addLevelNodeMenu,addChildNodeMenu,deleteNodeMenu,orderChildNode,clearOrderChildNode,clearNodeTextMenu,duplicateNode",console.log("2111"),e.selectable?t+="fixPictureMenu":t+="activePictureMenu"),"8"!=e.data.category&&"text"!=e.data.category&&"addtextTemplate"!=e.data.category||(t="deleteNodeMenu,duplicateNode"),"yunpanx"!==e.data.category&&"yunpany"!==e.data.category||(console.log("222222222222"),t="delYunpanAxis,addYunpanAxis"),"dipan"===e.data.category&&(t="addFollowerGround,addChildDipanNode,deleteDipanNode")),t}},{key:"insertPicture",value:function(e){this.apiInsertPicture(e)}},{key:"apiInsertPicture",value:function(e){console.log("基类方法，子类需要实现，对外接口，插入图片");var t=this.diagram,a=(this.diagram.model.modelData.currentType,t.selection.first());if(!a||"dipan"!=a.data.category||rootKey){t.model.startTransaction("setSourceOfPicture");try{var o=JSON.parse(localStorage.getItem("TRTD_documentPoint"));o||(o=t.lastInput.documentPoint)}catch(e){var o=t.lastInput.documentPoint}if(a)"3"==a.data.category&&t.model.setDataProperty(a.data,"picture",e);else{var n=(t.model.nodeDataArray.length+1).toString(),r={key:n,text:"",category:"3"};t.model.makeNodeDataKeyUnique(r),r.loc=go.Point.stringify(o),r.picture=e,t.model.addNodeData(r)}t.model.commitTransaction("setSourceOfPicture")}}},{key:"apiGetTheme",value:function(){for(var e=this.diagram.model,t="",a=0;a<e.nodeDataArray.length;a++)if("theme"==e.nodeDataArray[a].role||"themeText"==e.nodeDataArray[a].role||"themeText"==e.nodeDataArray[a].subRole){t=e.nodeDataArray[a].text;break}if(!t){var o=e.findNodeDataForKey(1);o&&(t=o.text)}return t}},{key:"insertFigure",value:function(e,t){var a=this.diagram,o=(this.diagram.model.modelData.currentType,a.selection.first());if(!o){a.model.startTransaction("setSourceOfPicture");try{var n=JSON.parse(localStorage.getItem("TRTD_documentPoint"))}catch(e){var n=a.lastInput.documentPoint}if(o)"3"!=o.data.category&&"text"!=o.data.category&&a.model.setCategoryForNodeData(o.data,"4"),"text"!=o.data.category&&a.model.setDataProperty(o.data,"picture",e);else{var r=(a.model.nodeDataArray.length+1).toString(),i={key:r,text:"",category:"3"};a.model.makeNodeDataKeyUnique(i),i.loc=go.Point.stringify(n),i.figureId=t,i.picture=e,a.model.addNodeData(i)}a.model.commitTransaction("setSourceOfPicture")}}},{key:"apiDuplicateNode",value:function(){var e=this.diagram,t=e.selection.first();if(t){e.startTransaction();var a=e.model.copyNodeData(t.data),o=t.location.copy();o.offset(50,-50),a.loc=go.Point.stringify(o),a.level=0,a=function(e){return e.level=0,delete e.prev,delete e.isparent,delete e.next,delete e.group,delete e.parent,e}(a),e.model.addNodeData(a),e.commitTransaction()}}},{key:"apiPreviewImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"white",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;console.log("基类方法，子类需要实现，对外接口，预览图片，生成base64");var a=this.diagram,o={scale:t,background:e,type:"image/png",maxSize:new go.Size(9e3,9e3)},n=new go.List(go.GraphObject);return a.nodes.each(function(e){e instanceof go.Group||(n.add(e),e instanceof go.Node&&"centerText"==e.data.role&&(e.layerName="Foreground"))}),a.links.each(function(e){n.add(e)}),o.parts=n.iterator,a.makeImageData(o)}},{key:"apiDeleteSelection",value:function(){console.log("基类方法，子类需要实现，对外接口，删除选中的节点"),this.diagram.toolManager.textEditingTool.doCancel(),this.diagram.commandHandler.deleteSelection()}},{key:"apiUndo",value:function(){this.diagram.commandHandler.undo()}},{key:"apiRedo",value:function(){this.diagram.commandHandler.redo()}},{key:"saveModel",value:function(e){c.saveModelToLocalStorage(this.tpid,this.diagram.model)}},{key:"addNodeTemplateBase",value:function(){var e=this.diagram;this.diagram.nodeTemplateMap.add("text",s(this.diagram)),this.diagram.nodeTemplateMap.add("3",g(this.diagram)),e.nodeTemplateMap.add("pic",u("pic",{diagram:this.diagram}).getNodeTemplate()),e.nodeTemplateMap.add("autoText",u("autoText",{diagram:e}).getNodeTemplate()),e.groupTemplateMap.add("picGroup",u("picGroup",{diagram:e}).getNodeTemplate())}},{key:"addWater",value:function(){console.log("addWater");var e=this.diagram,t=e.selection.first(),a=null;t&&"axisGroup"==t.data.category&&(a=t.data.key);var o=e.lastInput;e.startTransaction("addCbian");var n=c.guid(),r=o.documentPoint,i={category:"picGroup",role:"cbian",isGroup:!0,level:0,key:n,loc:go.Point.stringify(r),deletable:!0};a&&(i.group=a);var d={group:n,text:"",resizable:!1,category:"pic",loc:go.Point.stringify(r),picture:"https://static.365trtd.com/system/water/water.png",width:150,height:150},l={text:"总结",deletable:!0,fill:"black",iconVisible:!1,locationSpot:"1 0 0 0",textAlign:"center",category:"autoText",loc:go.Point.stringify(r.copy().offset(3,-3)),movable:!0,group:n},s={text:"时间",deletable:!0,fill:"black",iconVisible:!1,locationSpot:"1 0 0 0",textAlign:"center",category:"autoText",loc:go.Point.stringify(r.copy().offset(150,0)),movable:!0,group:n},g={text:"能量",deletable:!0,fill:"black",iconVisible:!1,locationSpot:"1 0 0 0",textAlign:"center",category:"autoText",loc:go.Point.stringify(r.copy().offset(0,-150)),movable:!0,group:n},u={text:"总结1",deletable:!0,textStroke:"#0e399d",iconVisible:!1,locationSpot:"0 0 0 0",textAlign:"left",category:"autoText",loc:go.Point.stringify(r.copy().offset(155*Math.cos(30*Math.PI/180),-150*Math.sin(30*Math.PI/180))),movable:!0,group:n},p={text:"总结2",deletable:!0,textStroke:"#FFC000",iconVisible:!1,locationSpot:"0 0.5 0 0",textAlign:"left",category:"autoText",loc:go.Point.stringify(r.copy().offset(145*Math.cos(45*Math.PI/180),-150*Math.sin(45*Math.PI/180))),movable:!0,group:n},m={text:"总结3",deletable:!0,textStroke:"#cb1c27",iconVisible:!1,locationSpot:"0 1 0 0",textAlign:"left",category:"autoText",loc:go.Point.stringify(r.copy().offset(145*Math.cos(70*Math.PI/180),-140*Math.sin(70*Math.PI/180))),movable:!0,group:n};e.model.addNodeData(u),e.model.addNodeData(p),e.model.addNodeData(m),e.model.addNodeData(l),e.model.addNodeData(s),e.model.addNodeData(g),e.model.addNodeData(d),e.model.addNodeData(i),e.commitTransaction("addWater")}},{key:"initDiagramBase",value:function(e,t){function a(e){e.diagram.isModified=!0,console.log("onTextChanged")}var o=this;console.log("基类初始化画布，子类修改diagram");var i=this.diagram,d=this,i=this.diagram,c={initialContentAlignment:go.Spot.Center,initialAutoScale:go.Diagram.Uniform,initialDocumentSpot:go.Spot.Center,initialViewportSpot:go.Spot.Center,"toolManager.hoverDelay":100,padding:-20,click:function(e){console.log("eeee:",e),localStorage.setItem("TRTD_documentPoint",go.Point.stringify(e.documentPoint))},"draggingTool.isCopyEnabled":!1,"commandHandler.archetypeGroupData":{text:"Group",isGroup:!0,color:"blue"},allowDrop:!0,"undoManager.isEnabled":!0,"toolManager.mouseWheelBehavior":go.ToolManager.WheelZoom,maxScale:5,minScale:.05,hasVerticalScrollbar:!1,hasHorizontalScrollbar:!1,scrollMode:go.Diagram.InfiniteScroll,scrollMargin:50,"animationManager.isEnabled":!0,maxSelectionCount:1,validCycle:go.Diagram.CycleDestinationTree,ModelChanged:function(e){e.isTransactionFinished&&(d.isModified=!0,d.lastModified=Date.now(),d.modifiedIndex+=1,setTimeout(function(){if(!d.isModified)return void console.log("已经保存，跳过",t,",",d.modifiedIndex);var t=Date.now()-d.lastModified;t>=1e3&&(console.log("大于1000毫秒需要保存",t,",",d.modifiedIndex),d.modifiedIndex=0,d.isModified=!1,d.saveModel(e),d.modelChangedListener&&d.modelChangedListener(e.model))},1100))},TextEdited:a,contextMenu:l(go.Adornment),ViewportBoundsChanged:function(e){d.ViewportBoundsChangedListener&&d.ViewportBoundsChangedListener(e)}},s=Object.assign(c,t.diagramConfig);delete s.type,delete s.tpid,delete s.model,delete s.modelChangedListener,delete s.mouseOverListener,delete s.clickListener,this.diagram=l(go.Diagram,e,s),this.diagram.__trtd=this;var i=this.diagram,g=i.findLayer("Foreground");i.addLayerBefore(go.GraphObject.make(go.Layer,{name:"default"}),g),i.addLayerBefore(go.GraphObject.make(go.Layer,{name:"overflow"}),g);for(var u=10;u>=0;u--)i.addLayerBefore(go.GraphObject.make(go.Layer,{name:u.toString()}),g);i.toolManager.draggingTool.computeEffectiveCollection=n,i.toolManager.dragSelectingTool.isPartialInclusion=!0,i.toolManager.rotatingTool.handleArchetype=l(go.Panel,"Auto",l(go.Shape,"BpmnActivityLoop",{width:30,height:30,stroke:"green",fill:"transparent"}),l(go.Shape,"Rectangle",{width:30,height:30,stroke:"green",fill:"transparent",strokeWidth:0})),i.toolManager.linkReshapingTool.handleArchetype=l(go.Shape,"Circle",{width:30,height:30,fill:"lightblue",stroke:"dodgerblue"}),i.toolManager.linkingTool.linkValidation=r,i.toolManager.relinkingTool.linkValidation=r,i.commandHandler.doKeyDown=function(e){o.dokeyDownFn(e)},i.commandHandler.deleteSelection=function(){console.log("deleteSelectiondeleteSelection");var e=d.diagram.selection.first();if(e&&"theme"!=e.data.role&&"themeText"!=e.data.role&&"themeText"!=e.data.subRole){var t=JSON.parse(JSON.stringify(e.data));d.deleteSelection(),d.deleteCallback&&d.deleteCallback(t)}},i.commandHandler.redo=function(){var e=i.commandHandler;i.clearSelection(),go.CommandHandler.prototype.redo.call(e)},i.commandHandler.undo=function(){var e=i.commandHandler;i.clearSelection(),i.toolManager&&i.toolManager.textEditingTool.doCancel(),go.CommandHandler.prototype.undo.call(e)},i.toolManager.clickCreatingTool.archetypeNodeData={category:"autoText",text:"双击编辑文本",level:0,radius:120},this.addNodeTemplateBase(),this.addDiagramContextMenu()}},{key:"removeNodeRemarkTips",value:function(){var e=document.getElementById("tooltip");e&&e.parentNode.removeChild(e)}},{key:"showNodeRemarkTips",value:function(e,t){var a=document.getElementById("tooltip");if(!a||0==a.length){var o=document.createElement("div");o.setAttribute("id","tooltip"),o.setAttribute("style","word-wrap: break-word;word-break: break-all"),document.body.appendChild(o),a=document.getElementById("tooltip")}var n=document.getElementById("tooltip");if(t.data.istemp||!t.data.text||""!=t.data.text.trim()||!(t.data.remark&&""==t.data.remark.trim()||void 0===t.data.remark)){if(t.data.istemp)var r=lang.trans("tempnodetips");else if("y"===t.category||"LogicXor"===t.category&&"5"===t.data.loc.split(" ")[1])var r="最右新增";else if("x"===t.category||"LogicXor"===t.category&&"-20"===t.data.loc.split(" ")[0])var r="最上新增";else{var r=t.data.text+"<br><hr>";r+=t.data.remark?t.data.remark:""}n.innerHTML=r,"y"===t.category||"x"===t.category||"LogicXor"===t.category?(n.style.left=e.event.clientX+10+"px",n.style.top=e.event.clientY-10+"px"):(n.style.left=e.event.clientX+50+"px",n.style.top=e.event.clientY-50+"px"),n.style.position="fixed",n.style.zIndex=5555,n.style.backgroundColor="#FFFFE1"}}},{key:"nodeResizeAdornmentTemplate",value:function(){return l(go.Adornment,"Spot",l(go.Placeholder),l(go.Shape,"Circle",{alignment:go.Spot.TopLeft,alignmentFocus:go.Spot.BottomRight,cursor:"col-resize",desiredSize:new go.Size(30,30),fill:"lightblue",stroke:"dodgerblue"}),l(go.Shape,"Circle",{alignment:go.Spot.BottomRight,alignmentFocus:go.Spot.TopLeft,cursor:"col-resize",desiredSize:new go.Size(30,30),fill:"lightblue",stroke:"dodgerblue"}))}},{key:"customMenu",value:function(){if(console.log("第一步创建默认的自定义菜单"),this.defaultCxElement)return console.log("使用默认菜单，已经存在"),this.defaultCxElement;if(console.log(this.useDefaultContext),!this.useDefaultContext)return null;var e=this.getDefaultCustomMenuDivStr(),t=document.createElement("div");t.setAttribute("class","context-menu"),t.innerHTML=e;var a=document.getElementById(this.containerDivId);a.appendChild(t);var o=a.getElementsByClassName("context-menu")[0];return this.defaultCxElement=o,this.bindMenuEventListener(o),o}},{key:"bindMenuEventListener",value:function(e){var t=this,a=e.getElementsByTagName("li");console.log("创建的自定义菜单需要绑定一些事件");for(var o=0;o<a.length;o++)!function(e){a[e].addEventListener("click",function(){var o=a[e].getAttribute("trtd_action");return console.log("menuList[i].addEventListener('click'"),t.diagram.__trtd[o](),t.diagram.currentTool.stopTool(),!1})}(o)}},{key:"addDiagramContextMenu",value:function(){console.log("第二步 将自定义菜单与diagram绑定");var e=this,t=this.diagram,a=t.toolManager.contextMenuTool;if(console.log(this.cxElement),this.cxElement)var o=this.cxElement;else{this.defaultCxElement||(this.defaultCxElement=this.customMenu());var o=this.defaultCxElement}o&&(o.addEventListener("contextmenu",function(e){return e.preventDefault(),!1},!1),o.tabIndex="1",a.showContextMenu=function(a,n){console.log("thisthisthis:",this.diagram),console.log("thisthisthis:",this.diagram.model),console.log("this:",this.diagram.selection);var r=this.diagram;if(null!==r){a!==this.currentContextMenu&&this.hideContextMenu();var i=t.findPartAt(t.lastInput.documentPoint,!1);this.currentContextMenu=a;var d=r.lastInput.viewPoint;if(console.log(r.lastInput),o.style.left=d.x+"px",o.style.top=d.y+"px",e.showContextMenuListener)return e.showContextMenuListener(this.diagram,i);var l=e.getShowContextMenus(i),s=o.getElementsByTagName("li");if(l){console.log(l.split(",").length);for(var g=0;g<s.length;g++)s[g].style.display="none";for(var u=0;u<l.split(",").length;u++)try{c.getElementByAttr(o,"li","trtd_action",l.split(",")[u])[0]&&(c.getElementByAttr(o,"li","trtd_action",l.split(",")[u])[0].style.display="block")}catch(e){console.error(e);continue}}else if(""==l)for(var p=0;p<s.length;p++)s[p].style.display="block";else for(var m=0;m<s.length;m++)s[m].style.display="none";o.style.display="block"}},a.hideContextMenu=function(){if(null!==this.currentContextMenu)return this.currentContextMenu=null,o.style.display="none",e.hideContextMenuListener?e.hideContextMenuListener(t):void 0})}},{key:"getNodeContextMenu",value:function(){return l(go.Adornment)}},{key:"dokeyDownFn",value:function(){var e=this.diagram,t=this.diagram,a=this.diagram.lastInput,o=e.commandHandler,n=e.selection.first();if(a.event.altKey){if("Q"==a.key)return void autoLayoutAll();if("R"==a.key)return void centerNode();if("C"==a.key)return void centerCurrentNode();if("A"==a.key)return void zoomToFit()}if(a.event.keyCode>=65&&a.event.keyCode<=90&&!a.event.altKey&&!a.event.ctrlKey&&!a.event.shiftKey)return a.bubbles=!1,t.__trtd.selectText(a),!0;if(13===a.event.keyCode)n&&"Root"==n.data.category?t.__trtd.addFollowerGround():n&&"dipan"==n.data.category&&t.__trtd.addFollowerGround();else if(9===a.event.keyCode)n&&"Root"==n.data.category?t.__trtd.addNewCircle():n&&"dipan"==n.data.category&&t.__trtd.addNewCircle();else if("t"===a.key)o.canCollapseSubGraph()?o.collapseSubGraph():o.canExpandSubGraph()&&o.expandSubGraph();else if("Del"==a.key){if(0==e.selection.count)return;t.__trtd.deleteSelection()}else 113==a.event.keyCode?t.__trtd.selectText():37==a.event.keyCode?t.__trtd.moveWithinNodes("left"):38==a.event.keyCode?t.__trtd.moveWithinNodes("up"):39==a.event.keyCode?t.__trtd.moveWithinNodes("right"):40==a.event.keyCode?t.__trtd.moveWithinNodes("down"):go.CommandHandler.prototype.doKeyDown.call(o);a.bubbles=!1}}]),e}();e.exports.Trtd=p},function(module,exports,__webpack_require__){"use strict";var waveNodeTemplate=__webpack_require__(17),waveTailNodeTemplate=__webpack_require__(20),waveGroupNodeTemplate=__webpack_require__(21),axisGroupNodeTemplate=__webpack_require__(22),iconTextNodeTemplate=__webpack_require__(24),autoTextNodeTemplate=__webpack_require__(25),labelGroupNodeTemplate=__webpack_require__(26),picNodeTemplate=__webpack_require__(27),picGroupNodeTemplate=__webpack_require__(28),yunGroupNodeTemplate=__webpack_require__(29),yunpanGroupNodeTemplate=__webpack_require__(31),shapeNodeTemplate=__webpack_require__(33),shapeTextNodeTemplate=__webpack_require__(34);module.exports=function(nodeType,options){var temp=nodeType+"NodeTemplate";console.log("factory:",temp);var nodeTemplateClass=eval(temp);return new nodeTemplateClass(options)}},function(e,t){var a;a=function(){return this}();try{a=a||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(a=window)}e.exports=a},function(e,t,a){"use strict";function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n={trtd:{en:"Turn Round TD",chn:"圆转天地"},save:{en:"Save",chn:"保存"},preview:{en:"Preview",chn:"预览"},logout:{en:"Log out",chn:"退出"},menu:{en:"Menu",chn:"菜单"},usual:{en:"Common",chn:"常用"},thinking:{en:"Train of Thought",chn:"思路"},appearance:{en:"Appearance",chn:"外观"},view:{en:"View",chn:"视图"},insertll:{en:"Insert the Lower Leve",chn:"插入下级"},insertsl:{en:"Insert Sibling Level",chn:"插入同级"},undo:{en:"Undo",chn:"撤销"},redo:{en:"Redo",chn:"重做"},cte:{en:"Click to edit",chn:"单击编辑"},dce:{en:"Double Click to Edit",chn:"双击编辑内容"},centertheme:{en:"Central Theme",chn:"中心主题"},edit:{en:"Edit",chn:"编辑"},remove:{en:"Delete",chn:"删除"},radius:{en:"Size",chn:"大小"},shape:{en:"Shape",chn:"形状"},borderwidth:{en:"Border Width",chn:"边框宽度"},noborder:{en:"No Border",chn:"无边框"},borderstyle:{en:"Border Style",chn:"边框样式"},fillcolor:{en:"Fill Color",chn:"填充色"},bordercolor:{en:"Border Color",chn:"边框颜色"},image:{en:"Pictures",chn:"图片"},insert:{en:"Insert",chn:"插入"},delete:{en:"Remove",chn:"移除"},remark:{en:"Comment",chn:"备注"},removeallnode:{en:"Empty Nodes",chn:"清空节点"},removeallline:{en:"Delete Lines",chn:"清空连线"},arrangelayout:{en:"Arrange layout",chn:"整理布局"},previewSubPan:{en:"Preview SubPan",chn:"预览子盘"},arrowstyle:{en:"Arrow Style",chn:"箭头样式"},linkstyle:{en:"Link Style",chn:"弧样式"},clearText:{en:"Clear Text",chn:"清空文本"},tdautolayout:{en:"Auto layout",chn:"天盘自动布局"},jumptonewnode:{en:"Auto locate",chn:"自动跳转到新的节点"},theme:{en:"Subject",chn:"主题"},backcolor:{en:"Background Color",chn:"背景颜色"},objofaction:{en:"Object",chn:"作用对象"},oneobj:{en:"Single Node",chn:"单个节点"},sibobj:{en:"Sibling Nodes",chn:"同级节点"},allsibobj:{en:"All Sibling Nodes",chn:"所有同级节点"},allnodes:{en:"All Nodes",chn:"所有节点"},shade:{en:"Shade",chn:"阴影"},font:{en:"Font",chn:"字体"},fontsize:{en:"Font Size",chn:"字号"},compactdegree:{en:"Compact Level",chn:"紧凑程度"},compact:{en:"Compact",chn:"紧凑"},sparse:{en:"Sparse",chn:"稀疏"},eq:{en:"Equal Interval",chn:"等间距"},spread:{en:"Spread",chn:"展开"},firstl:{en:"First Layer",chn:"第一层"},secondl:{en:"Second Layer",chn:"第二层"},threel:{en:"Third Layer",chn:"第三层"},fourl:{en:"Fourth Layer",chn:"第四层"},fifthl:{en:"Fifth Layer",chn:"第五层"},localnodes:{en:"Location Nodes",chn:"定位节点"},rootnode:{en:"Root Node",chn:"根节点"},currentnode:{en:"Current Nodes",chn:"当前节点"},displayallnodes:{en:"Display All Nodes",chn:"显示所有节点"},return:{en:"Back",chn:"返回"},tianpan:{en:"TianPan",chn:"天盘"},dipan:{en:"DiPan",chn:"地盘"},open:{en:"Open",chn:"打开"},saveas:{en:"Save As",chn:"另存为"},help:{en:"Help",chn:"帮助"},new:{en:"New",chn:"新建"},commontemplate:{en:"Common template",chn:"常用模板"},openlocalfile:{en:"Open local file",chn:"打开本地文件"},importtext:{en:"Import outline text",chn:"导入大纲文本"},recentlyfile:{en:"Recently used files",chn:"最近使用的文件"},exportdata:{en:"Export Data",chn:"另存为txt数据"},exporttext:{en:"Export Outline Text",chn:"导出大纲文本"},exportimg:{en:"Export Pictures",chn:"导出图片"},websupport:{en:"Website Support",chn:"网站支持"},techsupport:{en:"Technical Support",chn:"技术支持"},techsupportqq:{en:"Technical Support to QQ Groups",chn:"技术支持QQ群"},shortcutkey:{en:"Shortcut Key",chn:"快捷键"},addchildnode:{en:"Add Child",chn:"增加子节点"},addsibnode:{en:"Add Sibling",chn:"增加同级节点"},key:{en:"Key",chn:"键"},or:{en:"Or",chn:"或"},confirmedittext:{en:"Confirm the completion of editing text",chn:"编辑完文字确认"},editnewline:{en:"Edit text newline",chn:"编辑文字换行"},canceltextedit:{en:"Cancel Text Editing",chn:"取消编辑文字"},activetextedit:{en:"Activate Text Editing",chn:"激活编辑文字"},sanpak:{en:"Select a node and press any key",chn:"选中节点后按任意字母键"},auxview:{en:"Auxiliary View",chn:"辅助查看"},focusselectnode:{en:"Focus on selected nodes",chn:"聚焦选中节点"},locateselectednode:{en:"Locate selected nodes",chn:"定位选中节点"},locaterootnode:{en:"Locate Root Nodes",chn:"定位根节点"},bigcanvas:{en:"Enlarge Canvas",chn:"放大画布"},smallcanvas:{en:"Narrow Canvas",chn:"缩小画布"},switchnode:{en:"Switch selected nodes",chn:"切换选择的节点"},mttnsn:{en:"Move to the next sibling node",chn:"移动到下一个同级节点"},mttlsn:{en:"Move to the last sibling node",chn:"移动到上一个节点"},mttfsn:{en:"Move to the first child node",chn:"移动到第一个节点"},mtfn:{en:"Move to Father Node",chn:"移动到父节点"},direckey:{en:"Direction Key",chn:"方向键"},servicetd:{en:"Send Feedback",chn:"我要给圆转天地提意见"},cbottc:{en:"Change background of the DiPan",chn:"更换地盘背景"},rbottc:{en:"Remove background of the DiPan",chn:"移除地盘背景"},icn:{en:"Insert child nodes",chn:"插入子节点"},addnodepic:{en:"Add Node Pictures",chn:"添加节点图片"},removepicture:{en:"Remove Pictures",chn:"移除图片"},emptynodetext:{en:"Empty Node Text",chn:"清空节点文本"},insertnodetianpan:{en:"Insert Nodes of TianPan",chn:"插入天盘节点"},inserttext:{en:"Insert Text",chn:"插入文本"},centerpicture:{en:"Center Pictures",chn:"居中图片"},ewah:{en:"Equal Width and Hight",chn:"等宽高"},bringtofront:{en:"Bring to Front",chn:"置于顶层"},bringtobottom:{en:"Bring to Bottom",chn:"置于底层"},bringforward:{en:"Bring Forward",chn:"上移一层"},fixnode:{en:"Fixed Nodes",chn:"固定节点"},cancelfix:{en:"Cancel Fixed",chn:"取消固定"},themecolor:{en:"Theme Colors",chn:"主题颜色"},standardcolor:{en:"Standard Colors",chn:"标准颜色"},webcolor:{en:"Web Colors",chn:"更多颜色"},backtop:{en:"Back to Palette",chn:"返回主题颜色"},history:{en:"History",chn:"历史"},nohistory:{en:"No history yet",chn:"暂无历史"},week:{en:"Week",chn:"最近一周"},Jan:{en:"January",chn:"一月"},Feb:{en:"February",chn:"二月"},Mar:{en:"March",chn:"三月"},Apr:{en:"April",chn:"四月"},May:{en:"May",chn:"五月"},Jun:{en:"June",chn:"六月"},Jul:{en:"July",chn:"七月"},Aug:{en:"August",chn:"八月"},Sep:{en:"September",chn:"九月"},Oct:{en:"October",chn:"十月"},Nov:{en:"November",chn:"十一月"},Dec:{en:"December",chn:"十二月"},insertimg:{en:"Insert Pictures",chn:"插入图片"},imglist:{en:"Pictures list",chn:"图片列表"},uploadimg:{en:"Upload Picture",chn:"上传图片"},katong:{en:"Cartoon Picture",chn:"卡通图片"},numbericon:{en:"Number Icons",chn:"数字图片"},qipao:{en:"Bubble",chn:"气泡"},custompic:{en:"Custom Picture",chn:"自定义图片"},picture:{en:"Picture",chn:"图片"},cancel:{en:"Cancel",chn:"取消"},ok:{en:"Ok",chn:"确定"},previewimg:{en:"Preview Pictures",chn:"预览图片"},copyimg:{en:"Copy Picture",chn:"复制图片"},copyimgsucces:{en:"Already Copy Picture Into Clipboard",chn:"成功复制图片到粘贴板"},dragtoupload:{en:"Drag to Upload Picture",chn:"拖拽到此处上传"},linkaddress:{en:"Link Address",chn:"链接地址"},insertremark:{en:"Insert Comment",chn:"插入备注"},insertlink:{en:"Insert Link",chn:"插入链接"},copy:{en:"copy",chn:"复制"},picdin:{en:"Picture definition",chn:"图片清晰度"},hsacc:{en:"Hierarchical Subject",chn:"天盘层级主题"},mtwtb:{en:"Bold Border Subject",chn:"天盘白字粗变主题"},officetheme:{en:"Office Subject",chn:"Office主题"},lctheme:{en:"Light-coloured Subject",chn:"浅色主题"},web2theme:{en:"web2.0 Subject",chn:"Web2.0主题"},metrotheme:{en:"Metro Subject",chn:"Metro主题"},retrotheme:{en:"Retro Subject",chn:"复古主题"},bustheme:{en:"Business Subject",chn:"商业主题"},hiet1:{en:"Hierachy Subject 1",chn:"层次主题1"},hiet2:{en:"Hierachy Subject 2",chn:"层次主题2"},eayth:{en:"Earlier Version Subject",chn:"旧版主题"},blankth:{en:"Pure-black Subject",chn:"纯黑色主题"},transthe:{en:"Transparent Subject",chn:"透明主题"},randomdipan:{en:"Random Subject of the DiPan",chn:"随机地盘主题"},radomcolor1:{en:"Random Colour 1",chn:"随机色彩1"},radomcolor2:{en:"Random Colour 1",chn:"随机色彩2"},mylocalfile:{en:"My local file",chn:"我的本地文件"},ut2c:{en:"Up to 20 characters",chn:"最多20个字符"},success:{en:"Success",chn:"成功"},danger:{en:"Fail",chn:"失败"},info:{en:"Info",chn:"提示"},strf:{en:"Save the file in:Menu->Open->Recently used file",chn:"文件保存在:菜单->打开->最近使用文件中"},netonffline:{en:"Network is not connected, commonly used template download failed",chn:"网络未连接，常用模板下载失败"},cantcheckver:{en:"The network is not connected, the version of the test failed",chn:"网络未连接，版本检测失败"},spacebar:{en:"Space bar",chn:"空格键"},supportmail:{en:"Support Mail",chn:"技术支持邮箱"},updatesuccess:{en:"Update sucess",chn:"更新成功"},blankText:{en:"Blank text",chn:"空白文本"},blockquote:{en:"Block Quote",chn:"引用"},bold:{en:"Bold",chn:"加粗文字"},code:{en:"Code",chn:"插入代码"},color:{en:"Text Color",chn:"文字颜色"},coloredText:{en:"Colored Text",chn:"彩色文字"},hr:{en:"Horizontal Line",chn:"分隔线"}},o(n,"image",{en:"Insert Image",chn:"插入图片"}),o(n,"externalImage",{en:"External Image",chn:"外链图片"}),o(n,"uploadImage",{en:"Upload Image",chn:"上传图片"}),o(n,"uploadFailed",{en:"Upload failed",chn:"上传失败了"}),o(n,"uploadError",{en:"Error occurs during upload",chn:"上传出错了"}),o(n,"imageUrl",{en:"Url",chn:"图片地址"}),o(n,"imageSize",{en:"Size",chn:"图片尺寸"}),o(n,"imageAlt",{en:"Alt",chn:"图片描述"}),o(n,"restoreImageSize",{en:"Restore Origin Size",chn:"还原图片尺寸"}),o(n,"uploading",{en:"Uploading",chn:"正在上传"}),o(n,"indent",{en:"Indent",chn:"向右缩进"}),o(n,"outdent",{en:"Outdent",chn:"向左缩进"}),o(n,"italic",{en:"Italic",chn:"斜体文字"}),o(n,"link",{en:"Insert Link",chn:"插入链接"}),o(n,"linkText",{en:"Text",chn:"链接文字"}),o(n,"linkUrl",{en:"Url",chn:"链接地址"}),o(n,"linkTarget",{en:"Target",chn:"打开方式"}),o(n,"openLinkInCurrentWindow",{en:"Open link in current window",chn:"在新窗口中打开"}),o(n,"openLinkInNewWindow",{en:"Open link in new window",chn:"在当前窗口中打开"}),o(n,"removeLink",{en:"Remove Link",chn:"移除链接"}),o(n,"ol",{en:"Ordered List",chn:"有序列表"}),o(n,"ul",{en:"Unordered List",chn:"无序列表"}),o(n,"strikethrough",{en:"Strikethrough",chn:"删除线文字"}),o(n,"table",{en:"Table",chn:"表格"}),o(n,"deleteRow",{en:"Delete Row",chn:"删除行"}),o(n,"insertRowAbove",{en:"Insert Row Above",chn:"在上面插入行"}),o(n,"insertRowBelow",{en:"Insert Row Below",chn:"在下面插入行"}),o(n,"deleteColumn",{en:"Delete Column",chn:"删除列"}),o(n,"insertColumnLeft",{en:"Insert Column Left",chn:"在左边插入列"}),o(n,"insertColumnRight",{en:"Insert Column Right",chn:"在右边插入列"}),o(n,"deleteTable",{en:"Delete Table",chn:"删除表格"}),o(n,"title",{en:"Title",chn:"标题"}),o(n,"normalText",{en:"Text",chn:"普通文本"}),o(n,"underline",{en:"Underline",chn:"下划线文字"}),o(n,"alignment",{en:"Alignment",chn:"水平对齐"}),o(n,"alignCenter",{en:"Align Center",chn:"居中"}),o(n,"alignLeft",{en:"Align Left",chn:"居左"}),o(n,"alignRight",{en:"Align Right",chn:"居右"}),o(n,"selectLanguage",{en:"Select Language",chn:"选择程序语言"}),o(n,"fontScale",{en:"Font Size",chn:"字体大小"}),o(n,"fontScaleXLarge",{en:"X Large Size",chn:"超大字体"}),o(n,"fontScaleLarge",{en:"Large Size",chn:"大号字体"}),o(n,"fontScaleNormal",{en:"Normal Size",chn:"正常大小"}),o(n,"fontScaleSmall",{en:"Small Size",chn:"小号字体"}),o(n,"fontScaleXSmall",{en:"X Small Size",chn:"超小字体"}),o(n,"savesuccess",{en:"Save successful",chn:"保存成功"}),o(n,"failsuccess",{en:"Save failed",chn:"保存失败"}),o(n,"layoutmode",{en:"Layout Mode",chn:"布局方式"}),o(n,"outequaldivid",{en:"Divided by the last layer",chn:"外圈均分"}),o(n,"innerequaldivid",{en:"Divided by the first layer",chn:"内圈均分"}),o(n,"givenlayer",{en:"Designate",chn:"指定层均分"}),o(n,"textdirection",{en:"Text Direction",chn:"文字方向"}),o(n,"textrotate",{en:"Rotate",chn:"旋转"}),o(n,"textoutside",{en:"Toward the outside",chn:"放射"}),o(n,"upwards",{en:"Upwards",chn:"正向"}),o(n,"sectorthickness",{en:"Sector thickness",chn:"扇区宽度"}),o(n,"thicknessrange",{en:"Range 100~300",chn:"范围 100~300"}),o(n,"currentfile",{en:"Current File",chn:"编辑中"}),o(n,"uploadsuccess",{en:"Upload successful",chn:"上传成功"}),o(n,"deletenodeinfo",{en:"Are you sure to delete the node and its child nodes?",chn:"删除节点会删除它的所有子节点，确实要删除吗？"}),o(n,"exporttdp",{en:"Save as .tdp shared file",chn:"另存为.tdp共享文件"}),o(n,"hypertype",{en:"Type",chn:"链接类型"}),o(n,"url",{en:"URL",chn:"网址"}),o(n,"localfile",{en:"Local file",chn:"本地文件"}),o(n,"tiandipan",{en:"Tianpan or Dipan",chn:"天地盘"}),o(n,"link",{en:"Hyperlink",chn:"链接"}),o(n,"outlineeditor",{en:"Outline Editor",chn:"大纲编辑"}),o(n,"modificationbuttons",{en:"Modification Buttons",chn:"修改按钮"}),o(n,"browsingbuttons",{en:"Browsing Buttons",chn:"浏览按钮"}),o(n,"show",{en:"Show",chn:"显示"}),o(n,"hide",{en:"Hide",chn:"隐藏"}),o(n,"newnode",{en:"New Node",chn:"新节点"}),o(n,"moveupnode",{en:"Move up",chn:"上移节点"}),o(n,"movedownnode",{en:"Move down",chn:"下移节点"}),o(n,"removenode",{en:"Remove",chn:"删除节点"}),o(n,"editnode",{en:"Edit Node",chn:"编辑节点"}),o(n,"prevnode",{en:"Select Previous",chn:"上一个节点"}),o(n,"nextnode",{en:"Select Next",chn:"下一个节点"}),o(n,"expandnode",{en:"Expand",chn:"展开节点"}),o(n,"collapsenode",{en:"Collapse",chn:"折叠节点"}),o(n,"expandall",{en:"Expand All",chn:"全部展开"}),o(n,"collapseall",{en:"Collapse All",chn:"全部折叠"}),o(n,"preview",{en:"Preview",chn:"预览"}),o(n,"cancel",{en:"Cancel",chn:"取消"}),o(n,"apply",{en:"Apply",chn:"应用"}),o(n,"openpreviewimg",{en:"Preview image is loading",chn:"正在打开预览图片"}),o(n,"tempnodetips",{en:"This is a temp node",chn:"这是临时节点"}),o(n,"buildtdp",{en:"Build .tdp shared file",chn:"生成.tdp文件下载"}),o(n,"deleteconfirm",{en:"Are you sure to clear all the nodes?",chn:"确定要清空节点？"}),o(n,"selecttargertnode",{en:"Select Target Node",cn:"请选择目标节点"}),o(n,"link2web",{en:"Link to Webpage",cn:"链接网页"}),o(n,"link2node",{en:"Link to Node",cn:"链接节点"}),o(n,"removelink",{en:"Remove Link",cn:"移除节点"}),o(n,"addtemp",{en:"Add Template",cn:"添加模板"}),o(n,"buildtdp",{en:"Build .tdp shared file",chn:"生成.tdp文件下载"}),o(n,"deleteconfirm",{en:"Are you sure to clear all the nodes?",chn:"确定要清空节点？"}),o(n,"success",{en:"Success",chn:"成功"}),o(n,"warning",{en:"Warning",chn:"警告"}),o(n,"error",{en:"Failed",chn:"失败"}),o(n,"unsupportfile",{en:"Unsupported File!",cn:"不支持该导入文件"}),n),i=function(e){return r[e]?r[e][localStorage.getItem("language")]?r[e][localStorage.getItem("language")]:r[e].chn:e};t.default={trans:i},e.exports=t.default},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=["dipan","tianpan"];console.log("typeList:",n);var r={};r.tianpan=a(4),r.dipan=a(36),r.jin=a(37),r.huo=a(38),r.shui=a(39),r.yunpan=a(40),r.wheel=a(41),r.dspiral=a(42);var i=function e(t,a){o(this,e);try{if(a.model){var n=go.Model.fromJson(a.model);n&&n.modelData&&n.modelData.type&&(a.type=n.modelData.type)}}catch(e){console.error(e)}return console.log("type:",a.type),new(0,r[a.type])(t,a)};i.go=go,i.version="0.0.1",console.info("Trtd version:"+i.version),"undefined"!=typeof window&&(window.Trtd=i),t.default=i,e.exports=t.default},function(e,t,a){"use strict";function o(){go.Layout.call(this),this._radius=NaN,this._spacing=10,this._clockwise=!0,this._pointlist=[]}function n(e,t){var a=Math.cos(t),o=Math.sin(t),n=e*(a+t*o),r=e*(o-t*a);return new go.Point(n,r)}function r(e,t){for(var a=!1,o=t.iterator;o.next();)if(Math.sqrt(e.point.distanceSquaredPoint(o.value.point))<e.radius+o.value.radius){a=!0;break}return a}Object.defineProperty(t,"__esModule",{value:!0});go.GraphObject.make;go.Diagram.inherit(o,go.Layout),o.prototype.cloneProtected=function(e){go.Layout.prototype.cloneProtected.call(this,e),e._radius=this._radius,e._spacing=this._spacing,e._clockwise=this._clockwise},o.prototype.doLayout=function(e){null===this.network&&(this.network=this.makeNetwork(e));for(var t,a=null,o=!1,i=this.network.vertexes.iterator,d=[];i.next();)t=i.value,o?0===t.sourceEdges.count&&d.push(t):(null===a&&(a=t),0===t.sourceEdges.count&&(a=t,o=!0));if(null===a)return void(this.network=null);var l,c,s,g,u,p,m,f,h,y,v,k,w,b=this.clockwise?1:-1,T=2.5,x=(null==window.localStorage.getItem("isautolayout")||window.localStorage.getItem("isautolayout"),!0),S=0,P=new go.List,D=150;D=150;var _;g=a.destinationEdges.first(),c=null!==g?g.toVertex:null,a.node.rad=l;for(var B=0,N=!1;null!==c;)B++,c.node.data.isGroup&&(N=!0),f=c.destinationEdges.first(),h=null!==f?f.toVertex:null,g=f,c=h;g=a.destinationEdges.first(),c=null!==g?g.toVertex:null,l=1;var O;if(c){_=c.node.actualBounds.width;for(var A=a.node.actualBounds.width/2+c.node.actualBounds.width/2;;){if(O=n(l,5),O=new go.Point(O.x+a.node.location.x,O.y+a.node.location.y),Math.sqrt(O.distanceSquaredPoint(a.node.location))>A+10)break;l+=.1}}for(var C=0;x;){S++,T=5,g=a.destinationEdges.first(),a.node.data.angle=0,null!==g&&null!==g.link&&(g.link.curviness=b*l);null==g||g.link.curviness;c=null!==g?g.toVertex:null,u=a,p=0;for(0,0,c&&(c.node.data.angle=T),P.clear(),P.add({point:a.node.location,radius:a.node.actualBounds.width/2}),w=Math.sqrt(n(l,5*Math.PI/2).distanceSquaredPoint(n(l,5*Math.PI/2-.7)));null!==c;){p++,a.node.data.rad=l,.4,T;for(var W=0;W<=20;W++){if(v=n(l,T),v=new go.Point(v.x+a.node.location.x,v.y+a.node.location.y),v.x,v.y,c.node instanceof go.Group&&g.link.toNode!==c.node){var M=g.link.toNode.location.copy().subtract(c.node.location);v.x-=M.x,v.y-=M.y}if(_=c.node.actualBounds.width/2,y={point:v,radius:_},!(s=r(y,P)))break;if(C++,T>=u.node.data.angle+Math.PI/2){T=u.node.data.angle+Math.PI/2;break}T=u.node.data.angle+(W+1)*Math.PI/16,m=b*Math.atan((c.node.actualBounds.width/2+u.node.actualBounds.width/2+D)/Math.sqrt(c.node.location.distanceSquaredPoint(a.node.location))),T<=u.node.data.angle+m&&(T=u.node.data.angle+m)}if(s){l+=1;break}f=c.destinationEdges.first(),h=null!==f?f.toVertex:null,c.centerX=v.x,c.centerY=v.y,c.node.data.angle=T,g.link.data.unautoLink=!1,g.link.rad=l,g.link.angle1=u.node.data.angle,g.link.angle2=c.node.data.angle;var L=!1;B<=6?1.3*B<3*Math.PI/2&&!N?T+=Math.min(3*Math.PI/2/B,Math.PI/2):c.node.data.isGroup?L=!0:T+=1.3:L=!0,L&&(null==h?(k=w,m=b*Math.atan((k+D)/Math.sqrt(v.distanceSquaredPoint(a.node.location)))):(k=Math.max(w,c.node.actualBounds.width/2+h.node.actualBounds.width/2),m=b*Math.atan((k+D)/Math.sqrt(v.distanceSquaredPoint(a.node.location)))),T+=m),_=c.node.actualBounds.width,P.add(y),g=f,u=c,c=h}null==c&&(x=!1)}this.updateParts(),this.network=null},o.prototype.commitLayout=function(){this.network.vertexes.each(function(e){e.commit()}),this.network.edges.each(function(e){e.commit()})},o.prototype.diameter=function(e){if(!e)return 0;var t=e.bounds;return Math.sqrt(t.width*t.width/4+t.height*t.height/4)},Object.defineProperty(o.prototype,"radius",{get:function(){return this._radius},set:function(e){if("number"!=typeof e)throw new Error("new value for SpiralLayout.radius must be a number, not: "+e);this._radius!==e&&(this._radius=e,this.invalidateLayout())}}),Object.defineProperty(o.prototype,"spacing",{get:function(){return this._spacing},set:function(e){if("number"!=typeof e)throw new Error("new value for SpiralLayout.spacing must be a number, not: "+e);this._spacing!==e&&(this._spacing=e,this.invalidateLayout())}}),Object.defineProperty(o.prototype,"clockwise",{get:function(){return this._clockwise},set:function(e){if("boolean"!=typeof e)throw new Error("new value for SpiralLayout.clockwise must be a boolean, not: "+e);this._clockwise!==e&&(this._clockwise=e,this.invalidateLayout())}}),t.default=o,e.exports=t.default},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=a(8),l=go.GraphObject.make,c=a(1),s=a(0),g=function(e){function t(e){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),i(t,[{key:"makeGeo",value:function(e,t,a){var o=e.radiusX,n=void 0===o?150:o,r=e.radiusY,i=void 0===r?100:r;n=t.part.findObject("main").width/2,i=t.part.findObject("main").height/2;var d=(new go.Geometry).add(new go.PathFigure(0,0).add(new go.PathSegment(go.PathSegment.SvgArc,2*n,0,n,i,0,1,a.clockwiseFlag?1:0)));return d.defaultStretch=go.GraphObject.Fill,d}},{key:"makeGeoWave",value:function(e,t,a){var o=e.radiusX,n=void 0===o?150:o,r=e.radiusY,i=void 0===r?100:r;n=t.part.findObject("main").width/2,i=t.part.findObject("main").height/2;var d=new go.PathSegment(go.PathSegment.QuadraticBezier,2*n,0,n,i*(a.clockwiseFlag?-1:1));"waveTail"==e.role&&(d=new go.PathSegment(go.PathSegment.QuadraticBezier,n,i*(a.clockwiseFlag?-1:1),n/2,i*(a.clockwiseFlag?-1:1)));var l=(new go.Geometry).add(new go.PathFigure(0,0).add(d));return l.defaultStretch=go.GraphObject.None,l}},{key:"getShiHalfEllipseShape",value:function(){var e=this;return l(go.Shape,{name:"XU",strokeWidth:2,stroke:"#cb1c27",fill:"rgba(0,66,0,0)",stretch:go.GraphObject.Uniform,alignment:go.Spot.Bottom,alignmentFocus:go.Spot.Bottom},new go.Binding("geometry","",function(t,a){var o=0;return t.order%2==0&&(o=1),t.flip,"Ellipse"==t.oliveType?e.makeGeo(t,a,{clockwiseFlag:o}):e.makeGeoWave(t,a,{clockwiseFlag:o})}),new go.Binding("stroke","shiStroke").makeTwoWay(),new go.Binding("strokeWidth","shiStrokeWidth").makeTwoWay(),new go.Binding("strokeDashArray","shiStrokeDashArray",function(e){return JSON.parse(e)}).makeTwoWay(function(e){return JSON.stringify(e)}),new go.Binding("desiredSize","desiredSize",function(e){return new go.Size(e.width,e.height/2)}).ofObject("main"))}},{key:"getXuHalfEllipseShape",value:function(){var e=this;return l(go.Shape,{name:"SHI",strokeWidth:2,stroke:"#0e399d",fill:"rgba(0,66,0,0)",stretch:go.GraphObject.Uniform,alignment:go.Spot.Bottom,strokeDashArray:[10,5],alignmentFocus:go.Spot.Bottom},new go.Binding("geometry","",function(t,a){var o=1;return t.order%2==0&&(o=0),"Ellipse"==t.oliveType?e.makeGeo(t,a,{clockwiseFlag:o}):e.makeGeoWave(t,a,{clockwiseFlag:o})}),new go.Binding("stroke","xuStroke").makeTwoWay(),new go.Binding("strokeWidth","xuStrokeWidth").makeTwoWay(),new go.Binding("strokeDashArray","xuStrokeDashArray",function(e){return JSON.parse(e)}).makeTwoWay(function(e){return JSON.stringify(e)}),new go.Binding("desiredSize","desiredSize",function(e){return new go.Size(e.width,e.height/2)}).ofObject("main"))}},{key:"getTailShiShape",value:function(){var e=this;return l(go.Shape,{name:"XU",strokeWidth:2,stroke:"#cb1c27",fill:"rgba(0,66,0,0)",stretch:go.GraphObject.None,alignment:go.Spot.Bottom,alignmentFocus:go.Spot.Bottom},new go.Binding("geometry","",function(t,a){var o=0;return t.order%2==0&&(o=1),t.flip,e.makeGeoWave(t,a,{clockwiseFlag:!o})}),new go.Binding("stroke","shiStroke").makeTwoWay(),new go.Binding("desiredSize","desiredSize",function(e){return new go.Size(e.width,e.height/2)}).ofObject("main"))}},{key:"getTailXuShape",value:function(){var e=this;return l(go.Shape,{name:"TailXu",strokeWidth:2,stroke:"#0e399d",fill:"rgba(0,66,0,0)",stretch:go.GraphObject.None,alignment:go.Spot.Bottom,strokeDashArray:[10,5],alignmentFocus:go.Spot.Bottom},new go.Binding("geometry","",function(t,a){var o=1;return t.order%2==0&&(o=0),e.makeGeoWave(t,a,{clockwiseFlag:!o})}),new go.Binding("desiredSize","desiredSize",function(e){return new go.Size(e.width,e.height/2)}).ofObject("main"))}},{key:"getTextBuild",value:function(){return l(go.TextBlock,{name:"TEXT",alignment:new go.Spot(.5,.4),font:"18px 'Microsoft YaHei'",editable:!1,angle:0,stroke:"black",isMultiline:!0,textEdited:function(e,t,a){var o=e.part.diagram.model.findNodeDataForKey(e.part.data.centerText);o&&(console.log("centerTextcenterTextcenterTextcenterText"),e.part.diagram.model.startTransaction("text"),e.part.diagram.model.setDataProperty(o,"text",a),e.part.diagram.model.commitTransaction("text")),(0,d.setTimeout)(function(){if(console.log("textEditedtextEditedtextEdited",e.lineCount),e.text&&(!e.text||""!=e.text.trim())&&e.lineCount%2!=0){if("\n"==a[a.length-1])return void(e.text=a.substring(0,a.length-1));e.text=a+"\n"}},100);e.part.containingGroup.layout.isValidLayout=!1},overflow:go.TextBlock.OverflowClip,wrap:go.TextBlock.WrapDesiredSize,textAlign:"center",spacingAbove:4,spacingBelow:4,portId:"TEXT",stretch:go.GraphObject.Uniform},new go.Binding("visible","textVisible").makeTwoWay(),new go.Binding("alignment","",function(e,t){return new go.Spot(.5,.5)}),new go.Binding("textAlign","textAlign",function(e){return e}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return s.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return s.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("width","width",function(e){return e-30}).ofObject("main"),new go.Binding("text","text",function(e,t){return e}).makeTwoWay(function(e,t){return console.log("text write write",t.lineCount),e}),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay())}},{key:"getNodeSelectionAdornmentTemplate",value:function(){return l(go.Adornment,"Spot",{},l(go.Panel,"Auto",l(go.Shape,{isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}),l(go.Placeholder)),l("CircleButton",{name:"AddChild",toolTip:l(go.Adornment,"Auto",l(go.Shape,{fill:"#FFFFCC"}),l(go.TextBlock,{textAlign:"center",margin:new go.Margin(8,4,4,4)},new go.Binding("text","",function(e){return"增加橄榄"}))),alignment:go.Spot.Right,alignmentFocus:go.Spot.Left,width:50,height:50,click:function(e){e.diagram.__trtd.addOlive()}},l(go.Shape,"PlusLine",{stroke:"#770077",desiredSize:new go.Size(25,25)})),l("Button",{name:"AddLevel",toolTip:l(go.Adornment,"Auto",l(go.Shape,{fill:"#FFFFCC"}),l(go.TextBlock,{textAlign:"center",margin:new go.Margin(8,4,4,4)},new go.Binding("text","",function(e){return"增加同级节点"}))),alignment:new go.Spot(1,.5,15,0),width:30,height:30,click:function(e){e.diagram.__trtd.addOlive()}},l(go.Shape,"PlusLine",{stroke:"#227700",desiredSize:new go.Size(15,15)}),new go.Binding("visible","level",function(e){return 0!=e})))}},{key:"nodeResizeAdornmentTemplate",value:function(){return l(go.Adornment,"Spot",l(go.Placeholder),l(go.Shape,"Circle",{alignment:go.Spot.BottomRight,alignmentFocus:go.Spot.TopLeft,cursor:"col-resize",desiredSize:new go.Size(30,30),fill:"lightblue",stroke:"dodgerblue"}))}},{key:"getNodeTemplate",value:function(){var e=(this.diagram,this);return l(go.Node,"Spot",{__trtdNode:e,layerName:"overflow",zOrder:5,movable:!0,resizable:!1,resizeObjectName:"main",selectionObjectName:"main",rotatable:!1,resizeAdornmentTemplate:e.nodeResizeAdornmentTemplate(),layoutConditions:~go.Part.LayoutStandard&go.Part.LayoutRemoved&go.Part.LayoutAdded&go.Part.LayoutNodeSized,locationSpot:go.Spot.LeftCenter,click:function(e,t){if(console.log(t.data),t.containingGroup)for(var a=t.containingGroup.findSubGraphParts().iterator;a.next();){var o=a.value;"autoText"!=o.data.category||"xuText"!=o.data.role&&"shiText"!=o.data.role||(o.data.order==t.data.order?""!=o.data.text&&""!=o.data.text.trim()||(o.findObject("textBorder").visible=!0):o.findObject("textBorder").visible=!1)}},mouseOver:function(e,t){if(t.containingGroup){var a=t.diagram.findNodeForKey(t.data.shiText);a&&(a.findObject("textBorder").visible=!0);var o=t.diagram.findNodeForKey(t.data.xuText);o&&(o.findObject("textBorder").visible=!0);var n=t.diagram.findNodeForKey(t.data.centerText);n&&(n.layerName="Background")}},contextMenu:l(go.Adornment),mouseDragEnter:function(e,t){var a=t.part,o=e.diagram.selection.first();if("wave"==o.data.category||"picGroup"==o.data.category&&"cbian"==o.data.role){var n=a.diagram.findNodeForKey(a.data.centerText);n&&(n.layerName="Background");var r=a.findObject("main");r&&(r._prevFill=r.fill,r.fill="RGBA(146,208,80,0.5)")}},mouseDragLeave:function(e,t){var a=t.part,o=a.findObject("main");o&&o._prevFill&&(o.fill=o._prevFill);var n=a.diagram.findNodeForKey(a.data.centerText);n&&(s.checkPhone()||(n.layerName="Foreground"))},mouseDrop:function(e,t){var a=t.part;console.log("mouseDropmouseDropmouseDropmouseDrop");var o=e.diagram.selection.first();if(o){if("picGroup"==o.data.category&&"cbian"==o.data.role){for(var n=o.findSubGraphParts().iterator,r=[],i={};n.next();){var d=n.value;"autoText"==d.data.category&&("0 0 0 0"==d.data.locationSpot&&(i.shiText=d.data.text),"0 0.5 0 0"==d.data.locationSpot&&(i.centerText=d.data.text),"0 1 0 0"==d.data.locationSpot&&(i.xuText=d.data.text)),r.push(d.data)}e.diagram.startTransaction("mouseDrop"),e.diagram.model.removeNodeDataCollection(r);JSON.parse(JSON.stringify(o.data));return e.diagram.model.removeNodeData(o.data),e.diagram.__trtd.addOlive(a,i),void e.diagram.commitTransaction("mouseDrop")}if("wave"==o.data.category&&a&&o.data.group==t.data.group){e.diagram.startTransaction("mouseDrop"),o.__oldOrder=o.data.order,e.diagram.model.setDataProperty(o.data,"order",a.data.order+.5);var l=e.diagram.findNodeForKey(o.data.xuText),c=e.diagram.findNodeForKey(o.data.shiText);return e.diagram.model.setDataProperty(c,"order",a.data.order+.5),e.diagram.model.setDataProperty(l,"order",a.data.order+.5),void e.diagram.commitTransaction("mouseDrop")}}},mouseLeave:function(e,t){if(t.containingGroup){for(var a=t.containingGroup.findSubGraphParts().iterator;a.next();){var o=a.value;"autoText"==o.data.category&&(o.findObject("textBorder").visible=!1)}try{var n=e.diagram.findNodeForKey(t.data.centerText);n&&(n.layerName="Foreground")}catch(e){console.error("wave node template error:",e)}}},selectionAdornmentTemplate:this.getNodeSelectionAdornmentTemplate(),doubleClick:function(e,t){if(t&&t.containingGroup){if("horizontal"==t.containingGroup.data.textAngle&&"independent"==t.containingGroup.data.centerTextAngle){t.findObject("TEXT").visible=!0;var a=t.diagram.findNodeForKey(t.data.centerText);a&&(a.visible=!1)}(0,d.setTimeout)(function(){e.diagram.__trtd.selectText(e,t)},100)}}},this.binding,l(go.Shape,"Rectangle",{name:"main",fill:"rgba(0,0,0,0)",stroke:null,width:300,height:150},new go.Binding("fill","fill").makeTwoWay(),new go.Binding("desiredSize","desiredSize",function(e,t){return go.Size.parse(e)}).makeTwoWay(function(e){return go.Size.stringify(e)})),this.getShiHalfEllipseShape(),this.getXuHalfEllipseShape(),this.getTextBuild())}}]),t}(c);e.exports=g},function(e,t,a){(function(e,t){!function(e,a){"use strict";function o(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),a=0;a<t.length;a++)t[a]=arguments[a+1];var o={callback:e,args:t};return c[l]=o,d(l),l++}function n(e){delete c[e]}function r(e){var t=e.callback,o=e.args;switch(o.length){case 0:t();break;case 1:t(o[0]);break;case 2:t(o[0],o[1]);break;case 3:t(o[0],o[1],o[2]);break;default:t.apply(a,o)}}function i(e){if(s)setTimeout(i,0,e);else{var t=c[e];if(t){s=!0;try{r(t)}finally{n(e),s=!1}}}}if(!e.setImmediate){var d,l=1,c={},s=!1,g=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?function(){d=function(e){t.nextTick(function(){i(e)})}}():function(){if(e.postMessage&&!e.importScripts){var t=!0,a=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=a,t}}()?function(){var t="setImmediate$"+Math.random()+"$",a=function(a){a.source===e&&"string"==typeof a.data&&0===a.data.indexOf(t)&&i(+a.data.slice(t.length))};e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),d=function(a){e.postMessage(t+a,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){i(e.data)},d=function(t){e.port2.postMessage(t)}}():g&&"onreadystatechange"in g.createElement("script")?function(){var e=g.documentElement;d=function(t){var a=g.createElement("script");a.onreadystatechange=function(){i(t),a.onreadystatechange=null,e.removeChild(a),a=null},e.appendChild(a)}}():function(){d=function(e){setTimeout(i,0,e)}}(),u.setImmediate=o,u.clearImmediate=n}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,a(13),a(19))},function(e,t){function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function n(e){if(s===setTimeout)return setTimeout(e,0);if((s===a||!s)&&setTimeout)return s=setTimeout,setTimeout(e,0);try{return s(e,0)}catch(t){try{return s.call(null,e,0)}catch(t){return s.call(this,e,0)}}}function r(e){if(g===clearTimeout)return clearTimeout(e);if((g===o||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(e);try{return g(e)}catch(t){try{return g.call(null,e)}catch(t){return g.call(this,e)}}}function i(){f&&p&&(f=!1,p.length?m=p.concat(m):h=-1,m.length&&d())}function d(){if(!f){var e=n(i);f=!0;for(var t=m.length;t;){for(p=m,m=[];++h<t;)p&&p[h].run();h=-1,t=m.length}p=null,f=!1,r(e)}}function l(e,t){this.fun=e,this.array=t}function c(){}var s,g,u=e.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:a}catch(e){s=a}try{g="function"==typeof clearTimeout?clearTimeout:o}catch(e){g=o}}();var p,m=[],f=!1,h=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];m.push(new l(e,t)),1!==m.length||f||n(d)},l.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=c,u.addListener=c,u.once=c,u.off=c,u.removeListener=c,u.removeAllListeners=c,u.emit=c,u.prependListener=c,u.prependOnceListener=c,u.listeners=function(e){return[]},u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=go.GraphObject.make,l=a(1),c=a(0),s=function(e){function t(e){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),i(t,[{key:"makeGeo",value:function(e,t,a){var o=e.radiusX,n=void 0===o?150:o,r=e.radiusY,i=void 0===r?100:r;n=t.part.findObject("main").width/2,i=t.part.findObject("main").height/2;var d=(new go.Geometry).add(new go.PathFigure(0,0).add(new go.PathSegment(go.PathSegment.SvgArc,2*n,0,n,i,0,1,a.clockwiseFlag?1:0)));return d.defaultStretch=go.GraphObject.Fill,d}},{key:"makeGeoWave",value:function(e,t,a){var o=e.radiusX,n=void 0===o?150:o,r=e.radiusY,i=void 0===r?100:r;n=t.part.findObject("main").width/2,i=t.part.findObject("main").height/2;var d=(new go.Geometry).add(new go.PathFigure(0,0).add(new go.PathSegment(go.PathSegment.QuadraticBezier,2*n,0,n,i*(a.clockwiseFlag?-1:1))));return d.defaultStretch=go.GraphObject.Fill,d}},{key:"getShiHalfEllipseShape",value:function(){var e=this;return d(go.Shape,{name:"XU",strokeWidth:2,stroke:"#cb1c27",fill:"rgba(0,66,0,0)",stretch:go.GraphObject.Uniform,alignment:go.Spot.Bottom,alignmentFocus:go.Spot.Bottom},new go.Binding("geometry","",function(t,a){var o=0;return t.order%2==0&&(o=1),t.flip,e.makeGeoWave(t,a,{clockwiseFlag:o})}),new go.Binding("stroke","shiStroke").makeTwoWay(),new go.Binding("desiredSize","desiredSize",function(e){return new go.Size(e.width,e.height/2)}).ofObject("main"))}},{key:"getXuHalfEllipseShape",value:function(){var e=this;return d(go.Shape,{name:"SHI",strokeWidth:2,stroke:"#0e399d",fill:"rgba(0,66,0,0)",stretch:go.GraphObject.Uniform,alignment:go.Spot.Bottom,strokeDashArray:[10,5],alignmentFocus:go.Spot.Bottom},new go.Binding("geometry","",function(t,a){var o=1;return t.order%2==0&&(o=0),e.makeGeoWave(t,a,{clockwiseFlag:o})}),new go.Binding("desiredSize","desiredSize",function(e){return new go.Size(e.width,e.height/2)}).ofObject("main"))}},{key:"getTailShiShape",value:function(){var e=this;return d(go.Shape,{name:"XU",strokeWidth:2,stroke:"#cb1c27",fill:"rgba(0,66,0,0)",stretch:go.GraphObject.None,alignment:go.Spot.Bottom,alignmentFocus:go.Spot.Bottom},new go.Binding("geometry","",function(t,a){var o=0;return t.order%2==0&&(o=1),t.flip,e.makeGeoWave(t,a,{clockwiseFlag:!o})}),new go.Binding("stroke","shiStroke").makeTwoWay(),new go.Binding("desiredSize","desiredSize",function(e){return new go.Size(e.width,e.height/2)}).ofObject("main"))}},{key:"getTailXuShape",value:function(){var e=this;return d(go.Shape,{name:"TailXu",strokeWidth:2,stroke:"#0e399d",fill:"rgba(0,66,0,0)",stretch:go.GraphObject.None,alignment:go.Spot.Bottom,strokeDashArray:[10,5],alignmentFocus:go.Spot.Bottom},new go.Binding("geometry","",function(t,a){var o=1;return t.order%2==0&&(o=0),e.makeGeoWave(t,a,{clockwiseFlag:!o})}),new go.Binding("desiredSize","desiredSize",function(e){return new go.Size(e.width,e.height/2)}).ofObject("main"))}},{key:"getTextBuild",value:function(){return d(go.TextBlock,{name:"TEXT",alignment:new go.Spot(.5,.4),font:"18px 'Microsoft YaHei'",editable:!1,stroke:"black",isMultiline:!0,overflow:go.TextBlock.OverflowClip,wrap:go.TextBlock.WrapDesiredSize,textAlign:"center",spacingAbove:4,spacingBelow:4,portId:"TEXT",stretch:go.GraphObject.Uniform},new go.Binding("textAlign","textAlign",function(e){return["start","center","end"].indexOf(e)>-1?e:"center"}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return c.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return c.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("width","width",function(e){return e-30}).ofObject("main"),new go.Binding("text","text").makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay())}},{key:"getNodeSelectionAdornmentTemplate",value:function(){return d(go.Adornment,"Spot",{},d(go.Panel,"Auto",d(go.Shape,{isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}),d(go.Placeholder)),d("CircleButton",{name:"AddChild",toolTip:d(go.Adornment,"Auto",d(go.Shape,{fill:"#FFFFCC"}),d(go.TextBlock,{textAlign:"center",margin:new go.Margin(8,4,4,4)},new go.Binding("text","",function(e){return"增加橄榄"}))),alignment:go.Spot.Right,alignmentFocus:go.Spot.Left,width:50,height:50,click:function(e){e.diagram.__trtd.addOlive()}},d(go.Shape,"PlusLine",{stroke:"#770077",desiredSize:new go.Size(25,25)})),d("Button",{name:"AddLevel",toolTip:d(go.Adornment,"Auto",d(go.Shape,{fill:"#FFFFCC"}),d(go.TextBlock,{textAlign:"center",margin:new go.Margin(8,4,4,4)},new go.Binding("text","",function(e){return"增加同级节点"}))),alignment:new go.Spot(1,.5,15,0),width:30,height:30,click:function(e){e.diagram.__trtd.addOlive()}},d(go.Shape,"PlusLine",{stroke:"#227700",desiredSize:new go.Size(15,15)}),new go.Binding("visible","level",function(e){return 0!=e})))}},{key:"getNodeTemplate",value:function(){this.diagram;return d(go.Node,"Spot",{layerName:"default",zOrder:5,movable:!1,resizable:!1,resizeObjectName:"main",selectionObjectName:"main",rotatable:!1,layoutConditions:go.Part.LayoutStandard&go.Part.LayoutRemoved&go.Part.LayoutAdded&go.Part.LayoutNodeSized,locationSpot:go.Spot.LeftCenter,toolTip:d("ToolTip",d(go.TextBlock,{margin:4},new go.Binding("text","",function(e,t){var a=["双击编辑文字","尝试按方向键快捷移动到下一个对象"];return a[Math.floor(a.length*Math.random())]}))),click:function(e,t){console.log(t.data)},mouseOver:function(e,t){if(t.containingGroup)for(var a=t.containingGroup.findSubGraphParts().iterator;a.next();){var o=a.value;"autoText"==o.data.category&&o.data.order==t.data.order&&(o.findObject("textBorder").visible=!0)}},contextMenu:d(go.Adornment),mouseLeave:function(e,t){if(t.containingGroup)for(var a=t.containingGroup.findSubGraphParts().iterator;a.next();){var o=a.value;"autoText"==o.data.category&&(o.findObject("textBorder").visible=!1)}},selectionAdornmentTemplate:this.getNodeSelectionAdornmentTemplate(),doubleClick:function(e,t){e.diagram.__trtd.selectText(e,t)}},this.binding,d(go.Shape,"Ellipse",{name:"main",fill:"rgba(0,0,0,0)",stroke:null,width:300,height:150},new go.Binding("fill","fill").makeTwoWay(),new go.Binding("desiredSize","desiredSize",function(e,t){return go.Size.parse(e)}).makeTwoWay(function(e){return go.Size.stringify(e)})),this.getShiHalfEllipseShape(),this.getXuHalfEllipseShape(),this.getTextBuild())}}]),t}(l);e.exports=s},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=go.GraphObject.make,l=a(1),c=(a(0),a(10)),s=function(e){function t(e){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),i(t,[{key:"nodeResizeAdornmentTemplate",value:function(){return d(go.Adornment,"Spot",d(go.Placeholder),d(go.Shape,"Circle",{alignment:go.Spot.BottomRight,alignmentFocus:go.Spot.TopLeft,cursor:"col-resize",desiredSize:new go.Size(30,30),fill:"lightblue",stroke:"dodgerblue"}))}},{key:"getNodeTemplate",value:function(){var e=this;return d(go.Group,"Spot",{selectionObjectName:"PH",layerName:"default",locationObjectName:"PH",resizeObjectName:"PH",resizable:!0,locationSpot:go.Spot.LeftCenter,alignment:go.Spot.Left,alignmentFocus:go.Spot.Left,click:function(e,t){console.log(t.data);for(var a=t.findSubGraphParts().iterator;a.next();){var o=a.value;"autoText"==o.data.category&&(o.findObject("textBorder").visible=!1)}},selectionAdornmentTemplate:this.getNodeSelectionAdornmentTemplate(),resizeAdornmentTemplate:e.nodeResizeAdornmentTemplate(),mouseOver:function(e,t){console.log("group.......................");for(var a=t.findSubGraphParts().iterator;a.next();){var o=a.value;"autoText"!=o.data.category||"xuText"!=t.data.role&&"shiText"!=t.data.role||""!=o.data.text&&""!=o.data.text.trim()||(o.findObject("textBorder").visible=!0)}},mouseLeave:function(e,t){for(var a=t.findSubGraphParts().iterator;a.next();){var o=a.value;"autoText"==o.data.category&&(o.findObject("textBorder").visible=!1)}},rotatable:!0,contextMenu:d(go.Adornment),layoutConditions:go.Part.LayoutStandard&go.Part.LayoutRemoved&go.Part.LayoutAdded&go.Part.LayoutNodeSized,layout:new c},new go.Binding("angle","angle").makeTwoWay(function(e,t){return e}),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("deletable","deletable").makeTwoWay(),d(go.Shape,{name:"PH",figure:"Rectangle",alignment:new go.Spot(0,.5),stroke:"#9aa8b6",strokeWidth:0,minSize:new go.Size(300,70),maxSize:new go.Size(NaN,400),fill:"rgba(88,0,0,0)"},new go.Binding("desiredSize","desiredSize",function(e,t){return go.Size.parse(e)}).makeTwoWay(go.Size.stringify)),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify))}}]),t}(l);e.exports=s},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=go.GraphObject.make,l=a(1),c=(a(0),a(23)),s=function(e){function t(e){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),i(t,[{key:"addFreeText",value:function(e,t){console.log("eeeeeeeeeee",e);var a={text:"自由文本",deletable:!0,role:"freeText",fill:"black",iconVisible:!1,locationSpot:"0.5 0.5 0 0",textAlign:"center",category:"autoText",loc:go.Point.stringify(e.documentPoint),movable:!0,group:t.data.key};this.diagram.startTransaction("addFreeText"),this.diagram.model.addNodeData(a),this.diagram.commitTransaction("addFreeText")}},{key:"getNodeTemplate",value:function(){var e=this;return d(go.Group,"Auto",{selectionObjectName:"PH",layerName:"Background",locationObjectName:"PH",locationSpot:go.Spot.BottomLeft,rotatable:!1,alignment:go.Spot.Left,alignmentFocus:go.Spot.Left,click:function(e,t){console.log(t.data);for(var a=t.findSubGraphParts().iterator;a.next();){var o=a.value;"autoText"==o.data.category&&(o.findObject("textBorder").visible=!1)}return;var a,o},doubleClick:function(t,a){e.addFreeText(t,a)},mouseOver:function(e,t){return},contextMenu:d(go.Adornment),mouseLeave:function(e,t){for(var a=t.findSubGraphParts().iterator;a.next();){var o=a.value;if("labelGroup"==o.data.role)break}o&&setTimeout(function(){o.__trtdNode.switchBorder(o,!1)},3e3)},layoutConditions:go.Part.LayoutStandard&go.Part.LayoutRemoved&go.Part.LayoutAdded&go.Part.LayoutNodeSized,layout:new c},new go.Binding("angle","angle").makeTwoWay(function(e,t){return e}),new go.Binding("copyable","copyable").makeTwoWay(),d(go.Shape,{name:"PH",figure:"Rectangle",stroke:"yellow",strokeWidth:0,fill:"rgba(0,0,0,0)"}),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify))}}]),t}(l);e.exports=s},function(e,t,a){"use strict";function o(){go.Layout.call(this)}go.Diagram.inherit(o,go.Layout),o.prototype.doLayout=function(e){console.log("AxisGroupLayout.doLayout");var t=this.diagram;t.startTransaction("AxisGroupLayout");for(var a,o,n,r,i,d,l,c,s,g=this.collectParts(e).iterator,u=[],p=[],m=this.group,f=0,h=0,y=[],v=[];g.next();){var k=g.value;p.push(k.data),"wave"==k.data.category&&u.push(k),k instanceof go.Node&&("axisYText"==k.data.role&&(r=k),"axisXText"==k.data.role&&(n=k),"themeText"==k.data.role&&k,"shiText"==k.data.role&&y.push(k),"xuText"==k.data.role&&v.push(k),"labelText1"==k.data.role&&(i=k),"labelText2"==k.data.role&&(d=k),"labelText3"==k.data.role&&(l=k),"labelGroup"==k.data.role&&(c=k),k.naturalBounds.width>f&&(f=k.naturalBounds.width),k.naturalBounds.height>h&&(h=k.naturalBounds.height),"line"==k.data.category&&"centerLine"==k.data.role&&k,k.data.group==m.key&&("line"==k.data.category&&("axisX"==k.data.role&&(k.angle=0,a=k),"axisY"==k.data.role&&(o=k,k.angle=270),k.location=m.location.copy().offset(0,0)),"waveGroup"==k.data.category&&(s=k,k.data.oliveWidth,k.data.oliveHeight,k.location=m.location.copy().offset(0,0))))}if(console.log("maxHeight:"+h+",maxWidth:"+f),o&&(o.angle=270),a&&(a.angle=0),s){console.log("waveGroup.width:"+s.width);var w=s.resizeObject.width*Math.cos(Math.abs(360-s.angle%360)/180*Math.PI),b=s.resizeObject.width*Math.sin(Math.abs(360-s.angle%360)/180*Math.PI);this.diagram.model.setDataProperty(a.data,"desiredSize",w+" 10"),this.diagram.model.setDataProperty(o.data,"desiredSize",b+" 10"),m.width=w,m.height=b;var T=s.data.shiStroke,x=s.data.xuStroke,S=s.data.centerStroke||"#3f5369"}if(n&&(n.location=m.location.copy().offset(w,0),n.locationSpot=go.Spot.Top),r&&(r.location=m.location.copy().offset(-10,-b),r.locationSpot=go.Spot.Right),c){for(var P=c.findSubGraphParts().iterator;P.next();){var D=P.value;"labelText1"==D.data.role&&(i=D),"labelText2"==D.data.role&&(d=D),"labelText3"==D.data.role&&(l=D)}s&&(s.labelText1=i,s.labelText2=d,s.labelText3=l)}T&&i&&this.diagram.model.setDataProperty(i.data,"fill",T),x&&d&&this.diagram.model.setDataProperty(d.data,"fill",x),S&&l&&this.diagram.model.setDataProperty(l.data,"fill",S),go.Layout.prototype.doLayout.call(this,e),t.commitTransaction("AxisGroupLayout")},e.exports=o},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=go.GraphObject.make,l=a(1),c=a(0),s=function(e){function t(e){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),i(t,[{key:"makeGeo",value:function(e,t,a){var o=e.radiusX,n=void 0===o?150:o,r=e.radiusY,i=void 0===r?100:r,d=(new go.Geometry).add(new go.PathFigure(0,0).add(new go.PathSegment(go.PathSegment.SvgArc,2*n,0,n,i,0,1,a.clockwiseFlag?1:0)));return d.defaultStretch=go.GraphObject.Fill,d}},{key:"getShiHalfEllipseShape",value:function(){var e=this;return d(go.Shape,{name:"XU",stroke:"red",fill:"rgba(0,66,0,0)",stretch:go.GraphObject.Uniform,alignment:go.Spot.Bottom,alignmentFocus:go.Spot.Bottom},new go.Binding("geometry","",function(t,a){var o=0;return t.order%2==0&&(t.flip=!0),t.flip&&(o=1),e.makeGeo(t,a,{clockwiseFlag:o})}),new go.Binding("desiredSize","desiredSize",function(e){return new go.Size(e.width,e.height/2)}).ofObject("main"))}},{key:"getXuHalfEllipseShape",value:function(){var e=this;return d(go.Shape,{name:"SHI",stroke:"blue",fill:"rgba(0,66,0,0)",stretch:go.GraphObject.Uniform,alignment:go.Spot.Bottom,strokeDashArray:[5,5],alignmentFocus:go.Spot.Bottom},new go.Binding("geometry","",function(t,a){var o=1;return t.order%2==0&&(t.flip=!0),t.flip&&(o=0),e.makeGeo(t,a,{clockwiseFlag:o})}),new go.Binding("desiredSize","desiredSize",function(e){return new go.Size(e.width,e.height/2)}).ofObject("main"))}},{key:"getTextBuild",value:function(){return d(go.TextBlock,{name:"TEXT",alignment:new go.Spot(.5,.4),font:"bold 18px 幼圆",editable:!0,stroke:"black",isMultiline:!0,overflow:go.TextBlock.OverflowClip,wrap:go.TextBlock.WrapDesiredSize,textAlign:"center",spacingAbove:4,spacingBelow:4,portId:"TEXT",stretch:go.GraphObject.Uniform},new go.Binding("textAlign","textAlign",function(e){return["start","center","end"].indexOf(e)>-1?e:"center"}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return c.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return c.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("width","width",function(e){return e-30}).ofObject("main"),new go.Binding("text","text").makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay())}},{key:"getNodeTemplate",value:function(){return d(go.Node,"Spot",{locationObjectName:"TEXT",movable:!0,resizable:!0,resizeObjectName:"TEXT",selectionObjectName:"TEXT",layoutConditions:go.Part.LayoutStandard&go.Part.LayoutRemoved&go.Part.LayoutAdded&go.Part.LayoutNodeSized,locationSpot:go.Spot.LeftCenter,click:function(e,t){console.log(t.data)},doubleClick:function(e,t){e.diagram.__trtd.selectText(e,t)},resizeAdornmentTemplate:d(go.Adornment,"Spot",d(go.Placeholder),d(go.Shape,"Circle",{alignment:go.Spot.Right,cursor:"col-resize",desiredSize:new go.Size(9,9),fill:"lightblue",stroke:"dodgerblue"}))},new go.Binding("movable","movable").makeTwoWay(),new go.Binding("deletable","deletable").makeTwoWay(),d(go.TextBlock,{name:"TEXT",width:200,height:30,maxSize:new go.Size(NaN,70),minSize:new go.Size(NaN,70),alignment:go.Spot.Center,verticalAlignment:go.Spot.Center,isMultiline:!1,overflow:go.TextBlock.OverflowEllipsis,stretch:go.GraphObject.Fill,maxLines:5,stroke:"black",editable:!0,textAlign:"start",font:"18px 'Microsoft YaHei'"},new go.Binding("text","text").makeTwoWay(),new go.Binding("width","width",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("height","height",function(e){return e}).makeTwoWay(function(e){return e})),d(go.Panel,"Vertical",{alignment:go.Spot.Left,alignmentFocus:go.Spot.Right},d(go.Shape,{name:"ICON",width:16,height:16,click:function(e){console.log("icon click")},figure:"Diamond",fill:"red",strokeWidth:0,margin:3},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("figure","figure").makeTwoWay(),new go.Binding("fill","fill",function(e,t){return e}).makeTwoWay(),new go.Binding("height","height",function(e){return e||(e=30),2*e/3}).ofObject("label"),new go.Binding("width","height",function(e){return e||(e=30),2*e/3}).ofObject("label"))))}}]),t}(l);e.exports=s},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=go.GraphObject.make,l=a(1),c=a(0),s=function(e){function t(e){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),i(t,[{key:"clearBorder",value:function(e){e.data.showBorder&&(e.findObject("textBorder").visible=!1)}},{key:"makeGeo",value:function(e,t,a){var o=e.radiusX,n=void 0===o?150:o,r=e.radiusY,i=void 0===r?100:r,d=(new go.Geometry).add(new go.PathFigure(0,0).add(new go.PathSegment(go.PathSegment.SvgArc,2*n,0,n,i,0,1,a.clockwiseFlag?1:0)));return d.defaultStretch=go.GraphObject.Fill,d}},{key:"getNodeTemplate",value:function(){var e=this,t=this.diagram;return d(go.Node,"Spot",{_controlExpand:!0,__trtdNode:e,layerName:"Foreground",zOrder:10,movable:!0,visible:!0,locationSpot:go.Spot.Center,resizeCellSize:new go.Size(10,10),resizable:!1,rotatable:!1,location:new go.Point(0,0),toMaxLinks:1,mouseDrop:function(e,t){var a=t.part,o=e.diagram.selection.first();if("picGroup"==o.data.category&&"cbian"==o.data.role&&"centerText"==a.data.role){var n=e.diagram.findNodeForKey(a.data.olive);if(!n)return;for(var r=o.findSubGraphParts().iterator,i=[],d={};r.next();){var l=r.value;"autoText"==l.data.category&&("0 0 0 0"==l.data.locationSpot&&(d.shiText=l.data.text),"0 0.5 0 0"==l.data.locationSpot&&(d.centerText=l.data.text),"0 1 0 0"==l.data.locationSpot&&(d.xuText=l.data.text)),i.push(l.data)}e.diagram.startTransaction("mouseDrop"),e.diagram.model.removeNodeDataCollection(i);JSON.parse(JSON.stringify(o.data));return e.diagram.model.removeNodeData(o.data),e.diagram.__trtd.addOlive(n,d),void e.diagram.commitTransaction("mouseDrop")}if("coreText"==o.data.subRole&&"coreText"==a.data.subRole||"yunpanText"==o.data.subRole&&"yunpanText"==a.data.subRole){e.diagram.model.startTransaction("coreTextExchange");var c=o.data.orderX,s=o.data.orderY,g=o.data.dimKey;e.diagram.model.setDataProperty(o.data,"orderX",a.data.orderX),e.diagram.model.setDataProperty(o.data,"orderY",a.data.orderY),e.diagram.model.setDataProperty(o.data,"dimKey",a.data.dimKey),e.diagram.model.setDataProperty(a.data,"orderX",c),e.diagram.model.setDataProperty(a.data,"orderY",s),e.diagram.model.setDataProperty(a.data,"dimKey",g),e.diagram.model.commitTransaction("coreTextExchange")}if("dimText"==o.data.subRole&&"dimText"==a.data.subRole&&o.data.category==a.data.category){if(o.data.group!=a.data.group)return;if(!o.containingGroup)return;if("yunpanGroup"!=o.containingGroup.data.category)return;if(o.data.dimX!=a.data.dimX&&o.data.dimY!=a.data.dimY)return;e.diagram.model.startTransaction("dimTextExchange");var c=o.data.dimX,s=o.data.dimY,r=a.containingGroup.findSubGraphParts().iterator,u=[],p=[],m=[],f=[],h="X";0==o.data.dimX&&(h="Y");for(var y=o.data["dim"+h],v=a.data["dim"+h];r.next();){var l=r.value;"yunpanText"==l.data.subRole&&(l.data["order"+h]==v&&m.push(l),l.data["order"+h]==y&&f.push(l))}for(var k,w,b=0;b<m.length;b++)e.diagram.model.setDataProperty(m[b].data,"order"+h,y);for(var b=0;b<f.length;b++)e.diagram.model.setDataProperty(f[b].data,"order"+h,v);return e.diagram.model.setDataProperty(o.data,"dim"+h,v),e.diagram.model.setDataProperty(a.data,"dim"+h,y),void e.diagram.model.commitTransaction("dimTextExchange")}if("dimText"==o.data.subRole&&"dimText"==a.data.subRole){e.diagram.model.startTransaction("dimTextExchange");var c=o.data.dimX,s=o.data.dimY,r=a.containingGroup.findSubGraphParts().iterator,u=[],p=[],m=[],f=[],h="X";for(0==o.data.dimX&&(h="Y");r.next();){var l=r.value;l.data.dimKey==a.data.key&&u.push(l),l.data.dimKey==o.data.key&&p.push(l),"yunpanText"==l.data.subRole&&(l.data["order"+h]==a.data["order"+h]&&m.push(l),l.data["order"+h]==o.data["order"+h]&&f.push(l))}console.log("selnodeCoreTextsselnodeCoreTextsselnodeCoreTexts",p.length);var T=(a.containingGroup.__yunPointsX.length+1)/2,x=(a.containingGroup.__yunPointsY.length+1)/2;o.data.dimX>T&&p.sort(function(e,t){return e.data.orderX-t.data.orderX}),o.data.dimX==T&&(o.data.dimY>x?p.sort(function(e,t){return e.data.orderY-t.data.orderY}):p.sort(function(e,t){return t.data.orderY-e.data.orderY})),o.data.dimX<T&&p.sort(function(e,t){return t.data.orderX-e.data.orderX}),a.data.dimX>T&&u.sort(function(e,t){return e.data.orderX-t.data.orderX}),a.data.dimX==T&&(a.data.dimY>x?u.sort(function(e,t){return e.data.orderY-t.data.orderY}):u.sort(function(e,t){return t.data.orderY-e.data.orderY})),a.data.dimX<T&&u.sort(function(e,t){return t.data.orderX-e.data.orderX});for(var k,w,b=0;b<p.length;b++)k=p[b].data.orderX,w=p[b].data.orderY,e.diagram.model.setDataProperty(p[b].data,"orderX",u[b].data.orderX),e.diagram.model.setDataProperty(p[b].data,"orderY",u[b].data.orderY),e.diagram.model.setDataProperty(u[b].data,"orderX",k),e.diagram.model.setDataProperty(u[b].data,"orderY",w);e.diagram.model.setDataProperty(o.data,"dimX",a.data.dimX),e.diagram.model.setDataProperty(o.data,"dimY",a.data.dimY),e.diagram.model.setDataProperty(a.data,"dimX",c),e.diagram.model.setDataProperty(a.data,"dimY",s),e.diagram.model.commitTransaction("dimTextExchange")}if("wave"==o.data.category&&"centerText"==a.data.role&&a&&o.data.group==t.data.group){e.diagram.startTransaction("mouseDrop"),o.__oldOrder=o.data.order,e.diagram.model.setDataProperty(o.data,"order",a.data.order+.5);var S=e.diagram.model.findNodeDataForKey(o.data.xuText),P=e.diagram.model.findNodeDataForKey(o.data.shiText);e.diagram.model.setDataProperty(P,"order",a.data.order+.5),e.diagram.model.setDataProperty(S,"order",a.data.order+.5),e.diagram.commitTransaction("mouseDrop")}},mouseDragEnter:function(e,t){var a=t.part,o=e.diagram.selection.first();o&&(("coreText"==o.data.subRole&&"coreText"==a.data.subRole||"yunpanText"==o.data.subRole&&"yunpanText"==a.data.subRole)&&(o.areaBackground=null,a.areaBackground="RGB(107,208,137)"),"dimText"==o.data.subRole&&"dimText"==a.data.subRole&&(o.areaBackground=null,a.areaBackground="RGB(107,208,137)"),"centerText"==a.data.role&&(a.layerName="Background"))},mouseDragLeave:function(e,t){var a=t.part,o=e.diagram.selection.first();("coreText"==o.data.subRole&&"coreText"==a.data.subRole||"yunpanText"==o.data.subRole&&"yunpanText"==a.data.subRole)&&(a.areaBackground=null),"dimText"==o.data.subRole&&"dimText"==a.data.subRole&&(a.areaBackground=null),"centerText"==a.data.role&&(a.layerName="Foreground")},selectionChanged:function(e){if(console.log("selectionChanged",e),"autoText"==e.data.category&&null!=e.data.orderX&&null!=e.data.orderY&&"freeText"==e.data.role&&"coreText"==e.data.subRole&&"yunpanText"==e.data.subRole&&e.containingGroup&&"yunGroup"==e.containingGroup.data.category&&"yunpanGroup"==e.containingGroup.data.category&&"line"==e.containingGroup.data.beginSpark&&e.containingGroup.__yunPointsX&&e.containingGroup.__yunPointsY){var t=(e.containingGroup.__yunPointsX.length+1)/2,a=(e.containingGroup.__yunPointsY.length+1)/2;if(e.data.orderX==t&&e.data.orderY==a)return;var o=e.data.orderX,n=e.data.orderY;o==t&&(o=n),n==a&&(n=o);var r=e.containingGroup.data.shapeStrokes,i=e.containingGroup.data.showShape;if(e.isSelected){if("between"==e.containingGroup.data.snapType)var d=Math.max(Math.abs(e.data.orderX-t),Math.abs(e.data.orderY-a))+1;else var d=Math.max(Math.abs(e.data.orderX-t),Math.abs(e.data.orderY-a));console.log("diff:",d,e.data.orderX,e.data.orderY);var l=e.containingGroup.findSubGraphParts().iterator;console.log("showShape",i);for(var s=null;l.next();){var g=l.value;if("autoText"==g.data.category&&null!=g.data.orderX&&null!=g.data.orderY&&"freeText"==g.data.role&&(g.findObject("textBorder").visible=!1,(Math.abs(g.data.orderX-t)==Math.abs(o-t)&&Math.abs(g.data.orderY-a)<=Math.abs(n-a)||Math.abs(g.data.orderX-t)<=Math.abs(o-t)&&Math.abs(g.data.orderY-a)==Math.abs(n-a))&&(g.areaBackground="white",g.zOrder=999)),"shape"==g.data.category&&"background"==g.data.role){var u=g.findObject("SHAPE");g.data.gridWidth==2*d?(s=u,u.__prestroke||(u.__prestroke=u.stroke,u.stroke="rgba(255,0,0,0.5)")):u.__prestroke&&(u.stroke=u.__prestroke,delete u.__prestroke)}}if(!s){if("between"==e.containingGroup.data.snapType)var p=2*d;else var p=2*d;console.log("addShape"),e.diagram.model.startTransaction("addShape");var m={deletable:!0,role:"background",category:"shape",loc:go.Point.stringify(new go.Point(e.containingGroup.__yunPointsX[t-1],e.containingGroup.__yunPointsY[a-1])),movable:!0,group:-19,key:c.guid(),orderX:10,orderY:10,gridWidth:p,stroke:r[d-1],visible:!0,strokeDashArray:"[0,0]",strokeWidth:3};e.diagram.model.addNodeData(m),e.diagram.model.commitTransaction("addShape"),setTimeout(function(){var t=e.diagram.findNodeForKey(m.key);if(console.log("add shape add shape"),t){var a=t.findObject("SHAPE");a.__prestroke||(a.__prestroke=a.stroke,a.stroke="rgba(255,0,0,0.5)")}},100)}}else for(var l=e.containingGroup.findSubGraphParts().iterator;l.next();){var g=l.value;if("autoText"==g.data.category&&null!=g.data.orderX&&null!=g.data.orderY&&"freeText"==g.data.role&&(Math.abs(g.data.orderX-t)==Math.abs(o-t)&&Math.abs(g.data.orderY-a)<=Math.abs(n-a)||Math.abs(g.data.orderX-t)<=Math.abs(o-t)&&Math.abs(g.data.orderY-a)==Math.abs(n-a))&&(g.areaBackground=null,g.zOrder=NaN),"shape"==g.data.category&&"background"==g.data.role){var u=g.findObject("SHAPE");i||(u.stroke="rgba(255,0,0,0)"),g.data.gridWidth==2*d?u.__prestroke||(u.__prestroke=u.stroke,u.stroke="rgba(255,0,0,0.7)"):u.__prestroke&&(u.stroke=u.__prestroke,delete u.__prestroke)}}}},click:function(e,t){console.log(t.data)},mouseOver:function(e,t){console.log("mouseOvermouseOvermouseOver"),t.data.showBorder&&(""!=t.data.text||"xuText"!=t.data.role&&"shiText"!=t.data.role||(t.findObject("textBorder").visible=!0)),"centerText"==t.data.role&&(t.layerName="Background")},mouseLeave:function(e,t){t.data.showBorder&&(t.findObject("textBorder").visible=!1),"centerText"==t.data.role&&(t.layerName="Foreground")},layoutConditions:go.Part.LayoutStandard&go.Part.LayoutRemoved&go.Part.LayoutAdded&~go.Part.LayoutNodeSized,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,contextMenu:t.__trtd.getNodeContextMenu(),doubleClick:function(e,t){e.diagram.__trtd.selectText(e,t)}},new go.Binding("locationSpot","locationSpot",function(e){return go.Spot.parse(e)}).makeTwoWay(function(e){return go.Spot.stringify(e)}),new go.Binding("visible","visible").makeTwoWay(),new go.Binding("deletable","deletable").makeTwoWay(),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("rotatable","rotatable").makeTwoWay(),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("angle","angle").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("copyable","copyable").makeTwoWay(),new go.Binding("layerName","layerName",function(e,t){return e||""}),d(go.TextBlock,{name:"TEXT",alignment:new go.Spot(0,0),font:"18px 'Microsoft YaHei'",editable:!1,stroke:"black",isMultiline:!0,overflow:go.TextBlock.OverflowClip,wrap:go.TextBlock.WrapDesiredSize,textAlign:"center",verticalAlignment:go.Spot.Center,spacingAbove:4,spacingBelow:4,portId:"TEXT",margin:5,maxSize:new go.Size(600,NaN),minSize:new go.Size(10,10),stretch:go.GraphObject.UniformToFill,textEdited:function(e,t,a){var o=e.part;""!=a.trim()||"shiText"!=o.data.role&&"xuText"!=o.data.role||(e.part.diagram.model.startTransaction("text"),e.part.diagram.model.setDataProperty(e.part.data,"nloc",null),e.part.diagram.model.commitTransaction("text")),e.part.data.role&&e.part.data.role.indexOf("labelText")>-1&&(e.part.containingGroup.layout.isValidLayout=!1)}},new go.Binding("background","background",function(e){return e}).makeTwoWay(),new go.Binding("areaBackground","areaBackground",function(e){return e}).makeTwoWay(),new go.Binding("textAlign","textAlign",function(e){return e}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return c.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return c.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("maxSize","",function(e,t,a){var o=NaN,n=NaN;return e.width&&(o=e.width),e.height&&(n=e.height),new go.Size(o,n)}),new go.Binding("minSize","minSize",function(e){return go.Size.parse(e)}),new go.Binding("text","text").makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay()),d(go.Panel,"Vertical",{alignment:go.Spot.Left,alignmentFocus:go.Spot.Right},d(go.Shape,{name:"ICON",width:16,height:16,visible:!1,click:function(e){console.log("icon click")},figure:"Circle",fill:"red",strokeWidth:0,margin:3},new go.Binding("figure","figure").makeTwoWay(),new go.Binding("visible","iconVisible").makeTwoWay(),new go.Binding("fill","fill",function(e,t){return e}).makeTwoWay())),d(go.Shape,"Rectangle",{name:"textBorder",stroke:"green",strokeWidth:3,strokeDashArray:[10,5],visible:!1,fill:"transparent",alignment:go.Spot.Center,width:100,height:270},new go.Binding("stroke","textStroke"),new go.Binding("desiredSize","",function(e,t){if(!c.checkPhone())return new go.Size(t.part.naturalBounds.width-3,t.part.naturalBounds.height-3);var a=t.part.diagram.findNodeForKey(t.part.data.olive);return new go.Size(a.naturalBounds.width-3,a.naturalBounds.height)})),d(go.Shape,"Circle",{name:"place",stroke:"red",strokeWidth:1,strokeDashArray:null,visible:!1,fill:"transparent",alignment:go.Spot.Center,width:50,height:50},new go.Binding("stroke","placeStroke")))}}]),t}(l);e.exports=s},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=go.GraphObject.make,l=a(1),c=(a(0),function(e){function t(e){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),i(t,[{key:"switchBorder",value:function(e,t){e.findObject("groupBorder").opacity=t?1:0}},{key:"hiddenAllText",value:function(e){console.log("hiddenAllTexthiddenAllTexthiddenAllText"),e.diagram.startTransaction();for(var t=e.findSubGraphParts().iterator,a=null;t.next();){var o=t.value;null==a&&(a=o.visible),"autoText"==o.data.category&&e.diagram.model.setDataProperty(o.data,"visible",!a)}e.diagram.commitTransaction()}},{key:"addLabelText",value:function(e,t){var a={text:"说明：内容",deletable:!0,fill:"black",iconVisible:!0,locationSpot:"0 0 0 0",textAlign:"start",category:"autoText",loc:t.location.x+30+" "+t.location.y,movable:!1,group:t.data.key};this.diagram.startTransaction("addLabelText"),this.diagram.model.addNodeData(a),this.diagram.commitTransaction("addLabelText")}},{key:"getNodeTemplate",value:function(){var e=this;return d(go.Group,"Spot",{__trtdNode:e,layerName:"default",locationObjectName:"groupBorder",zOrder:5,background:"rgba(0,0,0,0)",rotatable:!1,minSize:new go.Size(200,100),locationSpot:go.Spot.Center,toolTip:d("ToolTip",d(go.TextBlock,{margin:4},new go.Binding("text","",function(e,t){return"双击显示/隐藏"}))),click:function(e,t){console.log(t.data)},selectable:!0,doubleClick:function(t,a){e.hiddenAllText(a),e.switchBorder(a,!1)},mouseOver:function(t,a){if(e.switchBorder(a,!0),a.containingGroup){var o=a.containingGroup.findSubGraphParts().iterator;for(a.diagram.startTransaction();o.next();){var n=o.value;"autoText"==n.data.category&&n.data.role&&n.data.role.indexOf("labelText")>-1&&n.diagram.model.setDataProperty(n.data,"minSize","120 30")}a.diagram.commitTransaction()}},mouseLeave:function(t,a){e.switchBorder(a,!1)},layoutConditions:go.Part.LayoutStandard&go.Part.LayoutRemoved&go.Part.LayoutAdded&go.Part.LayoutNodeSized,layout:d(go.GridLayout,{isInitial:!1,isOngoing:!1,spacing:new go.Size(0,0),cellSize:go.Size.parse(300,150),arrangement:go.GridLayout.LeftToRight,wrappingColumn:1,isRealtime:!1,alignment:go.GridLayout.Location})},new go.Binding("location","loc",function(e){return go.Point.parse(e)}).makeTwoWay(go.Point.stringify),new go.Binding("angle","angle").makeTwoWay(function(e,t){return e}),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("copyable","copyable").makeTwoWay(),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("deletable","deletable").makeTwoWay(),d(go.Placeholder,{padding:30,alignment:go.Spot.Center,name:"placeholder"}),d(go.Shape,"Rectangle",{name:"groupBorder",stroke:"green",strokeWidth:3,strokeDashArray:[10,5],visible:!0,opacity:0,fill:null,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center},new go.Binding("desiredSize","",function(e,t){return console.log("vvvvvvvvvvvvv,",e,t),new go.Size(t.part.measuredBounds.width-3,t.part.measuredBounds.height-3)}).ofObject("")))}}]),t}(l));e.exports=c},function(e,t,a){"use strict";function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var d=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),l=(a(8),go.GraphObject.make),c=a(1),s=(a(0),function(e){function t(e){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),d(t,[{key:"getNodeSelectionAdornmentTemplate",value:function(){return l(go.Adornment,"Spot",l(go.Panel,"Auto",l(go.Shape,{fill:null,stroke:"dodgerblue",strokeWidth:1}),l(go.Placeholder)),l(go.Panel,"Vertical",{name:"ButtonIcon1",alignment:new go.Spot(0,1,-20,20),alignmentFocus:go.Spot.Center,width:60,height:60,isActionable:!0},l(go.Shape,"Circle",{fill:"rgba(1,1,1,0)",strokeWidth:0,stroke:"green",width:50,height:50})))}},{key:"nodeResizeAdornmentTemplate",value:function(){return l(go.Adornment,"Spot",l(go.Placeholder),l(go.Shape,"Circle",{alignment:go.Spot.TopLeft,alignmentFocus:go.Spot.BottomRight,cursor:"col-resize",desiredSize:new go.Size(30,30),fill:"lightblue",stroke:"dodgerblue"}),l(go.Shape,"Circle",{alignment:go.Spot.BottomRight,alignmentFocus:go.Spot.TopLeft,cursor:"col-resize",desiredSize:new go.Size(30,30),fill:"lightblue",stroke:"dodgerblue"}))}},{key:"getNodeTemplate",value:function(){var e=this.diagram,t=this;return l(go.Node,"Spot",o({name:"NODE",_controlExpand:!0,layerName:"Background",locationSpot:go.Spot.BottomLeft,resizeCellSize:new go.Size(10,10),locationObjectName:"SHAPE",resizable:!0,resizeObjectName:"SHAPE",rotatable:!0,rotateObjectName:"SHAPE",doubleClick:function(e,t){console.log(t.data),t.diagram.__trtd.nodeDoubleClickListener&&t.diagram.__trtd.nodeDoubleClickListener(t)},click:function(e,t){console.log(t.data),t.diagram.__trtd.nodeClickListener&&t.diagram.__trtd.nodeClickListener(t)},selectable:!0,movable:!0,angle:0,layoutConditions:go.Part.LayoutStandard,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,resizeAdornmentTemplate:t.nodeResizeAdornmentTemplate(),contextMenu:e.__trtd.nodeContextMenu,selectionAdornmentTemplate:t.getNodeSelectionAdornmentTemplate()},"contextMenu",l(go.Adornment)),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("resizable","resizable").makeTwoWay(),new go.Binding("deletable","deletable").makeTwoWay(),new go.Binding("layerName","layerName",function(e,t){return e||""}).makeTwoWay(function(e){return e}),l(go.Picture,{name:"SHAPE",width:400,height:400},{successFunction:function(e,t){e.width&&e.height||e.part.data.width&&e.part.data.height||(e.width=e.element.width,e.height=e.element.height)}},{sourceCrossOrigin:function(e){return""}},new go.Binding("source","picture",function(e){return e+"?"+Date.now()}).makeTwoWay(function(e){return e?e=e.replace(/\?.*$/g,""):""}),new go.Binding("width","width",function(e,t){return e}).makeTwoWay(function(e){return e}),new go.Binding("height","height",function(e,t){return e}).makeTwoWay(function(e){return e}),new go.Binding("angle","angle").makeTwoWay(),new go.Binding("opacity","opacity",function(e,t){return e?parseFloat(e):1}).makeTwoWay(function(e){return e})))}}]),t}(c));e.exports=s},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=(a(8),go.GraphObject.make),l=a(1),c=(a(0),function(e){function t(e){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),i(t,[{key:"getNodeSelectionAdornmentTemplate",value:function(){return d(go.Adornment,"Spot",d(go.Panel,"Auto",d(go.Shape,{fill:null,stroke:"dodgerblue",strokeWidth:1}),d(go.Placeholder)),d(go.Panel,"Vertical",{name:"ButtonIcon1",alignment:new go.Spot(0,1,-20,20),alignmentFocus:go.Spot.Center,width:60,height:60,isActionable:!0},d(go.Shape,"Circle",{fill:"rgba(1,1,1,0)",strokeWidth:0,stroke:"green",width:50,height:50})))}},{key:"nodeResizeAdornmentTemplate",value:function(){return d(go.Adornment,"Spot",d(go.Placeholder),d(go.Shape,"Circle",{alignment:go.Spot.TopLeft,alignmentFocus:go.Spot.BottomRight,cursor:"col-resize",desiredSize:new go.Size(30,30),fill:"lightblue",stroke:"dodgerblue"}),d(go.Shape,"Circle",{alignment:go.Spot.BottomRight,alignmentFocus:go.Spot.TopLeft,cursor:"col-resize",desiredSize:new go.Size(30,30),fill:"lightblue",stroke:"dodgerblue"}))}},{key:"addFreeText",value:function(e,t){console.log("eeeeeeeeeee",e);var a={text:"总结文本",deletable:!0,fill:"black",iconVisible:!1,locationSpot:"0 0.5 0 0",textAlign:"left",category:"autoText",loc:go.Point.stringify(e.documentPoint),movable:!0,group:t.data.key};this.diagram.startTransaction("addFreeText"),this.diagram.model.addNodeData(a),this.diagram.commitTransaction("addFreeText")}},{key:"getNodeTemplate",value:function(){var e=(this.diagram,this);return d(go.Group,"Auto",{__trtdNode:e,layerName:"default",locationObjectName:"placeholder",zOrder:5,background:"rgba(0,0,0,0)",rotatable:!1,locationSpot:go.Spot.BottomLeft,click:function(e,t){console.log(t.data)},layout:d(go.Layout),doubleClick:function(t,a){e.addFreeText(t,a)},contextMenu:d(go.Adornment),layoutConditions:go.Part.LayoutStandard&go.Part.LayoutRemoved&go.Part.LayoutAdded&go.Part.LayoutNodeSized},new go.Binding("location","loc",function(e){return go.Point.parse(e)}).makeTwoWay(go.Point.stringify),new go.Binding("angle","angle").makeTwoWay(function(e,t){return e}),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("deletable","deletable").makeTwoWay(),new go.Binding("layerName","layerName").makeTwoWay(),d(go.Placeholder,{padding:30,alignment:go.Spot.Center,name:"placeholder"}))}}]),t}(l));e.exports=c},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=go.GraphObject.make,l=a(1),c=(a(0),a(30)),s=function(e){function t(e){o(this,t);var a=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.defaultTextFont="20px 'Microsoft YaHei'",a}return r(t,e),i(t,[{key:"snapToGrid",value:function(e,t){if("coreText"!=e.subRole&&"themeText"!=e.subRole){var a=go.Point.parse(e.loc);if(t.__yunPointsX&&t.__yunPointsY)if(a.x>=t.__yunPointsX[0]&&a.x<=t.__yunPointsX[t.__yunPointsX.length-1]&&a.y>=t.__yunPointsY[t.__yunPointsY.length-1]&&a.y<=t.__yunPointsY[0]){for(var o,n,r,i=2e4,d=2e4,l=0;l<t.__yunPointsX.length;l++)(o=Math.abs(a.x-t.__yunPointsX[l]))<i&&(i=o,n=l+1);for(var l=0;l<t.__yunPointsY.length;l++)(o=Math.abs(a.y-t.__yunPointsY[l]))<d&&(d=o,r=l+1);null!=n&&null!=r&&(e.orderX=n,e.orderY=r)}else delete e.orderX,delete e.orderY}}},{key:"addFreeText",value:function(e,t){console.log("addFreeTextaddFreeText begin",e);var a=(t.data.gridWidth,e.documentPoint),o=this,n={text:"灵感",deletable:!0,role:"freeText",fill:"black",iconVisible:!1,locationSpot:"0.5 0.5 0 0",minSize:"30 30",font:o.defaultTextFont,textAlign:"center",category:"autoText",loc:go.Point.stringify(a),movable:!0,group:t.data.key};this.snapToGrid(n,t),this.diagram.startTransaction("addFreeText"),this.diagram.model.addNodeData(n),this.diagram.commitTransaction("addFreeText"),t.layout.isValidLayout=!1,console.log("addFreeTextaddFreeText end",e)}},{key:"getNodeTemplate",value:function(){var e=this;return d(go.Group,"Auto",{selectionObjectName:"PH",__trtdNode:e,layerName:"default",padding:0,margin:0,copyable:!0,zOrder:15,locationObjectName:"PH",locationSpot:new go.Spot(0,1,0,-0),rotatable:!1,alignment:go.Spot.Left,alignmentFocus:go.Spot.Left,click:function(e,t){console.log(t.data);for(var a=t.findSubGraphParts().iterator;a.next();){var o=a.value;"autoText"==o.data.category&&(o.findObject("textBorder").visible=!1)}return void(t.layout.isValidLayout=!1);var a,o},doubleClick:function(t,a){e.addFreeText(t,a)},mouseOver:function(e,t){},contextMenu:d(go.Adornment),mouseLeave:function(e,t){for(var a=t.findSubGraphParts().iterator;a.next();){if("labelGroup"==a.value.data.role)break}},layoutConditions:go.Part.LayoutStandard&go.Part.LayoutRemoved&go.Part.LayoutAdded&go.Part.LayoutNodeSized,layout:new c},new go.Binding("deletable","deletable").makeTwoWay(function(e,t){return e}),new go.Binding("copyable","copyable").makeTwoWay(),new go.Binding("angle","angle").makeTwoWay(function(e,t){return e}),new go.Binding("zOrder","zOrder").makeTwoWay(function(e,t){return e}),new go.Binding("locationSpot","",function(e){return new go.Spot(0,1,e.gridWidth,-e.gridHeight)}),d(go.Shape,{name:"PH",figure:"Rectangle",stroke:"yellow",strokeWidth:0,fill:"rgba(0,0,255,0.0)"}),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify))}}]),t}(l);e.exports=s},function(e,t,a){"use strict";function o(){go.Layout.call(this)}go.Diagram.inherit(o,go.Layout),o.prototype.doLayout=function(e){console.log("YunGroupLayout.doLayout");var t=this.diagram;t.startTransaction("YunGroupLayout");for(var a,o,n=this.collectParts(e).iterator,r=[],i=[],d=this.group,l=d.data.gridWidth,c=d.data.gridHeight,s=0,g=0,u=[],p=[],m=[],f=[],h=[],y=[],v=[],k=[],w=d.data.snapType||"grid",b=d.data.showShape,T=(d.data.beginSpark,d.data.shapeStrokes);n.next();){var x=n.value;i.push(x.data),"wave"==x.data.category&&r.push(x),x instanceof go.Node&&("background"==x.data.role&&k.push(x),"axisYText"==x.data.role&&x,"axisXText"==x.data.role&&x,"themeText"==x.data.role&&x,"shiText"==x.data.role&&u.push(x),"xuText"==x.data.role&&p.push(x),"labelText1"==x.data.role&&x,"labelText2"==x.data.role&&x,"labelText3"==x.data.role&&x,"labelGroup"==x.data.role&&x,x.naturalBounds.width>s&&(s=x.naturalBounds.width),x.naturalBounds.height>g&&(g=x.naturalBounds.height),"freeText"==x.data.role&&v.push(x),"line"==x.data.category&&(y.push(x),"verticalLine"==x.data.role&&m.push(x),"horizontalLine"==x.data.role&&f.push(x),"freelLine"==x.data.role&&h.push(x)),x.data.group==d.key&&"line"==x.data.category&&("axisX"==x.data.role&&(x.angle=0,a=x,x.location=d.location.copy().offset(0,0)),"axisY"==x.data.role&&(o=x,x.angle=270,x.location=d.location.copy().offset(0,0))))}if(console.log("maxHeight:"+g+",maxWidth:"+s),m.sort(function(e,t){return e.data.order-t.data.order}),f.sort(function(e,t){return e.data.order-t.data.order}),h.sort(function(e,t){return e.data.order-t.data.order}),"between"==w)var S=m.length*l+l,P=f.length*c+c;else var S=m.length*l,P=f.length*c;var D=[],_=[],B=(f.length+1)/2,N=(m.length+1)/2;y.forEach(function(e,t){"axisX"==e.data.role||e.data.role}),m.forEach(function(e,t){var a=t+1;e.diagram.model.setDataProperty(e.data,"order",a),e.location=d.location.copy().offset(l*a,0),e.angle=270,e.diagram.model.setDataProperty(e.data,"desiredSize",P+20+" 10"),"between"==w?(a<B&&D.push(e.location.x-l/2),a==B&&D.push(e.location.x),a>B&&D.push(e.location.x+l/2)):D.push(e.location.x)}),f.forEach(function(e,t){var a=t+1;e.diagram.model.setDataProperty(e.data,"order",a),e.location=d.location.copy().offset(0,-c*a),e.angle=0,e.diagram.model.setDataProperty(e.data,"desiredSize",S+20+" 10"),"between"==w?(a<N&&_.push(e.location.y+c/2),a==N&&_.push(e.location.y),a>N&&_.push(e.location.y-c/2)):_.push(e.location.y)}),this.group.__yunPointsX=D,this.group.__yunPointsY=_,h.forEach(function(e,t){}),k.forEach(function(e,t){if(e.diagram.model.setDataProperty(e.data,"visible",!0),b)try{e.diagram.model.setDataProperty(e.data,"stroke",T[e.data.gridWidth/2-1])}catch(e){console.log(e)}else e.diagram.model.setDataProperty(e.data,"stroke","rgba(255,0,0,0)");if(!e.data.desiredSize){e.data.orderX=B,e.data.orderY=N,e.location=new go.Point(D[e.data.orderX-1],_[e.data.orderY-1]);var a=e.data.gridWidth||2;if("between"==w){var o=new go.Size(l*(a-1),c*(a-1));e.diagram.model.setDataProperty(e.data,"strokeWidth",l)}else{var o=new go.Size(l*a+3,c*a+3);e.diagram.model.setDataProperty(e.data,"strokeWidth",3)}e.diagram.model.setDataProperty(e.data,"desiredSize",go.Size.stringify(o)),e.diagram.model.setDataProperty(e.data,"strokeDashArray","[0,0]")}}),v.forEach(function(e,t){if(e.areaBackground=null,e.diagram.model.setDataProperty(e.data,"height",null),e.diagram.model.setDataProperty(e.data,"width",null),d.data.autoSnapText&&(e.data.orderX&&e.data.orderY&&(e.location=new go.Point(D[e.data.orderX-1],_[e.data.orderY-1]),e.location=new go.Point(D[e.data.orderX-1],_[e.data.orderY-1])),"dimText"==e.data.subRole&&null!=e.data.dimX&&null!=e.data.dimY)){console.log("dimText");var a,o;a=D[e.data.dimX-1],o=_[e.data.dimY-1],e.data.dimX>=D.length&&(a=D[D.length-1]+l),e.data.dimY>=_.length&&(o=_[_.length-1]-c),e.data.dimX<=0&&(a=D[0]-l,"between"!=w&&e.data.dimY<_.length&&(a-=l/2)),e.data.dimY<=0&&(o=_[0]+c,"between"!=w&&e.data.dimX<D.length&&(o+=c/2)),e.location=new go.Point(a,o)}e.data.orderY!=N&&e.data.dimY!=N||(e.diagram.model.setDataProperty(e.data,"width",""+(l-10)),e.diagram.model.setDataProperty(e.data,"height",null)),e.data.orderX!=B&&e.data.dimX!=B||(e.diagram.model.setDataProperty(e.data,"height",""+(c-10)),e.diagram.model.setDataProperty(e.data,"width",null)),Math.abs(e.data.orderX-B)<=1&&Math.abs(e.data.orderY-N)<=1&&"between"!=w&&(e.diagram.model.setDataProperty(e.data,"width",""+(l-10)),e.diagram.model.setDataProperty(e.data,"height",""+(c-10))),0==Math.abs(e.data.orderX-B)&&0==Math.abs(e.data.orderY-N)&&("between"==w?(e.diagram.model.setDataProperty(e.data,"width",""+(l+l-10)),e.diagram.model.setDataProperty(e.data,"height",""+(c+c-10))):(e.diagram.model.setDataProperty(e.data,"width",""+(l-10)),e.diagram.model.setDataProperty(e.data,"height",""+(c-10))))}),o&&(o.angle=270,this.diagram.model.setDataProperty(o.data,"desiredSize",P+30+" 10")),a&&(a.angle=0,this.diagram.model.setDataProperty(a.data,"desiredSize",S+30+" 10")),d.width=S+2*l,d.height=P+2*c,go.Layout.prototype.doLayout.call(this,e),t.commitTransaction("YunGroupLayout")},e.exports=o},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=go.GraphObject.make,l=a(1),c=(a(0),a(32)),s=function(e){function t(e){o(this,t);var a=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.defaultTextFont="20px 'Microsoft YaHei'",a}return r(t,e),i(t,[{key:"snapToGrid",value:function(e,t){if("coreText"!=e.subRole&&"themeText"!=e.subRole){var a=go.Point.parse(e.loc);if(t.__yunPointsX&&t.__yunPointsY)if(a.x>=t.__yunPointsX[0]&&a.x<=t.__yunPointsX[t.__yunPointsX.length-1]&&a.y>=t.__yunPointsY[t.__yunPointsY.length-1]&&a.y<=t.__yunPointsY[0]){for(var o,n,r,i=2e4,d=2e4,l=0;l<t.__yunPointsX.length;l++)(o=Math.abs(a.x-t.__yunPointsX[l]))<i&&(i=o,n=l+1);for(var l=0;l<t.__yunPointsY.length;l++)(o=Math.abs(a.y-t.__yunPointsY[l]))<d&&(d=o,r=l+1);null!=n&&null!=r&&(e.orderX=n,e.orderY=r)}else delete e.orderX,delete e.orderY}}},{key:"addFreeText",value:function(e,t){console.log("addFreeTextaddFreeText begin",e);var a=(t.data.gridWidth,e.documentPoint),o=this,n={text:"节点",deletable:!0,role:"freeText",fill:"black",iconVisible:!1,locationSpot:"0.5 0.5 0 0",minSize:"30 30",subRole:"yunpanText",font:o.defaultTextFont,textAlign:"center",category:"autoText",loc:go.Point.stringify(a),movable:!0,group:t.data.key};this.snapToGrid(n,t),this.diagram.startTransaction("addFreeText"),this.diagram.model.addNodeData(n),this.diagram.commitTransaction("addFreeText"),t.layout.isValidLayout=!1,console.log("addFreeTextaddFreeText end",e)}},{key:"addFreeShapeText",value:function(e,t){console.log("addFreeTextaddFreeText begin",e);var a=t.data.gridWidth,o=e.documentPoint,n=this,r={text:"节点",deletable:!0,role:"freeText",fill:"#F2F2F2",iconVisible:!1,locationSpot:"0.5 0.5 0 0",minSize:"30 30",subRole:"yunpanText",desiredSize:go.Size.stringify(new go.Size(a-10,a-10)),font:n.defaultTextFont,textAlign:"center",category:"shapeText",loc:go.Point.stringify(o),movable:!0,group:t.data.key};this.snapToGrid(r,t),this.diagram.startTransaction("addFreeText"),this.diagram.model.addNodeData(r),this.diagram.commitTransaction("addFreeText"),t.layout.isValidLayout=!1,console.log("addFreeTextaddFreeText end",e)}},{key:"getNodeTemplate",value:function(){var e=this;return d(go.Group,"Auto",{selectionObjectName:"PH",__trtdNode:e,layerName:"default",padding:0,margin:0,copyable:!1,zOrder:15,locationObjectName:"PH",locationSpot:new go.Spot(0,1,0,-0),rotatable:!1,alignment:go.Spot.Left,alignmentFocus:go.Spot.Left,click:function(e,t){console.log(t.data);for(var a=t.findSubGraphParts().iterator;a.next();){var o=a.value;"autoText"==o.data.category&&(o.findObject("textBorder").visible=!1)}return void(t.layout.isValidLayout=!1);var a,o},doubleClick:function(t,a){e.addFreeShapeText(t,a)},mouseOver:function(e,t){},contextMenu:d(go.Adornment),mouseLeave:function(e,t){for(var a=t.findSubGraphParts().iterator;a.next();){if("labelGroup"==a.value.data.role)break}},layoutConditions:go.Part.LayoutStandard&go.Part.LayoutRemoved&go.Part.LayoutAdded&go.Part.LayoutNodeSized,layout:new c},new go.Binding("deletable","deletable").makeTwoWay(function(e,t){return e}),new go.Binding("copyable","copyable").makeTwoWay(),new go.Binding("angle","angle").makeTwoWay(function(e,t){return e}),new go.Binding("zOrder","zOrder").makeTwoWay(function(e,t){return e}),new go.Binding("locationSpot","",function(e){return new go.Spot(0,1,e.gridWidth,-e.gridHeight)}),d(go.Shape,{name:"PH",figure:"Rectangle",stroke:"yellow",strokeWidth:0,fill:"rgba(0,0,255,0.0)"}),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify))}}]),t}(l);e.exports=s},function(e,t,a){"use strict";function o(){go.Layout.call(this)}go.Diagram.inherit(o,go.Layout),o.prototype.doLayout=function(e){console.log("YunGroupLayout.doLayout");var t=this.diagram;t.startTransaction("YunGroupLayout");var a,o,n,r,i=this.collectParts(e).iterator,d=[],l=[],c=this.group,s=c.data.gridWidth,g=c.data.gridHeight,u=0,p=0,m=[],f=[],h=[],y=[],v=[],k=[],w=[],b=[],T=[],x=[],S=c.data.snapType||"grid";for(c.data.showShape,c.data.beginSpark,c.data.shapeStrokes;i.next();){var P=i.value;l.push(P.data),"wave"==P.data.category&&d.push(P),P instanceof go.Node&&(0==P.data.dimX&&"dimText"==P.data.subRole&&x.push(P),0==P.data.dimY&&"dimText"==P.data.subRole&&T.push(P),"background"==P.data.role&&b.push(P),"axisYText"==P.data.role&&(r=P),"axisXText"==P.data.role&&(n=P),"themeText"==P.data.role&&P,"shiText"==P.data.role&&m.push(P),"xuText"==P.data.role&&f.push(P),"labelText1"==P.data.role&&P,"labelText2"==P.data.role&&P,"labelText3"==P.data.role&&P,"labelGroup"==P.data.role&&P,P.naturalBounds.width>u&&(u=P.naturalBounds.width),P.naturalBounds.height>p&&(p=P.naturalBounds.height),"freeText"==P.data.role&&w.push(P),"line"==P.data.category&&(k.push(P),"verticalLine"==P.data.role&&h.push(P),"horizontalLine"==P.data.role&&y.push(P),"freelLine"==P.data.role&&v.push(P)),P.data.group==c.key&&"line"==P.data.category&&("axisX"==P.data.role&&(P.angle=0,a=P,P.location=c.location.copy().offset(0,0)),"axisY"==P.data.role&&(o=P,P.angle=270,P.location=c.location.copy().offset(0,0))))}if(console.log("maxHeight:"+p+",maxWidth:"+u),h.sort(function(e,t){return e.data.order-t.data.order}),y.sort(function(e,t){return e.data.order-t.data.order}),v.sort(function(e,t){return e.data.order-t.data.order}),"between"==S)var D=h.length*s+s,_=y.length*g+g;else var D=h.length*s,_=y.length*g;var B=[],N=[],O=(y.length+1)/2,A=(h.length+1)/2;k.forEach(function(e,t){"axisX"==e.data.role||e.data.role}),h.forEach(function(e,t){var a=t+1;e.diagram.model.setDataProperty(e.data,"order",a),e.location=c.location.copy().offset(s*a,0),e.angle=270,e.diagram.model.setDataProperty(e.data,"deletable",!0),e.diagram.model.setDataProperty(e.data,"desiredSize",_+20+" 10"),"between"==S?(a<O&&B.push(e.location.x-s/2),a==O&&B.push(e.location.x),a>O&&B.push(e.location.x+s/2)):B.push(e.location.x)}),y.forEach(function(e,t){var a=t+1;e.diagram.model.setDataProperty(e.data,"order",a),e.diagram.model.setDataProperty(e.data,"deletable",!0),e.location=c.location.copy().offset(0,-g*a),e.angle=0,e.diagram.model.setDataProperty(e.data,"desiredSize",D+20+" 10"),"between"==S?(a<A&&N.push(e.location.y+g/2),a==A&&N.push(e.location.y),a>A&&N.push(e.location.y-g/2)):N.push(e.location.y)}),this.group.__yunPointsX=B,this.group.__yunPointsY=N,v.forEach(function(e,t){}),w.forEach(function(e,t){if(e.areaBackground=null,c.data.autoSnapText&&(e.data.orderX&&e.data.orderY&&(e.location=new go.Point(B[e.data.orderX-1],N[e.data.orderY-1]),e.location=new go.Point(B[e.data.orderX-1],N[e.data.orderY-1])),"dimText"==e.data.subRole&&null!=e.data.dimX&&null!=e.data.dimY)){console.log("dimText"),e.diagram.model.setDataProperty(e.data,"deletable",!0);var a,o;a=B[e.data.dimX-1],o=N[e.data.dimY-1],e.data.dimX<=0&&(a=B[0]-s/2-10,"between"!=S&&e.data.dimY<=N.length&&(a-=s/2)),e.data.dimY<=0&&(o=N[0]+g/2,"between"!=S&&e.data.dimX<=B.length&&(o+=g/2)),e.location=new go.Point(a,o)}}),n&&(n.location=c.location.copy().offset(D+50,0),n.locationSpot=go.Spot.Left),r&&(r.location=c.location.copy().offset(0,-(_+50)),r.locationSpot=go.Spot.Bottom),o&&(o.angle=270,this.diagram.model.setDataProperty(o.data,"desiredSize",_+30+" 10")),a&&(a.angle=0,this.diagram.model.setDataProperty(a.data,"desiredSize",D+30+" 10")),c.width=D+2*s,c.height=_+2*g,go.Layout.prototype.doLayout.call(this,e),t.commitTransaction("YunGroupLayout")},e.exports=o},function(e,t,a){"use strict";function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var d=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),l=(a(8),go.GraphObject.make),c=a(1),s=(a(0),function(e){function t(e){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),d(t,[{key:"getNodeSelectionAdornmentTemplate",value:function(){return l(go.Adornment,"Spot",l(go.Panel,"Auto",l(go.Shape,{fill:null,stroke:"dodgerblue",strokeWidth:1}),l(go.Placeholder)),l(go.Panel,"Vertical",{name:"ButtonIcon1",alignment:new go.Spot(0,1,-20,20),alignmentFocus:go.Spot.Center,width:60,height:60,isActionable:!0},l(go.Shape,"Circle",{fill:"rgba(1,1,1,0)",strokeWidth:0,stroke:"green",width:50,height:50})))}},{key:"nodeResizeAdornmentTemplate",value:function(){return l(go.Adornment,"Spot",l(go.Placeholder),l(go.Shape,"Circle",{alignment:go.Spot.TopLeft,alignmentFocus:go.Spot.BottomRight,cursor:"col-resize",desiredSize:new go.Size(30,30),fill:"lightblue",stroke:"dodgerblue"}),l(go.Shape,"Circle",{alignment:go.Spot.BottomRight,alignmentFocus:go.Spot.TopLeft,cursor:"col-resize",desiredSize:new go.Size(30,30),fill:"lightblue",stroke:"dodgerblue"}))}},{key:"getNodeTemplate",value:function(){var e=this.diagram,t=this;return l(go.Node,"Spot",o({name:"NODE",_controlExpand:!0,layerName:"default",zOrder:13,locationSpot:go.Spot.Center,resizeCellSize:new go.Size(10,10),locationObjectName:"SHAPE",resizable:!0,resizeObjectName:"SHAPE",rotatable:!0,rotateObjectName:"SHAPE",doubleClick:function(e,t){console.log(t.data),t.diagram.__trtd.nodeDoubleClickListener&&t.diagram.__trtd.nodeDoubleClickListener(t)},click:function(e,t){console.log(t.data),t.diagram.__trtd.nodeClickListener&&t.diagram.__trtd.nodeClickListener(t)},selectable:!0,movable:!0,angle:0,layoutConditions:go.Part.LayoutStandard,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,resizeAdornmentTemplate:t.nodeResizeAdornmentTemplate(),contextMenu:e.__trtd.nodeContextMenu,selectionAdornmentTemplate:t.getNodeSelectionAdornmentTemplate()},"contextMenu",l(go.Adornment)),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("resizable","resizable").makeTwoWay(),new go.Binding("deletable","deletable").makeTwoWay(),new go.Binding("visible","visible"),new go.Binding("zOrder","zOrder"),new go.Binding("layerName","layerName",function(e,t){return e||""}).makeTwoWay(function(e){return e}),l(go.Shape,{strokeDashArray:null,margin:0,name:"SHAPE",figure:"Rectangle",fill:"rgba(0,0,0,0)",minSize:new go.Size(50,50),strokeWidth:3,stroke:"RGBA(255,0,0,0.2)",portId:""},new go.Binding("fill","fill").makeTwoWay(),new go.Binding("strokeWidth","strokeWidth").makeTwoWay(),new go.Binding("figure","figure").makeTwoWay(),new go.Binding("stroke","stroke").makeTwoWay(),new go.Binding("desiredSize","desiredSize",function(e){return new go.Size.parse(e)}).makeTwoWay(function(e){return go.Size.stringify(e)}),new go.Binding("strokeDashArray","strokeDashArray",function(e){return JSON.parse(e)}).makeTwoWay(function(e){return JSON.stringify(e)})))}}]),t}(c));e.exports=s},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=go.GraphObject.make,l=a(1),c=a(0),s=function(e){function t(e){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),i(t,[{key:"clearBorder",value:function(e){e.data.showBorder&&(e.findObject("textBorder").visible=!1)}},{key:"makeGeo",value:function(e,t,a){var o=e.radiusX,n=void 0===o?150:o,r=e.radiusY,i=void 0===r?100:r,d=(new go.Geometry).add(new go.PathFigure(0,0).add(new go.PathSegment(go.PathSegment.SvgArc,2*n,0,n,i,0,1,a.clockwiseFlag?1:0)));return d.defaultStretch=go.GraphObject.Fill,d}},{key:"getNodeTemplate",value:function(){var e=this,t=this.diagram;return d(go.Node,"Spot",{_controlExpand:!0,__trtdNode:e,layerName:"Foreground",zOrder:15,movable:!0,isShadowed:!0,shadowColor:"#57617a",shadowOffset:new go.Point(0,0),visible:!0,locationSpot:go.Spot.Center,resizeCellSize:new go.Size(10,10),selectionObjectName:"SHAPE",resizable:!0,resizeObjectName:"SHAPE",rotatable:!1,location:new go.Point(0,0),toMaxLinks:1,mouseDrop:function(e,t){var a=t.part,o=e.diagram.selection.first();if("picGroup"==o.data.category&&"cbian"==o.data.role&&"centerText"==a.data.role){var n=e.diagram.findNodeForKey(a.data.olive);if(!n)return;for(var r=o.findSubGraphParts().iterator,i=[],d={};r.next();){var l=r.value;"autoText"==l.data.category&&("0 0 0 0"==l.data.locationSpot&&(d.shiText=l.data.text),"0 0.5 0 0"==l.data.locationSpot&&(d.centerText=l.data.text),"0 1 0 0"==l.data.locationSpot&&(d.xuText=l.data.text)),i.push(l.data)}e.diagram.startTransaction("mouseDrop"),e.diagram.model.removeNodeDataCollection(i);JSON.parse(JSON.stringify(o.data));return e.diagram.model.removeNodeData(o.data),e.diagram.__trtd.addOlive(n,d),void e.diagram.commitTransaction("mouseDrop")}if("coreText"==o.data.subRole&&"coreText"==a.data.subRole||"yunpanText"==o.data.subRole&&"yunpanText"==a.data.subRole){e.diagram.model.startTransaction("coreTextExchange");var c=o.data.orderX,s=o.data.orderY,g=o.data.dimKey;e.diagram.model.setDataProperty(o.data,"orderX",a.data.orderX),e.diagram.model.setDataProperty(o.data,"orderY",a.data.orderY),e.diagram.model.setDataProperty(o.data,"dimKey",a.data.dimKey),e.diagram.model.setDataProperty(a.data,"orderX",c),e.diagram.model.setDataProperty(a.data,"orderY",s),e.diagram.model.setDataProperty(a.data,"dimKey",g),e.diagram.model.commitTransaction("coreTextExchange")}if("dimText"==o.data.subRole&&"dimText"==a.data.subRole&&o.data.category==a.data.category){if(o.data.group!=a.data.group)return;if(!o.containingGroup)return;if("yunpanGroup"!=o.containingGroup.data.category)return;if(o.data.dimX!=a.data.dimX&&o.data.dimY!=a.data.dimY)return;e.diagram.model.startTransaction("dimTextExchange");var c=o.data.dimX,s=o.data.dimY,r=a.containingGroup.findSubGraphParts().iterator,u=[],p=[],m=[],f=[],h="X";0==o.data.dimX&&(h="Y");for(var y=o.data["dim"+h],v=a.data["dim"+h];r.next();){var l=r.value;"yunpanText"==l.data.subRole&&(l.data["order"+h]==v&&m.push(l),l.data["order"+h]==y&&f.push(l))}for(var k,w,b=0;b<m.length;b++)e.diagram.model.setDataProperty(m[b].data,"order"+h,y);for(var b=0;b<f.length;b++)e.diagram.model.setDataProperty(f[b].data,"order"+h,v);return e.diagram.model.setDataProperty(o.data,"dim"+h,v),e.diagram.model.setDataProperty(a.data,"dim"+h,y),void e.diagram.model.commitTransaction("dimTextExchange")}if("dimText"==o.data.subRole&&"dimText"==a.data.subRole){e.diagram.model.startTransaction("dimTextExchange");var c=o.data.dimX,s=o.data.dimY,r=a.containingGroup.findSubGraphParts().iterator,u=[],p=[],m=[],f=[],h="X";for(0==o.data.dimX&&(h="Y");r.next();){var l=r.value;l.data.dimKey==a.data.key&&u.push(l),l.data.dimKey==o.data.key&&p.push(l),"yunpanText"==l.data.subRole&&(l.data["order"+h]==a.data["order"+h]&&m.push(l),l.data["order"+h]==o.data["order"+h]&&f.push(l))}console.log("selnodeCoreTextsselnodeCoreTextsselnodeCoreTexts",p.length);var T=(a.containingGroup.__yunPointsX.length+1)/2,x=(a.containingGroup.__yunPointsY.length+1)/2;o.data.dimX>T&&p.sort(function(e,t){return e.data.orderX-t.data.orderX}),o.data.dimX==T&&(o.data.dimY>x?p.sort(function(e,t){return e.data.orderY-t.data.orderY}):p.sort(function(e,t){return t.data.orderY-e.data.orderY})),o.data.dimX<T&&p.sort(function(e,t){return t.data.orderX-e.data.orderX}),a.data.dimX>T&&u.sort(function(e,t){return e.data.orderX-t.data.orderX}),a.data.dimX==T&&(a.data.dimY>x?u.sort(function(e,t){return e.data.orderY-t.data.orderY}):u.sort(function(e,t){return t.data.orderY-e.data.orderY})),a.data.dimX<T&&u.sort(function(e,t){return t.data.orderX-e.data.orderX});for(var k,w,b=0;b<p.length;b++)k=p[b].data.orderX,w=p[b].data.orderY,e.diagram.model.setDataProperty(p[b].data,"orderX",u[b].data.orderX),e.diagram.model.setDataProperty(p[b].data,"orderY",u[b].data.orderY),e.diagram.model.setDataProperty(u[b].data,"orderX",k),e.diagram.model.setDataProperty(u[b].data,"orderY",w);e.diagram.model.setDataProperty(o.data,"dimX",a.data.dimX),e.diagram.model.setDataProperty(o.data,"dimY",a.data.dimY),e.diagram.model.setDataProperty(a.data,"dimX",c),e.diagram.model.setDataProperty(a.data,"dimY",s),e.diagram.model.commitTransaction("dimTextExchange")}if("wave"==o.data.category&&"centerText"==a.data.role&&a&&o.data.group==t.data.group){e.diagram.startTransaction("mouseDrop"),o.__oldOrder=o.data.order,e.diagram.model.setDataProperty(o.data,"order",a.data.order+.5);var S=e.diagram.model.findNodeDataForKey(o.data.xuText),P=e.diagram.model.findNodeDataForKey(o.data.shiText);e.diagram.model.setDataProperty(P,"order",a.data.order+.5),e.diagram.model.setDataProperty(S,"order",a.data.order+.5),e.diagram.commitTransaction("mouseDrop")}},mouseDragEnter:function(e,t){var a=t.part,o=e.diagram.selection.first();o&&(("coreText"==o.data.subRole&&"coreText"==a.data.subRole||"yunpanText"==o.data.subRole&&"yunpanText"==a.data.subRole)&&(o.areaBackground=null,a.areaBackground="RGB(107,208,137)"),"dimText"==o.data.subRole&&"dimText"==a.data.subRole&&(o.areaBackground=null,a.areaBackground="RGB(107,208,137)"),"centerText"==a.data.role&&(a.layerName="Background"))},mouseDragLeave:function(e,t){var a=t.part,o=e.diagram.selection.first();("coreText"==o.data.subRole&&"coreText"==a.data.subRole||"yunpanText"==o.data.subRole&&"yunpanText"==a.data.subRole)&&(a.areaBackground=null),"dimText"==o.data.subRole&&"dimText"==a.data.subRole&&(a.areaBackground=null),"centerText"==a.data.role&&(a.layerName="Foreground")},selectionChanged:function(e){if(console.log("selectionChanged",e),"autoText"==e.data.category&&null!=e.data.orderX&&null!=e.data.orderY&&"freeText"==e.data.role&&"coreText"==e.data.subRole&&"yunpanText"==e.data.subRole&&e.containingGroup&&"yunGroup"==e.containingGroup.data.category&&"yunpanGroup"==e.containingGroup.data.category&&"line"==e.containingGroup.data.beginSpark&&e.containingGroup.__yunPointsX&&e.containingGroup.__yunPointsY){var t=(e.containingGroup.__yunPointsX.length+1)/2,a=(e.containingGroup.__yunPointsY.length+1)/2;if(e.data.orderX==t&&e.data.orderY==a)return;var o=e.data.orderX,n=e.data.orderY;o==t&&(o=n),n==a&&(n=o);var r=e.containingGroup.data.shapeStrokes,i=e.containingGroup.data.showShape;if(e.isSelected){if("between"==e.containingGroup.data.snapType)var d=Math.max(Math.abs(e.data.orderX-t),Math.abs(e.data.orderY-a))+1;else var d=Math.max(Math.abs(e.data.orderX-t),Math.abs(e.data.orderY-a));console.log("diff:",d,e.data.orderX,e.data.orderY);var l=e.containingGroup.findSubGraphParts().iterator;console.log("showShape",i);for(var s=null;l.next();){var g=l.value;if("autoText"==g.data.category&&null!=g.data.orderX&&null!=g.data.orderY&&"freeText"==g.data.role&&(g.findObject("textBorder").visible=!1,(Math.abs(g.data.orderX-t)==Math.abs(o-t)&&Math.abs(g.data.orderY-a)<=Math.abs(n-a)||Math.abs(g.data.orderX-t)<=Math.abs(o-t)&&Math.abs(g.data.orderY-a)==Math.abs(n-a))&&(g.areaBackground="white",g.zOrder=999)),"shape"==g.data.category&&"background"==g.data.role){var u=g.findObject("SHAPE");g.data.gridWidth==2*d?(s=u,u.__prestroke||(u.__prestroke=u.stroke,u.stroke="rgba(255,0,0,0.5)")):u.__prestroke&&(u.stroke=u.__prestroke,delete u.__prestroke)}}if(!s){if("between"==e.containingGroup.data.snapType)var p=2*d;else var p=2*d;console.log("addShape"),e.diagram.model.startTransaction("addShape");var m={deletable:!0,role:"background",category:"shape",loc:go.Point.stringify(new go.Point(e.containingGroup.__yunPointsX[t-1],e.containingGroup.__yunPointsY[a-1])),movable:!0,group:-19,key:c.guid(),orderX:10,orderY:10,gridWidth:p,stroke:r[d-1],visible:!0,strokeDashArray:"[0,0]",strokeWidth:3};e.diagram.model.addNodeData(m),e.diagram.model.commitTransaction("addShape"),setTimeout(function(){var t=e.diagram.findNodeForKey(m.key);if(console.log("add shape add shape"),t){var a=t.findObject("SHAPE");a.__prestroke||(a.__prestroke=a.stroke,a.stroke="rgba(255,0,0,0.5)")}},100)}}else for(var l=e.containingGroup.findSubGraphParts().iterator;l.next();){var g=l.value;if("autoText"==g.data.category&&null!=g.data.orderX&&null!=g.data.orderY&&"freeText"==g.data.role&&(Math.abs(g.data.orderX-t)==Math.abs(o-t)&&Math.abs(g.data.orderY-a)<=Math.abs(n-a)||Math.abs(g.data.orderX-t)<=Math.abs(o-t)&&Math.abs(g.data.orderY-a)==Math.abs(n-a))&&(g.areaBackground=null,g.zOrder=NaN),"shape"==g.data.category&&"background"==g.data.role){var u=g.findObject("SHAPE");i||(u.stroke="rgba(255,0,0,0)"),g.data.gridWidth==2*d?u.__prestroke||(u.__prestroke=u.stroke,u.stroke="rgba(255,0,0,0.7)"):u.__prestroke&&(u.stroke=u.__prestroke,delete u.__prestroke)}}}},click:function(e,t){console.log(t.data)},mouseOver:function(e,t){console.log("mouseOvermouseOvermouseOver"),t.data.showBorder&&(""!=t.data.text||"xuText"!=t.data.role&&"shiText"!=t.data.role||(t.findObject("textBorder").visible=!0)),"centerText"==t.data.role&&(t.layerName="Background")},mouseLeave:function(e,t){t.data.showBorder&&(t.findObject("textBorder").visible=!1),"centerText"==t.data.role&&(t.layerName="Foreground")},layoutConditions:go.Part.LayoutStandard&go.Part.LayoutRemoved&go.Part.LayoutAdded&~go.Part.LayoutNodeSized,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,contextMenu:t.__trtd.getNodeContextMenu(),resizeAdornmentTemplate:d(go.Adornment,"Spot",d(go.Placeholder),d(go.Shape,"Circle",{alignment:go.Spot.BottomRight,cursor:"col-resize",desiredSize:new go.Size(15,15),fill:"lightblue",stroke:"dodgerblue"})),doubleClick:function(e,t){e.diagram.__trtd.selectText(e,t)}},new go.Binding("locationSpot","locationSpot",function(e){return go.Spot.parse(e)}).makeTwoWay(function(e){return go.Spot.stringify(e)}),new go.Binding("type","type",function(e){return go.Panel[e]}),new go.Binding("visible","visible").makeTwoWay(),new go.Binding("deletable","deletable").makeTwoWay(),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("rotatable","rotatable").makeTwoWay(),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("angle","angle").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("copyable","copyable").makeTwoWay(),new go.Binding("layerName","layerName",function(e,t){return e||""}),d(go.Shape,{strokeDashArray:null,opacity:.7,stretch:go.GraphObject.UniformToFill,name:"SHAPE",figure:"Circle",fill:"rgba(0,255,0,1)",fromLinkable:!1,toLinkable:!1,width:100,height:100,cursor:"pointer",minSize:new go.Size(50,50),strokeWidth:1,stroke:"black",portId:""},new go.Binding("strokeDashArray","shiStrokeDashArray",function(e){return JSON.parse(e)}).makeTwoWay(function(e){return JSON.stringify(e)}),new go.Binding("fill","fill",function(e,t){return e instanceof go.Brush?e.color:e}).makeTwoWay(),new go.Binding("desiredSize","desiredSize",function(e,t){return go.Size.parse(e)}).makeTwoWay(function(e){return console.log("sizesizesizesize"),go.Size.stringify(e)}),new go.Binding("stroke","stroke",function(e){return e instanceof go.Brush?e.stroke:e}).makeTwoWay(),new go.Binding("strokeWidth","strokeWidth",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("figure","figure").makeTwoWay(),new go.Binding("opacity","opacity").makeTwoWay()),d(go.TextBlock,{name:"TEXT",alignment:new go.Spot(.5,.5),font:"18px 'Microsoft YaHei'",editable:!1,stroke:"black",isMultiline:!0,overflow:go.TextBlock.OverflowClip,wrap:go.TextBlock.WrapDesiredSize,textAlign:"center",verticalAlignment:go.Spot.Center,spacingAbove:4,spacingBelow:4,portId:"TEXT",margin:0,maxSize:new go.Size(600,NaN),minSize:new go.Size(10,10),stretch:go.GraphObject.UniformToFill,textEdited:function(e,t,a){var o=e.part;""!=a.trim()||"shiText"!=o.data.role&&"xuText"!=o.data.role||(e.part.diagram.model.startTransaction("text"),e.part.diagram.model.setDataProperty(e.part.data,"nloc",null),e.part.diagram.model.commitTransaction("text")),e.part.data.role&&e.part.data.role.indexOf("labelText")>-1&&(e.part.containingGroup.layout.isValidLayout=!1)}},new go.Binding("background","background",function(e){return e}).makeTwoWay(),new go.Binding("areaBackground","areaBackground",function(e){return e}).makeTwoWay(),new go.Binding("textAlign","textAlign",function(e){return e}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return c.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return c.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("maxSize","",function(e,t,a){var o=NaN,n=NaN;return e.width&&(o=e.width),e.height&&(n=e.height),new go.Size(o,n)}),new go.Binding("minSize","minSize",function(e){return go.Size.parse(e)}),new go.Binding("text","text").makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay()))}}]),t}(l);e.exports=s},function(e,t,a){"use strict";function o(){go.Link.call(this)}function n(e,t){var a,o;return t>=0&&t<=90?(a=e*Math.sin(t*Math.PI/180),o=e*Math.cos(t*Math.PI/180),[o,a]):t>90&&t<=180?(a=e*Math.sin((180-t)*Math.PI/180),o=e*Math.cos((180-t)*Math.PI/180),[-o,a]):t>180&&t<=270?(a=e*Math.sin((t-180)*Math.PI/180),o=e*Math.cos((t-180)*Math.PI/180),[-o,-a]):t>270&&t<=360?(a=e*Math.sin((360-t)*Math.PI/180),o=e*Math.cos((360-t)*Math.PI/180),[o,-a]):void 0}function r(e,t,a){var o=new go.Point((t.x+a.x)/2,(t.y+a.y)/2);if(e.equals(t)){var r=o.copy(),i=Math.sqrt(o.distanceSquaredPoint(t)),d=(t.directionPoint(a)+90)%360,l=.15*i,c=n(l,d);return r.offset(c[0],c[1]),i=Math.sqrt(r.distanceSquaredPoint(t)),[i,r.x,r.y]}var s=Math.sqrt(e.distanceSquaredPoint(o)),g=e.directionPoint(o);if(e.distanceSquaredPoint(a)<e.distanceSquaredPoint(t))var u=a.directionPoint(t);else var u=t.directionPoint(a);var p=Math.abs(g-u);p>90&&p<180?p=180-p:p>=180&&(p=360-p);var m=s*Math.cos(p*Math.PI/180),c=n(m,u),r=e.copy();r.offset(c[0],c[1]);var i=Math.sqrt(r.distanceSquaredPoint(t));return[i,r.x,r.y]}function i(e,t,a){var o;o=arguments[3]?arguments[3]:triangleCircle(e,t,a);var r=o[0],i=new go.Point(o[1],o[2]),d=Math.abs(i.directionPoint(e)-i.directionPoint(a));d=d>180?360-d:d;var l=r/Math.cos(d/3*Math.PI/180),c=new go.Geometry(go.Geometry.Line);c.startX=i.x,c.startY=i.y,c.endX=e.x,c.endY=e.y,c.rotate(d/3,i.x,i.y);var s,g=i.direction(c.endX,c.endY);o=n(l,g),s=i.copy().offset(o[0],o[1]),c.rotate(d/3,i.x,i.y),g=i.direction(c.endX,c.endY);var u;return o=n(l,g),u=i.copy().offset(o[0],o[1]),[s,u]}function d(e){return l(o,{curve:go.Link.Bezier,layerName:"",isTreeLink:!0,curviness:30,adjusting:go.Link.Stretch,relinkableFrom:!0,relinkableTo:!0,reshapable:!0,layoutConditions:go.Part.LayoutStandard&~go.Part.LayoutNodeSized,mouseDragEnter:function(e,t){var a=t.part,o=a.findObject("SHAPE");o._preStoke=o.stroke,o.stroke="darkred",o._preStrokeWidth=o.strokeWidth,o.strokeWidth=5},mouseDragLeave:function(e,t){var a=t.part,o=a.findObject("SHAPE");o.stroke=o._preStoke,o.strokeWidth=o._preStrokeWidth},mouseDrop:function(e,t){var a=t.part,o=e.diagram.selection.first();if(!(!o instanceof go.Node||!o instanceof go.Group||1==o.data.key)){var n=a.fromNode;a.toNode.data.parent==n.data.key?e.diagram.__trtd.setNodeAsChildren(o,n):e.diagram.__trtd.setNodeAsSibling(o,n)}}},l(go.Shape,{name:"SHAPE",stroke:"#767678",strokeWidth:3},new go.Binding("strokeWidth","strokeWidth").makeTwoWay(),new go.Binding("stroke","color").makeTwoWay(),new go.Binding("strokeDashArray","strokeDashArray",function(e){try{var t=[parseInt(e.split(" ")[0]),parseInt(e.split(" ")[1])]}catch(e){var t=null}return t}).makeTwoWay(function(e){return e[0]+" "+e[1]})),l(go.Shape,{name:"Arrow",toArrow:"Triangle",stroke:"#767678",strokeWidth:3},new go.Binding("strokeWidth","strokeWidth"),new go.Binding("fill","color"),new go.Binding("stroke","color"),new go.Binding("toArrow","toArrow")),new go.Binding("curviness","curviness").makeTwoWay(),new go.Binding("points").makeTwoWay())}Object.defineProperty(t,"__esModule",{value:!0});var l=go.GraphObject.make;go.Diagram.inherit(o,go.Link),o.prototype.makeGeometry=function(){var e=go.Link.prototype.makeGeometry.call(this);return e.type!==go.Geometry.Path||e.figures.length,e},o.prototype.computePoints=function(){var e=this.diagram;if(null==this.fromNode||null==this.toNode)return!0;if(this.fromNode.location.equals(this.toNode.location))return!1;var t=this.fromNode.location.copy(),a=this.toNode.location.copy();if(!t.isReal()||!a.isReal())return!0;var o=t,n=a,d=e.findNodeForKey(this.toNode.data.parent);if(!d)return!0;d=d.location;var l=r(d,o,n),c=l,s=new go.Point(c[1],c[2]);this.micenter=s;var g=c[0],u=this.fromNode.actualBounds.width/2,p=this.toNode.actualBounds.width/2,m=(2*g*g-u*u)/(2*g),f=180*Math.acos(m/g)/Math.PI,h=new go.Geometry(go.Geometry.Line);h.startX=s.x,h.startY=s.y,h.endX=this.fromNode.location.x,h.endY=this.fromNode.location.y,f||(f=0),h.rotate(f,s.x,s.y);var y=new go.Point(h.endX,h.endY);m=(2*g*g-p*p)/(2*g),f=180*Math.acos(m/g)/Math.PI,h.endX=this.toNode.location.x,h.endY=this.toNode.location.y,f||(f=0),h.rotate(-f,s.x,s.y);var v=new go.Point(h.endX,h.endY),k=i(y,null,v,c);k[0],k[1];this.clearPoints(),(isNaN(y.x)||isNaN(y.y))&&(y=this.fromNode.location.copy()),(isNaN(v.x)||isNaN(v.y))&&(v=this.toNode.location.copy()),this.points.add(y),this.points.add(k[0]),this.points.add(k[1]),this.points.add(v);return!0},t.default=d,e.exports=t.default},function(e,t,a){"use strict";function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){var t=e.selection.first();if(t.data.istemp){e.model.startTransaction();var a=e.findNodeForKey(t.data.parent);e.model.setDataProperty(t.data,"istemp",void 0);for(var o=null;a;){if(!a.data.istemp){o&&e.model.setDataProperty(a.data,"isparent",o.data.key);break}e.model.setDataProperty(a.data,"istemp",void 0),e.model.setDataProperty(a.data,"text","双击编辑内容"),o=a,a=e.findNodeForKey(a.data.parent)}e.model.commitTransaction(),e.isModified=!0}}function c(e,t){var a=t.__trtd.tdCurrentTheme;if(t.model.setDataProperty(e,"strokeWidth",a.borderWidth),t.model.setDataProperty(e,"stroke",a.borderColor),null==a.colorRange)t.model.setDataProperty(e,"fill",randomColor({luminosity:"light",count:1})[0]);else if(a.colorRange instanceof Array){var o="white";o=e.level>=a.colorRange.length?a.colorRange[e.level%a.colorRange.length]:a.colorRange[e.level],t.model.setDataProperty(e,"fill",o)}else if("random"==a.colorRange)if(e.prev){var n=t.findNodeForKey(e.prev);n?t.model.setDataProperty(e,"fill",n.data.fill):t.model.setDataProperty(e,"fill",randomColor({luminosity:"light",count:1})[0])}else t.model.setDataProperty(e,"fill",randomColor({luminosity:"light",count:1})[0]);else"white"==a.colorRange?t.model.setDataProperty(e,"fill","white"):t.model.setDataProperty(e,"fill","rgba(0,0,0,0)");return e}function s(e,t){var a=e.sweep?e.sweep:360,t=e.layerThickness||100,o=e.dradius?e.dradius:100,n=new go.Point(o+t,0).rotate(-a/2),r=new go.Point(o,0).rotate(a/2),i=(new go.Geometry).add(new go.PathFigure(n.x,n.y).add(new go.PathSegment(go.PathSegment.Arc,-a/2,a,0,0,o+t,o+t)).add(new go.PathSegment(go.PathSegment.Line,r.x,r.y)).add(new go.PathSegment(go.PathSegment.Arc,a/2,-a,0,0,o,o).close()));return i.normalize(),i}function g(e){return e.nodeDataArray.find(function(e){if(!e.isGroup&&"Root"==e.category&&0==e.level)return!0})}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),p=a(0),m=a(14),f=a(2),h=a(11).Trtd,y=go.GraphObject.make,v=function(e){function t(e,a){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return o.config=a,o.modelChangedListener=a.modelChangedListener,o.type=a.type,o.diagram={},o.model=a.model,o.readOnly=!1,null!=a.readOnly&&(o.readOnly=a.readOnly),o.initDiagramBase(e,a),o.diagram=o.initDiagram(e,a),o.initListener(),o.model&&o.initModel(),o}return d(t,e),u(t,[{key:"initDiagram",value:function(e,t){var a=this.diagram,o={"undoManager.isEnabled":!0,allowMove:!0,"animationManager.isEnabled":!1},n=Object.assign(o,t.diagramConfig);return this.diagram.setProperties(n),this.addNodeTemplate(),a}},{key:"getTdData",value:function(){return this.diagram.model.toJson()}},{key:"getDefaultCustomMenuDivStr",value:function(){return'\n        <ul>\n            <li trtd_action="addFollowerGround"><a class="i18n" data-lang="insertsl">增加同级节点</a></li>\n            <li trtd_action="addNewCircle"><a class="i18n" data-lang="icn">增加子节点</a></li>\n            <li trtd_action="apiDeleteSelection"><a class="i18n" data-lang="remove">删除</a></li>\n        </ul>\n        '}},{key:"getShowContextMenus",value:function(e){return e?"addFollowerGround,addNewCircle,apiDeleteSelection":"none"}},{key:"addTextNode",value:function(e){console.log("eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee:");var t=this.diagram;t.startTransaction();var a={text:e||m.trans("blankText"),category:"text"};a.loc=go.Point.stringify(t.lastInput.documentPoint),t.model.addNodeData(a),t.commitTransaction()}},{key:"initModel",value:function(e){e&&(this.model=e),console.log("initModel");var t=go.Model.fromJson(this.model);"dipan"==t.modelData.currentType&&(t.nodeDataArray=t.nodeDataArray.filter(function(e){if(!e.isGroup)return delete e.group,!0}),t.linkDataArray=[]),this.diagram.layout.isInitial=!1,t.modelData.type=this.type,this.diagram.model=t,this.groundLayout(this.diagram),this.diagram.updateAllTargetBindings()}},{key:"loadModel",value:function(e){this.initModel(e)}},{key:"initListener",value:function(){console.log("initListener")}},{key:"addNodeTemplate",value:function(){var e=this.diagram,t=this.tdGetModelData(null,e.model,e),a=parseInt(t.layerThickness);console.log(a);var o=t.tdDipanTextAngle;console.log(o),e.nodeTemplateMap.add("dipan",this.createDipanTemplate(a,o)),e.nodeTemplateMap.add("Root",this.getDipanRootTemplate(a)),e.nodeTemplateMap.add("3",f(this.diagram))}},{key:"createTextNodeTemplate",value:function(){var e={figure:"Rectangle",fill:"rgba(0,0,0,0)",strokeWidth:1,stroke:"rgba(0,0,0,0)",fontSize:15,font:"sans-serif"};return y(go.Node,"Spot",{_controlExpand:!0,layerName:"Foreground",locationSpot:go.Spot.Center,resizeCellSize:new go.Size(10,10),locationObjectName:"SHAPE",resizable:!0,resizeObjectName:"SHAPE",rotatable:!0,location:new go.Point(0,0),toMaxLinks:1,layoutConditions:go.Part.LayoutStandard,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,contextMenu:this.getNodeContextMenu},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("angle","angle").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("layerName","layerName",function(e,t){return e||""}).makeTwoWay(function(e){return e}),y(go.Shape,{strokeDashArray:null,name:"SHAPE",figure:"Rectangle",fill:"rgba(0,0,0,0)",fromLinkable:!0,toLinkable:!0,cursor:"pointer",minSize:new go.Size(50,50),strokeWidth:2,stroke:"rgba(0,0,0,0)",portId:"",width:150},new go.Binding("strokeDashArray","strokeDashArray",function(e){return[e.split()[0],e.split()[1]]}).makeTwoWay(function(e){return e[0]+" "+e[1]}),new go.Binding("fill","fill",function(e,t){return e instanceof go.Brush?e.color:e}).makeTwoWay(),new go.Binding("width","width",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("height","height",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("stroke","stroke",function(e){return e instanceof go.Brush?e.stroke:e}).makeTwoWay(),new go.Binding("strokeWidth","strokeWidth",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("figure","figure").makeTwoWay(),{figure:e.figure,fill:e.fill,strokeWidth:e.strokeWidth,stroke:e.stroke}),y(go.Shape,{name:"SHAPE_Back",figure:"Rectangle",fill:"rgba(0,0,0,0)",strokeWidth:0},new go.Binding("width","width",function(e){return e}).ofObject("SHAPE"),new go.Binding("height","height",function(e){return e}).ofObject("SHAPE")),y(go.TextBlock,{name:"TEXT",alignment:new go.Spot(.5,.5),font:"bold 22px 幼圆",editable:!0,stroke:"black",isMultiline:!0,overflow:go.TextBlock.OverflowClip,wrap:go.TextBlock.WrapDesiredSize,textAlign:"center",spacingAbove:4,spacingBelow:4,portId:"TEXT",stretch:go.GraphObject.Fill},new go.Binding("textAlign","textAlign",function(e){return _.contains(["start","center","end"],e)?e:"center"}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return p.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return p.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("width","width",function(e){return e}).ofObject("SHAPE"),new go.Binding("text","text").makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay()))}},{key:"createDipanTemplate",value:function(e,t){if(console.log(e),null==e)var e=100;if(null==t)var t="zhengli";var a=this,o=go.GraphObject.make;return o(go.Node,"Spot",{locationSpot:go.Spot.Center,locationObjectName:"MAIN",selectionObjectName:"SHAPE",click:function(e,t){console.log(t.data),a.readOnly&&t.diagram.__trtd.nodeClickListener&&t.diagram.__trtd.nodeClickListener(t)},contextMenu:this.getNodeContextMenu,movable:!1,doubleClick:function(e){if(console.log("that.readOnlythat.readOnly",a.readOnly),!a.readOnly){var t=e.diagram;if(t.selection.first()){var o=t.selection.first().findObject("TEXT");o&&t.commandHandler.editTextBlock(o),p.simulateEnterWithAlt(e),l(t)}}},selectionAdorned:!a.readOnly,selectionAdornmentTemplate:o(go.Adornment,"Spot",o(go.Panel,"Auto",o(go.Shape,{fill:"rgba(255,232,211,0.1)",stroke:"blue",strokeWidth:2}),o(go.Placeholder)),o("Button",{alignment:go.Spot.RightCenter,alignmentFocus:go.Spot.Bottom,width:30,height:30,click:function(e){console.log(e.diagram.selection.first().data),console.log(e.diagram.selection.first().data.parent);var t=e.diagram.selection.first();if(t.data.parent){if(t.diagram.findNodeForKey(t.data.parent).data.istemp)return}a.addNewCircle(e)}},o(go.Shape,"PlusLine",{desiredSize:new go.Size(15,15)})),o("Button",{alignment:go.Spot.BottomCenter,width:30,height:30,click:function(e){console.log(e),console.log(e.diagram.selection.first().data),e.diagram.selection.first().data.istemp||a.addFollowerGround(e)}},o(go.Shape,"PlusLine",{desiredSize:new go.Size(15,15)}))),mouseOver:function(e,t){},mouseLeave:function(e,t){},mouseDragEnter:function(e,t,a){},mouseDragLeave:function(e,t,a){},mouseDrop:function(e,t){}},new go.Binding("angle","dangle"),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("selectionAdorned","selectionAdorned",function(e,t){return console.log(e),e||""}).makeTwoWay(function(e){return e}),o(go.Shape,{figure:"Rectangle",name:"MAIN",fill:"rgba(255,255,0,0)",strokeWidth:0,stroke:"red",height:1},new go.Binding("width","layerThickness",function(e){return parseInt(e||100)})),o(go.Shape,{name:"SHAPE",fill:"lightgray",strokeWidth:2,margin:5,stroke:"green",alignment:go.Spot.Right,alignmentFocus:go.Spot.Right,portId:""},new go.Binding("geometry","",function(e){return s(e)}),new go.Binding("fill","fill",function(e){return e instanceof go.Brush?e.color:e}).makeTwoWay(),new go.Binding("stroke","stroke",function(e){return e instanceof go.Brush?e.stroke:e}).makeTwoWay(),new go.Binding("strokeWidth","strokeWidth",function(e){return e}).makeTwoWay(function(e){return e})),o(go.Shape,{figure:"Rectangle",name:"LOCATE",fill:"rgba(0,255,0,0)",strokeWidth:0,stroke:"green",height:20,alignment:go.Spot.Right,alignmentFocus:go.Spot.Right},new go.Binding("width","layerThickness",function(e){return parseInt(e||100)})),o(go.TextBlock,{name:"TEXT",isMultiline:!0,click:function(e,t){},textAlign:"center",editable:!1,wrap:go.TextBlock.WrapDesiredSize,overflow:go.TextBlock.OverflowClip,spacingAbove:4,spacingBelow:4,font:"bold 15px 幼圆"},new go.Binding("text").makeTwoWay(),new go.Binding("textAlign","textAlign",function(e){return _.contains(["start","center","end"],e)?e:"center"}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return p.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return p.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay(),new go.Binding("width","",function(e,t){var a=e.tdDipanTextAngle||"xuanzhuan",o=parseInt(e.layerThickness||100),n=e.sweep/180*e.dradius*Math.PI*.7;return"fangshe"==a?n:"zhengli"==a?.7*o:"xuanzhuan"==a?.7*o:void 0}),new go.Binding("angle","textAngle").makeTwoWay(),new go.Binding("alignment","tdDipanTextAngle",function(e){var t=e||"xuanzhuan",a=go.Spot.Center;switch(t){case"xuanzhuan":a=go.Spot.Center;break;case"fangshe":a=go.Spot.Left;break;case"zhengli":a=go.Spot.Center}return a}),new go.Binding("alignmentFocus","tdDipanTextAngle",function(e){var t=e||"xuanzhuan",a=go.Spot.Center;switch(t){case"xuanzhuan":a=go.Spot.Center;break;case"fangshe":a=go.Spot.Left;break;case"zhengli":a=go.Spot.Center}return a})))}},{key:"getDipanRootTemplate",value:function(e){var t,a=this,n=this;return y(go.Node,"Auto",(t={locationSpot:go.Spot.Center,selectionAdorned:!0,movable:!1,click:function(e,t){console.log(t.data),n.readOnly&&t.diagram.__trtd.nodeClickListener&&t.diagram.__trtd.nodeClickListener(t)},doubleClick:function(e){if(!n.readOnly){var t=e.diagram;if(t.selection.first()){var a=t.selection.first().findObject("TEXT");a&&t.commandHandler.editTextBlock(a),p.simulateEnterWithAlt(e)}}},mouseOver:function(e,t){},mouseLeave:function(e,t){}},o(t,"selectionAdorned",!n.readOnly),o(t,"selectionAdornmentTemplate",y(go.Adornment,"Spot",y(go.Panel,"Auto",y(go.Shape,{fill:"rgba(255,232,211,0.1)",stroke:"blue",strokeWidth:2}),y(go.Placeholder)),y("Button",{alignment:go.Spot.RightCenter,alignmentFocus:go.Spot.Bottom,width:30,height:30,click:function(e){console.log(e.diagram.selection.first().data),console.log(e.diagram.selection.first().data.parent);var t=e.diagram.selection.first();if(t.data.parent){if(t.diagram.findNodeForKey(t.data.parent).data.istemp)return}a.addNewCircle(e)}},y(go.Shape,"PlusLine",{desiredSize:new go.Size(15,15)})))),o(t,"location",new go.Point(0,0)),t),new go.Binding("width","layerThickness",function(e){return e?2*e:200}),new go.Binding("height","layerThickness",function(e){return e?2*e:200}),y(go.Shape,"Circle",{name:"SHAPE",fill:"#FFBFBF",strokeWidth:0,spot1:go.Spot.TopLeft,spot2:go.Spot.BottomRight},new go.Binding("fill","fill",function(e){return e instanceof go.Brush?e.color:e}).makeTwoWay(),new go.Binding("stroke","stroke",function(e){return e instanceof go.Brush?e.stroke:e}).makeTwoWay(),new go.Binding("strokeWidth","strokeWidth",function(e){return e}).makeTwoWay(function(e){return e})),y(go.TextBlock,{name:"TEXT",font:"bold 23px 幼圆",textAlign:"center",editable:!1,spacingAbove:4,isMultiline:!0,spacingBelow:4},new go.Binding("textAlign","textAlign",function(e){return _.contains(["start","center","end"],e)?e:"center"}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return p.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return p.tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("text").makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("width","width").makeTwoWay(),new go.Binding("font","font").makeTwoWay(),new go.Binding("angle","textAngle").makeTwoWay()))}},{key:"tdGetModelData1",value:function(e,t,a){var o={currentType:"dipan",currentThemeID:0,layerThickness:100,splitLayer:1,layout:"inner",tdDipanTextAngle:"xuanzhuan"};return Object.assign(o,t.modelData)}},{key:"tdGetModelData",value:function(e,t){var a=this.diagram,t=a.model,o={currentType:"tianpan",currentThemeID:0,layerThickness:100,splitLayer:1,layout:"inner",tdDipanTextAngle:"xuanzhuan"};console.log("getRootNodeData1111111111111111111111");var n=g(t);if(void 0!==e&&null!=e)return n?n[e]||t.modelData[e]||o[e]:t.modelData[e]||o[e];if(n)for(var r in o)n[r]?o[r]=n[r]:t.modelData&&t.modelData[r]&&(o[r]=t.modelData[r]);else for(var r in o)t.modelData&&t.modelData[r]&&(o[r]=t.modelData[r]);return o}},{key:"deleteSelection",value:function(){var e=this.diagram,t=e.selection.first();console.log("删除节点 "+JSON.stringify(t.data)),console.log(t.data);var a=(e.commandHandler,null);if(t&&!t.data.istemp&&1!=t.data.key&&"g_1"!=t.data.key&&"Root"!=t.data.key){e.model.startTransaction("all"),e.model.startTransaction("level1"),e.model.setDataProperty(t.data,"istemp",!0),this.deleteNode(t,e);var o=this.getMaxCircle(e),n=[];e.model.nodeDataArray.forEach(function(e){e.level>o&&n.push(e)}),e.model.removeNodeDataCollection(n),e.model.nodeDataArray.forEach(function(t){t.level==o&&null!=t.isparent&&e.model.setDataProperty(t,"isparent",null)}),e.model.removeNodeData(t.data),e.model.commitTransaction("level1"),this.groundLayout(e),e.model.commitTransaction("all");for(var a=null,r=["next","prev","parent"],i=0;i<r.length;i++)if(t.data[r[i]]){a=e.findNodeForKey(t.data[r[i]]);break}a&&e.select(a)}}},{key:"deleteNode",value:function(e){console.log("删除节点 deleteNode"),console.log(e.data.key),console.log(e.data);var t=this.diagram,a=e.data.prev?t.findNodeForKey(e.data.prev):null,o=e.data.next?t.findNodeForKey(e.data.next):null,n=e.data.parent?t.findNodeForKey(e.data.parent):null;if(e.data.isparent){var r=t.findNodeForKey(e.data.isparent),i=[];p.tdTravelTdpData(r.data,t.model,i,function(e){return e}),t.model.removeNodeDataCollection(i);this.getMaxCircle(t)}if(null!=n&&(n.data.isparent==e.data.key?null==o?t.model.setDataProperty(n.data,"isparent",void 0):(t.model.setDataProperty(n.data,"isparent",o.data.key),t.model.setDataProperty(o.data,"prev",void 0)):(t.model.setDataProperty(a.data,"next",null==o?null:o.data.key),null!=o&&t.model.setDataProperty(o.data,"prev",a.data.key))),"dipan"==t.model.modelData.currentType){for(var d=0,l=0;l<t.model.nodeDataArray.length&&(t.model.nodeDataArray[l].istemp||t.model.nodeDataArray[l].isGroup||d++,!(d>1));l++);if(d<=1){console.log("删除的只剩下root节点时对root节点做处理");delete t.model.findNodeDataForKey(1).group}}t.isModified=!0}},{key:"getMaxCircle",value:function(){var e=this.diagram,t=0,a=[],o=[],n=[],r=[];e.model.nodeDataArray.forEach(function(e){e.istemp||e.isGroup?r.push(e):(a.push(e),e.level&&o.push(e.level))});var i=Math.max.apply(null,o);return a.forEach(function(e){e.level===i&&n.push(e)}),i===-1/0&&0===n.length?(console.log("11111111111111"),t=0):i!==-1/0&&0===n.length?t=i-1:n.length>0&&(t=i),t}},{key:"addNewCircle",value:function(e){var t=this.diagram,a=this.getMaxCircle(),o=t.selection.first();if(console.log(o.data),o&&(!o.data.isparent||!t.findNodeForKey(o.data.isparent)||t.findNodeForKey(o.data.isparent).visible)){t.model.startTransaction("addNewCircle"),"istemp"in o.data&&o.data.istemp&&(l(t),""==o.data.text&&t.model.setDataProperty(o.data,"text",m.trans("dce")));var n=null;if(o.data.isparent&&(n=t.model.findNodeDataForKey(o.data.isparent)),null!=n&&n.istemp)t.model.setDataProperty(n,"istemp",!1),t.model.setDataProperty(n,"text",m.trans("dce"));else{var r=this.addChildNodeData(o);r.level>a&&(a=r.level),this.groundLayout(t)}t.model.commitTransaction("addNewCircle")}}},{key:"addChildNodeData",value:function(e){console.log("===================================addChildNodeData:去掉连线和group、主题");var t=(null==window.localStorage.getItem("isautolayout")||window.localStorage.getItem("isautolayout"),e.diagram),a=arguments[1]?arguments[1]:null,o=(t.model.nodeDataArray.length+1).toString(),n={key:o,text:m.trans("dce")};t.model.makeNodeDataKeyUnique(n),o=n.key;var r=null;n.level=e.data.level+1,n.parent=e.data.key,n.prev=void 0,e.data.isparent&&(r=t.model.findNodeDataForKey(e.data.isparent))&&(n.next=r.key,t.model.setDataProperty(r,"prev",n.key)),null!=a&&(n.istemp=!0,n.text="");var i=t.model.modelData.layerThickness;return console.log(" myDiagram.model",t.model),n.dangle=e.data.dangle,n.dradius=e.data.dradius,n.sweep=e.data.sweep,n.layerThickness=i||100,n.tdDipanTextAngle=e.data.tdDipanTextAngle||"xuanzhuan",0!=e.data.level&&(n.category=e.data.category),"Root"==e.data.category&&(n.category="dipan"),n.strokeWidth=e.data.strokeWidth,e.data.figure&&(n.figure=e.data.figure),e.data.picture&&(n.picture=e.data.picture),e.data.width&&(n.width=e.data.width),e.data.height&&(n.height=e.data.height),n=c(n,t),n.font=e.data.font,n.textStroke=e.findObject("TEXT").stroke,t.model.setDataProperty(e.data,"isparent",o),n.newAdd=!0,t.model.addNodeData(n,t),t.isModified=!0,n}},{key:"addFollowerGround",value:function(e){var t=this.diagram;if(0!=t.selection.count){var a=t.selection.first();if(1!=a.data.key&&a){var o=a.diagram;if(null!==a&&a instanceof go.Node&&!(a instanceof go.Group)){t.model.startTransaction("all"),"istemp"in a.data&&a.data.istemp&&(l(t),""==a.data.text&&t.model.setDataProperty(a.data,"text","")),t.startTransaction("sub1");var n=this.addLevelNodeData(a);t.commitTransaction("sub1"),this.groundLayout(t),t.model.commitTransaction("all");var r=o.findNodeForData(n);r&&o.select(r)}}}}},{key:"addLevelNodeData",value:function(e){console.log("======================去掉天盘");var t=(null==window.localStorage.getItem("isautolayout")||window.localStorage.getItem("isautolayout"),this.diagram),a=e.data.next,o=(t.model.nodeDataArray.length+1).toString(),n={key:o,text:m.trans("dce"),color:"yellow"};t.model.makeNodeDataKeyUnique(n),o=n.key;var r=null;if(a)var r=t.model.findNodeDataForKey(a);t.model.startTransaction(),n=c(n,t);return null!=r&&(n.next=r.key,t.model.setDataProperty(r,"prev",n.key)),n.level=e.data.level,n.radius=e.data.radius,n.fill=e.data.fill,n.dangle=e.data.dangle,n.dradius=e.data.dradius,n.sweep=e.data.sweep,n.layerThickness=e.data.layerThickness||100,n.tdDipanTextAngle=e.data.tdDipanTextAngle||"xuanzhuan",n.parent=e.data.parent,n.prev=e.data.key,n.strokeWidth=e.data.strokeWidth,n.stroke=e.data.stroke,n.font=e.data.font,n.textStroke=e.findObject("TEXT").stroke,e.data.figure&&(n.figure=e.data.figure),n.loc=e.data.loc,e.data.width&&(n.width=e.data.width),e.data.height&&(n.height=e.data.height),n.category=e.data.category,n.newAdd=!0,t.model.addNodeData(n),t.model.setDataProperty(e.data,"next",o),t.model.commitTransaction(),t.isModified=!0,n}},{key:"moveWithinNodes",value:function(e){var t=this.diagram,a=t.selection.first();if(a){if(!a)return void t.select(t.findNodeForKey(1));switch(e){case"left":if(a.data.prev){var o=t.findNodeForKey(a.data.prev);o&&t.select(o)}break;case"up":if(a.data.parent){var o=t.findNodeForKey(a.data.parent);o&&t.select(o)}break;case"right":if(a.data.next){var o=t.findNodeForKey(a.data.next);o&&t.select(o)}break;case"down":if(a.data.isparent){var o=t.findNodeForKey(a.data.isparent);o&&t.select(o)}}}}},{key:"selectText",value:function(e){var t=this.diagram;if(t.selection.first()){var a=t.selection.first().findObject("TEXT");a&&t.commandHandler.editTextBlock(a),p.simulateEnterWithAlt(e)}}},{key:"groundLayout",value:function(e){function t(e,o,n,r,d,c,s){i.addChildNodeData;try{var g=a(e)}catch(e){console.error(e)}e.data.key;if(!(e.data.category>=3)){var u=g.length;if(!(0===u&&e.data.level>=l)){if(0===u){var p=i.addChildNodeData(e,"temp"),m=s.findNodeForData(p);g.push(m),u++}for(var f=s.model.findNodeDataForKey(1),h=parseInt(f.layerThickness),y=h+(o-1)*d,v=r/u,k=n-r/2+v/2,w=0;w<u;w++){var b=g[w],T=k+w*v,x=new go.Point(y+d/2,0);if(b.data._laid)t(b,o+1,b.data.dangle,b.data.sweep,d,c,s);else{x.rotate(T),b.diagram.model.setDataProperty(b.data,"loc",go.Point.stringify(x)),b.data._laid=!0,b.diagram.model.setDataProperty(b.data,"dangle",T),b.diagram.model.setDataProperty(b.data,"sweep",v),b.diagram.model.setDataProperty(b.data,"dradius",y),b.diagram.model.setDataProperty(b.data,"layerThickness",d);var S=b.findObject("TEXT");null!==S&&(S.angle=T>90&&T<270||T<-90?180:0,"xuanzhuan"==c&&b.diagram.model.setDataProperty(b.data,"textAngle",S.angle),"fangshe"==c&&b.diagram.model.setDataProperty(b.data,"textAngle",90),"zhengli"==c&&b.diagram.model.setDataProperty(b.data,"textAngle",-T)),"1"==b.data.key&&b.diagram.model.setDataProperty(b.data,"textAngle",0),t(b,o+1,T,r/u,d,c,s)}}}}}function a(e){try{if(!e.data.isparent)return[];var t,a=[];if(!e.data.isparent)return[];var o=e.diagram.findNodeForKey(e.data.isparent);if(t=o)for(a.push(o);t.data.next&&(t=e.diagram.findNodeForKey(t.data.next));)a.push(t);return a}catch(e){console.error(e)}}function o(e,t,a,o){var n={count:0,list:[]},r=!1;try{if(1==e.key)t.nodeDataArray.forEach(function(e){r=o?e.level>=a:e.level==a,!_.has(e,"isGroup")&&r&&(n.count+=1,n.list.push(e))});else{if(!e.isparent)return n;var i=t.findNodeDataForKey(e.isparent);p.tdTravelTdpData(i,t,[],function(e){r=o?e.level>=a:e.level==a,!_.has(e,"isGroup")&&r&&(n.count+=1,n.list.push(e))})}}catch(e){return console.log(e),{count:0,list:[]}}return n}var e=this.diagram,r=e.findNodeForKey(1),i=this;if(r){r.location=new go.Point(0,0);if(null!==r.diagram){r.data.category="Root";var d=function(e){return e.model.modelData.layout?e.model.modelData.layout:"inner"}(e);if("out"==d){var l=this.getMaxCircle(e),c=e.model;p.tdTravelTdpData(r.data,c,[],function(t){if(t.level<l&&void 0===t.isparent){var a=e.findNodeForKey(t.key);i.addChildNodeData(a,"temp")}}),changeLayout()}else"inner"==d?function(e,a){e.diagram.startTransaction("radial layout");var o=a.model.modelData.layerThickness||100,n=e.data.tdDipanTextAngle||"xuanzhuan";e.diagram.model.setDataProperty(e.data,"dangle",0),e.diagram.model.setDataProperty(e.data,"sweep",360),e.diagram.model.setDataProperty(e.data,"dradius",0),a.nodes.each(function(e){e.data._laid=!1}),e.location=new go.Point(0,0),l=i.getMaxCircle(a),t(e,1,90,360,o,n,a),e.diagram.commitTransaction("radial layout")}(r,e):(splitLayer=e.model.modelData.splitLayer?e.model.modelData.splitLayer:splitLayer,function(a,r){null==a&&(a=r.findNodeDataForKey(1));var i=r.findNodeDataForKey(1),d=parseInt(i.layerThickness);console.log("rootRadius",d),r.nodeDataArray.forEach(function(e){e._laid=!1});var l=e.model.modelData.layerThickness,c=a.tdDipanTextAngle||"xuanzhuan",s=arguments[2]?arguments[2]:getMaxCircle(e),g=o(a,r,s),u=g.count;if(!(u<=0)){var m=360/u,f=(r.nodeDataArray.length,[]);if(a.isparent){var h=r.findNodeDataForKey(a.isparent);p.tdTravelTdpData(h,r,f,function(e){return e});for(var y,v=1;v<=s;v++){y=_.filter(f,function(e){return!e.isGroup&&e.level==v});for(var k=0,w=0,b=d+(v-1)*l,T=0;T<y.length;T++){var x=y[T];if(x._laid=!0,"1"!=x.key){if(g=o(x,r,s),!((u=g.count)<0)){if(0==u)var S=m;else var S=u*m;0==T&&(w=-90),k=w+S/2,w+=S;var P=k,D=new go.Point(b+l/2,0);D.rotate(P),r.setDataProperty(x,"loc",go.Point.stringify(D)),r.setDataProperty(x,"dangle",P),r.setDataProperty(x,"sweep",S),r.setDataProperty(x,"dradius",b),r.setDataProperty(x,"layerThickness",l);var B=P>90&&P<270||P<-90?180:0;if("xuanzhuan"==c&&r.setDataProperty(x,"textAngle",B),"fangshe"==c){var B=P>0&&P<180||P<-180?180:0;r.setDataProperty(x,"textAngle",90)}"zhengli"==c&&r.setDataProperty(x,"textAngle",-P)}}else r.setDataProperty(n.data,"textAngle",0)}}console.log(),s<this.getMaxCircle(e)&&t(e.findNodeForKey(1),1,90,360,l,c)}}}(null,e.model,splitLayer))}}}},{key:"dokeyDownFnq",value:function(e){var t=this.diagram,a=t.lastInput,o=t.commandHandler,n=t.selection.first();if(a.event.keyCode>=65&&a.event.keyCode<=90&&!a.event.altKey&&!a.event.ctrlKey&&!a.event.shiftKey)return a.bubbles=!1,this.selectText(a,e),!0;if(13===a.event.keyCode)n&&"Root"==n.data.category?this.addFollowerGround():n&&"dipan"==n.data.category&&this.addFollowerGround();else if(9===a.event.keyCode)n&&"Root"==n.data.category?this.addNewCircle():n&&"dipan"==n.data.category&&this.addNewCircle();else if("t"===a.key)o.canCollapseSubGraph()?o.collapseSubGraph():o.canExpandSubGraph()&&o.expandSubGraph();else if("Del"==a.key){if(0==t.selection.count)return;a.diagram.commandHandler.deleteSelection()}else 113==a.event.keyCode?this.selectText():37==a.event.keyCode?this.moveWithinNodes("left"):38==a.event.keyCode?this.moveWithinNodes("up"):39==a.event.keyCode?this.moveWithinNodes("right"):40==a.event.keyCode?this.moveWithinNodes("down"):go.CommandHandler.prototype.doKeyDown.call(o);a.bubbles=!1}},{key:"downloadImage",value:function(){return this.diagram.makeImageData({scale:1,background:"#ffffff",type:"image/png",maxSize:new go.Size(9e3,9e3)})}}]),t}(h);v.go=go,t.default=v,e.exports=t.default},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=a(4),l=a(7),c=a(2),s=a(5),g=a(3),u=a(6),p=function(e){function t(e,a){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a))}return r(t,e),i(t,[{key:"addNodeTemplate",value:function(){var e=this.diagram;e.nodeTemplateMap.add("0",l(this.diagram)),e.nodeTemplateMap.add("1",l(this.diagram)),e.nodeTemplateMap.add("2",l(this.diagram)),e.nodeTemplateMap.add("3",c(this.diagram)),e.nodeTemplateMap.add("4",s(this.diagram)),e.nodeTemplateMap.add("text",g(this.diagram)),e.nodeTemplateMap.add("",l(this.diagram)),e.nodeTemplateMap.add("8",u(this.diagram))}}]),t}(d);t.default=p,e.exports=t.default},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=a(4),l=a(7),c=a(2),s=a(5),g=a(3),u=a(6),p=function(e){function t(e,a){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a))}return r(t,e),i(t,[{key:"addNodeTemplate",value:function(){var e=this.diagram;e.nodeTemplateMap.add("0",l(this.diagram)),e.nodeTemplateMap.add("1",l(this.diagram)),e.nodeTemplateMap.add("2",l(this.diagram)),e.nodeTemplateMap.add("3",c(this.diagram)),e.nodeTemplateMap.add("4",s(this.diagram)),e.nodeTemplateMap.add("text",g(this.diagram)),e.nodeTemplateMap.add("",l(this.diagram)),e.nodeTemplateMap.add("8",u(this.diagram))}}]),t}(d);t.default=p,e.exports=t.default},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=a(4),l=a(7),c=a(2),s=a(5),g=a(3),u=a(6),p=function(e){function t(e,a){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a))}return r(t,e),i(t,[{key:"addNodeTemplate",value:function(){var e=this.diagram;e.nodeTemplateMap.add("0",l(this.diagram)),e.nodeTemplateMap.add("1",l(this.diagram)),e.nodeTemplateMap.add("2",l(this.diagram)),e.nodeTemplateMap.add("3",c(this.diagram)),e.nodeTemplateMap.add("4",s(this.diagram)),e.nodeTemplateMap.add("text",g(this.diagram)),e.nodeTemplateMap.add("",l(this.diagram)),e.nodeTemplateMap.add("8",u(this.diagram))}}]),t}(d);t.default=p,e.exports=t.default},function(e,t,a){"use strict";function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){return S(go.Node,"Vertical",{movable:!1,locationSpot:go.Spot.Bottom,location:new go.Point(0,0),angle:90,click:function(e,t){console.log(t.data)},selectionAdornmentTemplate:function(){var e=go.GraphObject.make;return e(go.Adornment,"Spot",e(go.Panel,"Auto",e(go.Shape,{figure:"Linev",fill:"blue",stroke:"blue",strokeWidth:2}),e(go.Shape,{geometry:go.Geometry.parse("M584.641736 896S299.62889 148.827862 0-128c0 0 413.707108 34.128461 584.641736 212.37111 0 0 163.261205-185.842992 584.641735-212.37111 0 0-486.056523 686.369398-584.641735 1024z",!0).rotate(180).scale(.0117,.0117),fill:"blue",stroke:"blue",strokeWidth:0,alignment:new go.Spot(.5,0,0,0)}),e(go.Placeholder)))}(),contextMenu:f,mouseEnter:function(e,t){t.diagram},mouseLeave:function(e,t){e.diagram}},new go.Binding("angle","angle").makeTwoWay(),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("selectable","selectable").makeTwoWay(),S(go.Shape,{geometry:go.Geometry.parse("M584.641736 896S299.62889 148.827862 0-128c0 0 413.707108 34.128461 584.641736 212.37111 0 0 163.261205-185.842992 584.641735-212.37111 0 0-486.056523 686.369398-584.641735 1024z",!0).rotate(180).scale(.0117,.0117),fill:"rgb(135,153,196)",stroke:"#8799c4",strokeWidth:0,strokeDashArray:[0,0]},new go.Binding("stroke","stroke").makeTwoWay(),new go.Binding("fill","stroke").makeTwoWay()),S(go.Shape,{name:"LINE",figure:"Linev",stroke:"#8799c4",strokeWidth:2,strokeDashArray:[4,2]},new go.Binding("stroke","stroke").makeTwoWay(),new go.Binding("strokeDashArray","strokeDashArray").makeTwoWay(),new go.Binding("geometryString","geometryString").makeTwoWay(),new go.Binding("strokeWidth","strokeWidth").makeTwoWay(),new go.Binding("stroke","stroke",function(e){return e instanceof go.Brush?e.stroke:e}).makeTwoWay()))}function l(e){return S(go.Node,"Vertical",{movable:!1,locationSpot:go.Spot.Bottom,location:new go.Point(0,0),click:function(e,t){console.log(t.data)},selectionAdornmentTemplate:function(){var e=go.GraphObject.make;return e(go.Adornment,"Spot",e(go.Panel,"Auto",e(go.Shape,{figure:"Linev",fill:"rgba(255,0,120,0.2)",stroke:"blue",strokeWidth:2}),e(go.Shape,{geometry:go.Geometry.parse("M584.641736 896S299.62889 148.827862 0-128c0 0 413.707108 34.128461 584.641736 212.37111 0 0 163.261205-185.842992 584.641735-212.37111 0 0-486.056523 686.369398-584.641735 1024z",!0).rotate(180).scale(.0117,.0117),fill:"blue",stroke:"blue",strokeWidth:0,alignment:new go.Spot(.5,0,0,0)}),e(go.Placeholder)))}(),contextMenu:f,mouseEnter:function(e,t){t.diagram},mouseLeave:function(e,t){e.diagram}},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("selectable","selectable").makeTwoWay(),S(go.Shape,{geometry:go.Geometry.parse("M584.641736 896S299.62889 148.827862 0-128c0 0 413.707108 34.128461 584.641736 212.37111 0 0 163.261205-185.842992 584.641735-212.37111 0 0-486.056523 686.369398-584.641735 1024z",!0).rotate(180).scale(.0117,.0117),fill:"rgb(135,153,196)",stroke:"#8799c4",strokeWidth:0,strokeDashArray:[0,0]},new go.Binding("stroke","stroke").makeTwoWay(),new go.Binding("fill","stroke").makeTwoWay()),S(go.Shape,{name:"LINE",figure:"Linev",stroke:"#8799c4",strokeWidth:2,strokeDashArray:[4,2]},new go.Binding("stroke","stroke").makeTwoWay(),new go.Binding("strokeDashArray","strokeDashArray").makeTwoWay(),new go.Binding("geometryString","geometryString").makeTwoWay(),new go.Binding("strokeWidth","strokeWidth").makeTwoWay(),new go.Binding("stroke","stroke",function(e){return e instanceof go.Brush?e.stroke:e}).makeTwoWay()))}function c(e){var t=go.GraphObject.make;return t(go.Node,"Vertical",{movable:!1,locationSpot:go.Spot.Bottom,location:new go.Point(0,0),angle:0,click:function(e,t){console.log(t.data)},selectionAdornmentTemplate:function(){var e=go.GraphObject.make;return e(go.Adornment,"Spot",e(go.Panel,"Auto",e(go.Shape,{figure:"Linev",fill:"blue",stroke:"blue",strokeWidth:2}),e(go.Shape,{geometry:go.Geometry.parse("M584.641736 896S299.62889 148.827862 0-128c0 0 413.707108 34.128461 584.641736 212.37111 0 0 163.261205-185.842992 584.641735-212.37111 0 0-486.056523 686.369398-584.641735 1024z",!0).rotate(180).scale(.0117,.0117),fill:"blue",stroke:"blue",strokeWidth:2,alignment:new go.Spot(.5,0,0,0)}),e(go.Placeholder)))}(),mouseHover:function(e,t){},mouseEnter:function(e,t){var a=t.diagram;a.model.setDataProperty(t.data,"stroke","blue"),a.model.setDataProperty(t.data,"fill","blue")},mouseLeave:function(t,a){var o=a.diagram;e.removeNodeRemarkTips(),o.model.setDataProperty(a.data,"stroke","#8799c4"),o.model.setDataProperty(a.data,"fill","#8799c4")}},new go.Binding("angle","angle").makeTwoWay(),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),t(go.Shape,{geometry:go.Geometry.parse("M584.641736 896S299.62889 148.827862 0-128c0 0 413.707108 34.128461 584.641736 212.37111 0 0 163.261205-185.842992 584.641735-212.37111 0 0-486.056523 686.369398-584.641735 1024z",!0).rotate(180).scale(.0117,.0117),fill:"#8799c4",stroke:"#8799c4"},new go.Binding("fill","fill").makeTwoWay(),new go.Binding("stroke","stroke").makeTwoWay(),new go.Binding("strokeWidth","strokeWidth").makeTwoWay()),t(go.Shape,{name:"LINE",width:0,height:1e3,fill:"#8799c4",stroke:"#8799c4",strokeWidth:2},new go.Binding("height","height").makeTwoWay(),new go.Binding("fill","fill").makeTwoWay(),new go.Binding("stroke","stroke").makeTwoWay(),new go.Binding("strokeDashArray","strokeDashArray").makeTwoWay(),new go.Binding("strokeWidth","strokeWidth").makeTwoWay()))}function s(){var e,t=go.GraphObject.make;return t(go.Node,"Vertical",{movable:!1,selectionAdorned:!1,click:function(e,t){console.log(t.data)}},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("locationSpot","dir",function(e){return g(e,!1)}),t(go.Panel,"Vertical",t(go.TextBlock,(e={name:"TEXT",alignment:new go.Spot(0,1),font:"14px 微软雅黑",width:70,wrap:go.TextBlock.WrapDesiredSize,textAlign:"center",editable:!0,isMultiline:!1,margin:0,stroke:"black"},o(e,"isMultiline",!0),o(e,"alignment",go.Spot.Right),o(e,"portId","TEXT"),o(e,"stretch",go.GraphObject.Fill),e),new go.Binding("text","text").makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay(),new go.Binding("margin","margin").makeTwoWay())))}function g(e,t){return"right"===e?go.Spot.Right:"top"===e?go.Spot.Top:void 0}function u(){var e=go.GraphObject.make,t={figure:"Rectangle",fill:"rgba(0,0,0,0)",strokeWidth:1,stroke:"rgba(0,0,0,0)",fontSize:15,font:"sans-serif"};return e(go.Node,"Spot",{_controlExpand:!0,layerName:"Foreground",locationSpot:go.Spot.Center,resizeCellSize:new go.Size(10,10),locationObjectName:"SHAPE",resizable:!0,resizeObjectName:"SHAPE",rotatable:!0,location:new go.Point(0,0),toMaxLinks:1,click:function(e,t){console.log(t.data)},layoutConditions:go.Part.LayoutStandard,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("isShadowed","isShadowed").makeTwoWay(),new go.Binding("angle","angle").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("layerName","layerName",function(e,t){return e||""}).makeTwoWay(function(e){return e}),e(go.Shape,{strokeDashArray:null,name:"SHAPE",figure:"Rectangle",fill:"rgba(0,0,0,0)",fromLinkable:!0,toLinkable:!0,cursor:"pointer",minSize:new go.Size(50,50),strokeWidth:2,stroke:"rgba(0,0,0,0)",portId:""},new go.Binding("strokeDashArray","strokeDashArray",function(e){return[e.split()[0],e.split()[1]]}).makeTwoWay(function(e){return e[0]+" "+e[1]}),new go.Binding("fill","fill",function(e,t){return e instanceof go.Brush?e.color:e}).makeTwoWay(),new go.Binding("width","width",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("height","height",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("stroke","stroke",function(e){return e instanceof go.Brush?e.stroke:e}).makeTwoWay(),new go.Binding("strokeWidth","strokeWidth",function(e){return e}).makeTwoWay(function(e){return e}),new go.Binding("figure","figure").makeTwoWay(),{figure:t.figure,fill:t.fill,strokeWidth:t.strokeWidth,stroke:t.stroke}),e(go.Shape,{name:"SHAPE_Back",figure:"Rectangle",fill:"rgba(0,0,0,0)",strokeWidth:0},new go.Binding("width","width",function(e){return e}).ofObject("SHAPE"),new go.Binding("height","height",function(e){return e}).ofObject("SHAPE")),e(go.TextBlock,{name:"TEXT",alignment:new go.Spot(.5,.5),font:"bold 18px 幼圆",editable:!0,stroke:"black",isMultiline:!0,overflow:go.TextBlock.OverflowClip,wrap:go.TextBlock.WrapDesiredSize,textAlign:"center",spacingAbove:4,spacingBelow:4,portId:"TEXT",stretch:go.GraphObject.Fill},new go.Binding("textAlign","textAlign",function(e){return _.contains(["start","center","end"],e)?e:"center"}).makeTwoWay(),new go.Binding("spacingAbove","spacingline",function(e){return tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("spacingBelow","spacingline",function(e){return tdTransToNum(e,4)}).makeTwoWay(),new go.Binding("width","width",function(e){return e}).ofObject("SHAPE"),new go.Binding("text","text").makeTwoWay(),new go.Binding("stroke","textStroke").makeTwoWay(),new go.Binding("font","font").makeTwoWay()))}function p(e){var t=go.GraphObject.make;return t(go.Node,"Vertical",{movable:!1,locationSpot:go.Spot.Top,location:new go.Point(860,5),mouseHover:function(t,a){e.showNodeRemarkTips(t,a)},mouseLeave:function(t,a){e.removeNodeRemarkTips()},click:function(e,t){console.log(t.data),console.log(Number(t.data.loc.split(" ")[1])>0),Number(t.data.loc.split(" ")[1])>0?h(e):y(e)}},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),t(go.Shape,{figure:"LogicXor",stroke:"#8799c4",width:30,strokeWidth:2}))}function m(e){var t=(e.diagram,e.diagram),a=t.lastInput,o=t.selection.first();t.commandHandler;"Del"!==a.key&&8!==a.event.keyCode||(console.log("0",t.model.nodeDataArray),v(a)),a.event.ctrlKey&&(89===a.event.keyCode&&(o&&"addtextTemplate"!==o.data.category||!o)&&h(a),88===a.event.keyCode&&(o&&"addtextTemplate"!==o.data.category||!o)&&y(a),a.bubbles=!1)}function f(){return S(go.Adornment,"Vertical",S("ContextMenuButton",S(go.TextBlock,"删除 DEl"),{click:function(e,t){v(e)}}),S("ContextMenuButton",S(go.TextBlock,"增加 CTRL+X/Y"),{click:function(e,t){"0"===t.data.loc.split(" ")[1]&&"x"!==t.data.category?h(e):"0"===t.data.loc.split(" ")[0]&&"y"!==t.data.category&&y(e)}}))}function h(e){var t=e.diagram,a=t.selection.first(),o=t.model.nodeDataArray;console.log(o);var n=0,r=[4,2],i=0,d="",l=260;o.forEach(function(e){if("y"===e.category&&(n=e.height-10),"x"===e.category&&(l=e.height+200,t.model.startTransaction("addheight"),t.model.setDataProperty(e,"height",l),t.model.commitTransaction("addheight")),"LogicXor"===e.category){var a=+e.loc.split(" ")[0];if(a>0){var o=a+200+" 5";t.model.startTransaction(),t.model.setDataProperty(e,"loc",o),t.model.commitTransaction()}}}),o.forEach(function(e){if("0"===e.loc.split(" ")[0]&&"addtextTemplate"!==e.category){var a=l-10,o="M 0 0 L 0 "+a;t.model.startTransaction("changel"),t.model.setDataProperty(e,"geometryString",o),t.model.commitTransaction("changel")}});var c="M 0 0 L 0 "+n;if(!a||"y"!==a.data.category&&"0"===a.data.loc.split(" ")[0]||"x"===a.data.category||"LogicXor"===a.data.category||"addtextTemplate"===a.data.category){var s=[];if(o.forEach(function(e){"0"!==e.loc.split(" ")[0]&&"LogicXor"!==e.category&&"addtextTemplate"!==e.category&&s.push(+e.loc.split(" ")[0])}),0===s.length)d="200 0";else{d=Math.max.apply(null,s)+200+" 0"}}else console.log(a.data),i=+a.data.loc.split(" ")[0]+200,d=i+" 0",o.forEach(function(e){if(console.log(i),"LogicXor"!==e.category&&"addtextTemplate"!==e.category){var a=+e.loc.split(" ")[0];if(a>=i){a+=200;var o=a+" 0";t.model.startTransaction("changeloc"),t.model.setDataProperty(e,"loc",o),t.model.commitTransaction("changeloc")}}});var g={key:b(),category:"yunpany",stroke:"#8799c4",geometryString:c,strokeDashArray:r,loc:d},u={key:b(),category:"xtext",margin:10,textStroke:"#666666",text:"维度"+d.split(" ")[0]/200,loc:d,dir:"top"};t.model.startTransaction("addy"),t.model.addNodeData(g),t.model.addNodeData(u),t.model.commitTransaction("addy")}function y(e){var t=e.diagram,a=t.selection.first(),o=t.model.nodeDataArray,n=0,r=[4,2],i=0,d="",l=260;o.forEach(function(e){if("x"===e.category&&(n=e.height-10),"y"===e.category&&(l=e.height+200,t.model.startTransaction("addheight"),t.model.setDataProperty(e,"height",l),t.model.commitTransaction("addheight")),"LogicXor"===e.category){var a=+e.loc.split(" ")[1];if(a<0){var o="-20 "+(a-200);t.model.startTransaction(),t.model.setDataProperty(e,"loc",o),t.model.commitTransaction()}}}),o.forEach(function(e){if("0"===e.loc.split(" ")[1]&&"addtextTemplate"!==e.category){var a=l-10,o="M 0 0 L 0 "+a;t.model.startTransaction("changel"),t.model.setDataProperty(e,"geometryString",o),t.model.commitTransaction("changel")}});var c="M 0 0 L 0 "+n;if(!a||"x"!==a.data.category&&"0"===a.data.loc.split(" ")[1]||"y"===a.data.category||"LogicXor"===a.data.category||"addtextTemplate"===a.data.category){var s=[];if(o.forEach(function(e){"0"!==e.loc.split(" ")[1]&&"LogicXor"!==e.category&&"addtextTemplate"!==e.category&&s.push(+e.loc.split(" ")[1])}),0===s.length)d="0 -200";else{d="0 "+(Math.min.apply(null,s)-200)}}else console.log(a.data),i=+a.data.loc.split(" ")[1]-200,d="0 "+i,o.forEach(function(e){if(console.log(i),"LogicXor"!==e.category&&"addtextTemplate"!==e.category){var a=+e.loc.split(" ")[1];if(a<=i){a-=200;var o="0 "+a;t.model.startTransaction("changeloc"),t.model.setDataProperty(e,"loc",o),t.model.commitTransaction("changeloc")}}});var g={key:b(),category:"yunpanx",stroke:"#8799c4",geometryString:c,strokeDashArray:r,loc:d},u={key:b(),category:"ytext",text:"维度"+Math.abs(+d.split(" ")[1]/200),textStroke:"#666666",loc:d,dir:"right"};t.model.startTransaction("addx"),t.model.addNodeData(g),t.model.addNodeData(u),t.model.commitTransaction("addx")}function v(e){var t=e.diagram,a=t.selection.first();if(console.log("1",t.model.nodeDataArray),a)if(console.log("11111111111111111111111"),console.log(a.data),"yunpany"===a.data.category){var o=a.data.loc,n=+a.data.loc.split(" ")[0];console.log(n),t.model.nodeDataArray.forEach(function(e){"xtext"===e.category&&e.loc===o&&(console.log("data",e),t.model.startTransaction("delettext"),t.model.removeNodeData(a.data),t.model.removeNodeData(e),t.model.commitTransaction("delettext"))}),console.log("2",t.model.nodeDataArray),k(n,t)}else if("yunpanx"===a.data.category){console.log("x");var r=a.data.loc,i=+a.data.loc.split(" ")[1];t.model.nodeDataArray.forEach(function(e){"ytext"===e.category&&e.loc===r&&(t.model.startTransaction("delettext"),t.model.removeNodeData(e),t.model.removeNodeData(a.data),t.model.commitTransaction("delettext"))}),w(i,t)}else"ytext"!==a.data.category&&"xtext"!==a.data.category&&"LogicXor"!==a.data.category&&"x"!==a.data.category&&"y"!==a.data.category&&(t.model.startTransaction(),t.model.removeNodeData(a.data),t.model.commitTransaction())}function k(e,t){console.log("3",t.model.nodeDataArray),t.model.nodeDataArray.forEach(function(a){var o=+a.loc.split(" ")[0];if(console.log(a.loc),console.log(o),o>e&&("yunpany"===a.category||"xtext"===a.category)){var n=o-200,r=n+" 0";console.log(r),t.model.startTransaction("changea"),t.model.setDataProperty(a,"loc",r),t.model.commitTransaction("changea")}if(console.log(a),"x"===a.category){var i=a.height-200;t.model.startTransaction("cheight"),t.model.setDataProperty(a,"height",i),t.model.commitTransaction("cheight")}else if("yunpanx"===a.category){var d=NaN,l=(a.geometryString||"").split(" ");console.log(l),d=l[5]?+l[5]-200:+l[3]-200,console.log(d);var c=d+"",s="M 0 0  L 0 "+c;t.model.startTransaction("changea"),t.model.setDataProperty(a,"geometryString",s),t.model.commitTransaction("changea")}if("LogicXor"===a.category){var g=+a.loc.split(" ")[0];if(g>0){var u=g-200+" 5";t.model.startTransaction(),t.model.setDataProperty(a,"loc",u),t.model.commitTransaction()}}})}function w(e,t){console.log(t.model.nodeDataArray),t.model.nodeDataArray.forEach(function(a){var o=+a.loc.split(" ")[1];if(o<e&&("yunpanx"===a.category||"ytext"===a.category)){var n=o+200,r="0 "+n;console.log("节点",a),console.log("改变位置",r),t.model.startTransaction("changea"),t.model.setDataProperty(a,"loc",r),t.model.commitTransaction("changea")}if("y"===a.category){var i=a.height-200;console.log("节点",a),console.log("改变坐标轴长度没有angle",i),t.model.startTransaction("cheight"),t.model.setDataProperty(a,"height",i),t.model.commitTransaction("cheight")}else if("yunpany"===a.category){var d=NaN,l=(a.geometryString||"").split(" ");d=l[5]?+l[5]-200:+l[3]-200;var c=d+"",s="M 0 0  L 0 "+c;console.log("节点",a),console.log("改变y轴长度没有angle",s),t.model.startTransaction("changea"),t.model.setDataProperty(a,"geometryString",s),t.model.commitTransaction("changea")}if("LogicXor"===a.category){var g=+a.loc.split(" ")[1];if(g<0){var u="-20 "+(g+200);t.model.startTransaction(),t.model.setDataProperty(a,"loc",u),t.model.commitTransaction()}}})}function b(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}Object.defineProperty(t,"__esModule",{value:!0});var T=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),x=a(4),S=go.GraphObject.make,P=(a(2),a(5),a(3),a(6),function(e){function t(e,a){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return o.initDiagramYun(e,a),o}return i(t,e),T(t,[{key:"initDiagramYun",value:function(e,t){var a=this,o=this.diagram,n={contextMenu:this.getYunpanNodeContextMenu,"animationManager.isEnabled":!1};this.diagram.commandHandler.doKeyDown=function(){return m(a)};var r=Object.assign(n,t.diagramConfig);return this.diagram.setProperties(r),this.addNodeTemplate(),o}},{key:"addNodeTemplate",value:function(){var e=this,t=this.diagram;t.nodeTemplateMap.add("yunpanx",d(e)),t.nodeTemplateMap.add("yunpany",l(e)),t.nodeTemplateMap.add("y",c(e)),t.nodeTemplateMap.add("x",c(e)),t.nodeTemplateMap.add("ytext",s()),t.nodeTemplateMap.add("xtext",s()),t.nodeTemplateMap.add("LogicXor",p(e)),t.nodeTemplateMap.add("addtextTemplate",u())}}]),t}(x));t.default=P,e.exports=t.default},function(e,t,a){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),d=a(4),l=a(7),c=a(2),s=a(5),g=a(3),u=a(6),p=function(e){function t(e,a){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a))}return r(t,e),i(t,[{key:"addNodeTemplate",value:function(){var e=this.diagram;e.nodeTemplateMap.add("0",l(this.diagram)),e.nodeTemplateMap.add("1",l(this.diagram)),e.nodeTemplateMap.add("2",l(this.diagram)),e.nodeTemplateMap.add("3",c(this.diagram)),e.nodeTemplateMap.add("4",s(this.diagram)),e.nodeTemplateMap.add("text",g(this.diagram)),e.nodeTemplateMap.add("",l(this.diagram)),e.nodeTemplateMap.add("8",u(this.diagram))}}]),t}(d);t.default=p,e.exports=t.default},function(e,t,a){"use strict";function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e,t,a){if(e.equals(t))return t;var o=new go.Point(0,0).subtract(e.copy());return t.copy().offset(o.x,o.y).rotate(a).copy().offset(-o.x,-o.y)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),c=a(4),s=a(7),g=a(2),u=a(5),p=a(3),m=a(6),f=a(43),h=a(44),y=(a(45),a(12)),v=go.GraphObject.make,k=a(46),w=a(0),b=a(10).layoutWaveGroup,T=a(10).adjustTextAngle;a(47);var x=function(e){function t(e,a){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a)),i=o,l={layout:v(go.Layout),initialContentAlignment:go.Spot.Center,initialAutoScale:go.Diagram.Uniform,initialDocumentSpot:go.Spot.Center,initialViewportSpot:go.Spot.Center,rotatingTool:new k,PartResized:function(e){console.log("PartResizedPartResizedPartResizedPartResized");var t=e.subject.part;if(t&&"waveGroup"==t.data.category){console.log("PartResizedPartResized");for(var a,o,n,r=t.findSubGraphParts().iterator,i=0;r.next();){var d=r.value;"wave"==d.data.category&&(i+=1,n=d)}console.log("actualBoundsactualBoundsactualBoundsactualBounds");var l=t.resizeObject.actualBounds;n.resizeObject.naturalBounds;a=5*(l.width-0)/3/i,a=3*(l.width-0)/(3*i+2),a<100&&(a=100),a>400&&(a=400),o=l.height,o>400&&(o=400),o>a&&(o=a),t.diagram.startTransaction(),t.diagram.model.setDataProperty(t.data,"oliveHeight",o),t.diagram.model.setDataProperty(t.data,"oliveWidth",a);var r=e.subject.part.findSubGraphParts().iterator;for(b(r,t.diagram,e.subject.part),r.reset();r.next();)r.value.updateTargetBindings();t.diagram.commitTransaction(),setTimeout(function(){e.subject.part.layout.isOngoing=!0,e.subject.part.layout.isValidLayout=!1},100)}},SelectionMoved:function(e){try{var t=e.subject.first();if(!t)return;if("wave"==t.data.category&&t.containingGroup&&(t.containingGroup.layout.isValidLayout=!1),"autoText"==t.data.category){if("shiText"==t.data.role||"xuText"==t.data.role){if(t.diagram.startTransaction(),console.log("SelectionMovedSelectionMovedSelectionMoved"),!t.__location){var a=t.diagram.findNodeForKey(t.data.olive),o=t.containingGroup;if(a){var n=o.location.copy().offset(o.data.oliveWidth*(a.data.order-1),0);t.__location=n.copy().offset(a.naturalBounds.width/2,0),t.__location=d(o.location,t.__location,a.angle)}}t.__location&&(console.log("selnode.__locationselnode.__locationselnode.__location"),t.data.order,t.__offset=t.__location.copy().subtract(t.location),delete t.__oldOrder),delete t.__oldLocation,""!=t.data.text.trim()&&(t.data.nloc=!0,t.diagram.model.setDataProperty(t.data,"nloc",!0)),t.diagram.commitTransaction()}!t.containingGroup||"yunGroup"!=t.containingGroup.data.category&&"yunpanGroup"!=t.containingGroup.data.category||(t.containingGroup.__trtdNode.snapToGrid(t.data,t.containingGroup),t.containingGroup.layout.isValidLayout=!1)}"shapeText"==t.data.category&&t.containingGroup&&"yunpanGroup"==t.containingGroup.data.category&&(t.containingGroup.__trtdNode.snapToGrid(t.data,t.containingGroup),t.containingGroup.layout.isValidLayout=!1)}catch(e){console.log(e)}},click:function(e){console.log("eeeeeeee:",e),i.clearAllTextBorder(),localStorage.setItem("TRTD_documentPoint",go.Point.stringify(e.documentPoint))}};return o.diagram.setProperties(l),o.diagram.commandHandler.doKeyDown=function(e){o.dokeyDownFn(e)},o.diagram.commandHandler.canCopySelection=function(){console.log("canCopySelectioncanCopySelection");var e=i.diagram.selection.first();if(e)return"axisGroup"==e.data.category||"yunGroup"==e.data.category;var t=this.diagram.commandHandler;return go.CommandHandler.prototype.canCopySelection.call(t)},o.diagram.commandHandler.pasteFromClipboard=function(e,t){for(var a=go.CommandHandler.prototype.pasteFromClipboard.call(this),o=a.iterator,n=[],r=[],i=[],d=[],l=null;o.next();){var c=o.value;"shiText"!=c.data.role?"xuText"!=c.data.role?"centerText"!=c.data.role?"wave"!=c.data.category||"waveTail"==c.data.role?"waveGroup"==c.data.category&&(l=c):i.push(c):d.push(c):r.push(c):n.push(c)}return l?(i=i.sort(function(e,t){return Number(e.data.order)-Number(t.data.order)}),n.sort(function(e,t){return Number(e.data.order)-Number(t.data.order)}),r.sort(function(e,t){return Number(e.data.order)-Number(t.data.order)}),d.sort(function(e,t){return Number(e.data.order)-Number(t.data.order)}),i.forEach(function(e,t){e.data.shiText=n[t].data.key,e.data.xuText=r[t].data.key,e.data.centerText=d[t].data.key,n[t].data.olive=e.data.key,r[t].data.olive=e.data.key}),console.log("pasteFromClipboardpasteFromClipboard"),a):a=new go.Set(go.Part)},o.diagram.commandHandler.deleteSelection=function(){return o.deleteSelection()},o.diagram.toolManager.resizingTool.computeReshape=function(){if("shapeText"==this.adornedObject.part.data.category)return!1;go.TextEditingTool.prototype.doCancel.call(this)},o.diagram.toolManager.textEditingTool.doCancel=function(){var e=this;try{if(this.textBlock)var t=this.textBlock.part}catch(e){console.log(e)}setTimeout(function(){try{if(t&&"wave"==t.data.category&&t.containingGroup&&"horizontal"==t.containingGroup.data.textAngle&&"independent"==t.containingGroup.data.centerTextAngle){t.findObject("TEXT").visible=!1;var e=t.diagram.findNodeForKey(t.data.centerText);e&&(e.visible=!0)}}catch(e){console.info(e)}},100),go.TextEditingTool.prototype.doCancel.call(e)},o.diagram.toolManager.resizingTool.computeReshape=function(){return"pic"!=this.adornedObject.part.data.category},window.TextEditor&&(console.log("TextEditorTextEditorTextEditorTextEditorTextEditorTextEditorTextEditorTextEditorTextEditor"),o.diagram.toolManager.textEditingTool.defaultTextEditor=window.TextEditor),o.diagram.toolManager.clickCreatingTool.archetypeNodeData={category:"autoText",font:"18px 'Microsoft YaHei'",text:"空白文本",level:0},o.diagram.groupTemplateMap.add("waveGroup1",v(go.Group,"Spot",{selectionObjectName:"SHAPE"},{locationObjectName:"SHAPE",locationSpot:go.Spot.Center},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),{rotatable:!0},new go.Binding("angle","angle",function(e,t,a){return console.log("vvvvvvvvvvvvvvvvvvv:",e," m:",t," a:",a),e}).makeTwoWay(function(e,t,a){return console.log("v:",e," m:",t," a:",a),e}),{resizable:!0,resizeObjectName:"SHAPE"},v(go.Panel,"Vertical",v(go.TextBlock,{font:"bold 12pt sans-serif"},new go.Binding("text","key")),v(go.Shape,{name:"SHAPE",fill:"transparent"},new go.Binding("desiredSize","desiredSize",go.Size.parse).makeTwoWay(go.Size.stringify))))),o}return i(t,e),l(t,[{key:"addNodeTemplate",value:function(){var e=this.diagram;e.nodeTemplateMap.add("0",s(this.diagram)),e.nodeTemplateMap.add("1",s(this.diagram)),e.nodeTemplateMap.add("2",s(this.diagram)),e.nodeTemplateMap.add("3",g(this.diagram)),e.nodeTemplateMap.add("4",u(this.diagram)),e.nodeTemplateMap.add("text",p(this.diagram)),e.nodeTemplateMap.add("",s(this.diagram)),e.nodeTemplateMap.add("8",m(this.diagram)),e.nodeTemplateMap.add("9",f(this.diagram)),e.nodeTemplateMap.add("line",h(this.diagram)),e.nodeTemplateMap.add("wave",y("wave",{diagram:e}).getNodeTemplate()),e.nodeTemplateMap.add("waveTail",y("waveTail",{diagram:e}).getNodeTemplate()),e.nodeTemplateMap.add("iconText",y("iconText",{diagram:e}).getNodeTemplate()),e.nodeTemplateMap.add("pic",y("pic",{diagram:this.diagram}).getNodeTemplate()),e.nodeTemplateMap.add("shape",y("shape",{diagram:this.diagram}).getNodeTemplate()),e.nodeTemplateMap.add("autoText",y("autoText",{diagram:e}).getNodeTemplate()),e.nodeTemplateMap.add("shapeText",y("shapeText",{diagram:e}).getNodeTemplate()),e.groupTemplateMap.add("labelGroup",y("labelGroup",{diagram:e}).getNodeTemplate()),e.groupTemplateMap.add("picGroup",y("picGroup",{diagram:e}).getNodeTemplate()),e.groupTemplateMap.add("waveGroup",y("waveGroup",{diagram:this.diagram}).getNodeTemplate()),e.groupTemplateMap.add("axisGroup",y("axisGroup",{diagram:this.diagram}).getNodeTemplate()),e.groupTemplateMap.add("yunGroup",y("yunGroup",{diagram:this.diagram}).getNodeTemplate()),e.groupTemplateMap.add("yunpanGroup",y("yunpanGroup",{diagram:this.diagram}).getNodeTemplate())}},{key:"deleteSelection",value:function(e){var t=this.diagram.commandHandler;e||(e=this.diagram.selection.first());var a,o,n,r=null;if(e&&e.canDelete()&&("yunGroup"!=e.data.category||e.data.deletable)){this.diagram.startTransaction("deleteSelection1");var i=0;if(e){if("axisGroup"==e.data.category){for(var d=e.findSubGraphParts().iterator;d.next();){var l=d.value;this.diagram.model.removeNodeData(l.data)}this.diagram.model.removeNodeData(e.data)}if("wave"==e.data.category&&e.containingGroup){for(var d=e.containingGroup.findSubGraphParts().iterator;d.next();){var l=d.value;"wave"==l.data.category&&"waveTail"!=l.data.role&&(l.data.order==e.data.order+1&&(r=l),i++),"shiText"==l.data.role&&l.data.order==e.data.order&&(a=l),"xuText"==l.data.role&&l.data.order==e.data.order&&(o=l),"centerText"==l.data.role&&l.data.order==e.data.order&&(n=l)}if(i<=1)return void this.diagram.commitTransaction("deleteSelection1");e.containingGroup.layout.isOngoing=!0,e.containingGroup.layout.isValidLayout=!1,e.containingGroup.containingGroup&&(e.containingGroup.containingGroup.layout.isOngoing=!0,e.containingGroup.containingGroup.layout.isValidLayout=!1)}if("autoText"==e.data.category&&"dimText"==e.data.subRole&&e.containingGroup&&"yunpanGroup"==e.containingGroup.data.category){var d=e.containingGroup.findSubGraphParts().iterator,c=[],s=[],g="X",u="Y",p="verticalLine";for(0==e.data.dimX&&(g="Y",u="X",p="horizontalLine");d.next();){var l=d.value;"dimText"==l.data.subRole&&0==l.data["dim"+u]&&i++,"yunpanText"==l.data.subRole&&l.data["order"+g]==e.data["dim"+g]&&c.push(l.data),"line"==l.data.category&&l.data.role==p&&l.data.order==e.data["dim"+g]&&s.push(l.data)}if(i<=1)return void this.diagram.commitTransaction("deleteSelection1");for(d.reset();d.next();){var l=d.value;"dimText"==l.data.subRole&&0==l.data["dim"+u]&&l.data["dim"+g]>e.data["dim"+g]&&l.diagram.model.setDataProperty(l.data,"dim"+g,l.data["dim"+g]-1),"yunpanText"==l.data.subRole&&l.data["order"+g]>e.data["dim"+g]&&l.diagram.model.setDataProperty(l.data,"order"+g,l.data["order"+g]-1),"line"==l.data.category&&l.data.role==p&&l.data.order>e.data["dim"+g]&&l.diagram.model.setDataProperty(l.data,"order",l.data.order-1)}e.diagram.model.removeNodeDataCollection(s),e.diagram.model.removeNodeDataCollection(c),e.containingGroup.layout.isOngoing=!0,e.containingGroup.layout.isValidLayout=!1}}o&&this.diagram.model.removeNodeData(o.data),a&&this.diagram.model.removeNodeData(a.data),n&&this.diagram.model.removeNodeData(n.data),go.CommandHandler.prototype.deleteSelection.call(t),this.diagram.commitTransaction("deleteSelection1"),r&&this.diagram.select(r)}}},{key:"layoutLabelGroup",value:function(){var e=this;console.log("layoutLabelGroup"),setTimeout(function(){for(var t=e.diagram.nodes.iterator;t.next();){var a=t.value;"labelGroup"==a.data.category&&(a.layout.isOngoing=!0,a.layout.isValidLayout=!1)}},200)}},{key:"layoutAllGroup",value:function(){console.log("layoutAllGroup");for(var e=this.diagram.nodes.iterator;e.next();){var t=e.value;1==t.data.isGroup&&(t.layout.isOngoing=!0,t.layout.isValidLayout=!1)}}},{key:"splitOlive2Half",value:function(){var e=this.diagram,t=e.selection.first();if(t&&"wave"==t.data.category&&1!=t.data.order&&t.containingGroup){this.diagram.startTransaction("splitOlive2Half"),t.containingGroup.layout.isOngoing=!0,t.containingGroup.layout.isValidLayout=!1;var a=this.addAxisGroup({emptyAxis:!0});if(!a)return void this.diagram.commitTransaction("splitOlive2Half");for(var o,n=0;n<a.length;n++)if("waveGroup"==a[n].category){o=a[n];break}if(!o)return void this.diagram.commitTransaction("splitOlive2Half");for(var r=t.data.order,i=t.containingGroup.findSubGraphParts().iterator,d=[];i.next();){var l=i.value;"wave"==l.data.category&&l.data.order>=r&&"waveTail"!=l.data.role&&d.push(l)}for(var n=0;n<d.length;n++){this.diagram.model.setDataProperty(d[n].data,"group",o.key);var c=this.diagram.model.findNodeDataForKey(d[n].data.shiText),s=this.diagram.model.findNodeDataForKey(d[n].data.centerText),g=this.diagram.model.findNodeDataForKey(d[n].data.xuText);c&&this.diagram.model.setDataProperty(c,"group",o.key),s&&this.diagram.model.setDataProperty(s,"group",o.key),g&&this.diagram.model.setDataProperty(g,"group",o.key)}this.diagram.commitTransaction("splitOlive2Half")}}},{key:"splitOlive2Cbian",value:function(){var e=this.diagram,t=e.selection.first();if(t&&"wave"==t.data.category){this.diagram.startTransaction("splitOlive2Cbian");var a=this.diagram.model.findNodeDataForKey(t.data.shiText),o=this.diagram.model.findNodeDataForKey(t.data.centerText),n=this.diagram.model.findNodeDataForKey(t.data.xuText),r={shiText:a.text,centerText:o.text,xuText:n.text,basePoint:t.location.copy().offset(0,-300),group:t.data.group};this.deleteSelection(t),this.addCbian(r),this.diagram.commitTransaction("splitOlive2Cbian")}}},{key:"addCbian",value:function(e){console.log("addCbian");var t=this.diagram,a=t.selection.first(),o=null;a&&"axisGroup"==a.data.category&&(o=a.data.key);var n=t.lastInput;t.startTransaction("addCbian");var r=w.guid();if(e&&e.basePoint)var i=e.basePoint;else var i=n.documentPoint;var d={category:"picGroup",role:"cbian",isGroup:!0,level:0,key:r,loc:go.Point.stringify(i),deletable:!0};o&&(d.group=o),e&&e.group&&(d.group=e.group);var l={group:r,text:"",resizable:!1,category:"pic",loc:go.Point.stringify(i),picture:"https://static.365trtd.com/system/cbian/cbian.png",width:150,height:150},c={text:"总结",deletable:!0,fill:"black",iconVisible:!1,locationSpot:"1 0 0 0",textAlign:"center",category:"autoText",loc:go.Point.stringify(i.copy().offset(3,-3)),movable:!0,group:r},s={text:"时间",deletable:!0,fill:"black",iconVisible:!1,locationSpot:"1 0 0 0",textAlign:"center",category:"autoText",loc:go.Point.stringify(i.copy().offset(150,0)),movable:!0,group:r},g={text:"能量",deletable:!0,fill:"black",iconVisible:!1,locationSpot:"1 0 0 0",textAlign:"center",category:"autoText",loc:go.Point.stringify(i.copy().offset(0,-150)),movable:!0,group:r},u={text:"总结1",deletable:!0,textStroke:"#0e399d",iconVisible:!1,locationSpot:"0 0 0 0",textAlign:"left",category:"autoText",loc:go.Point.stringify(i.copy().offset(155*Math.cos(30*Math.PI/180),-150*Math.sin(30*Math.PI/180))),movable:!0,group:r},p={text:"总结3",deletable:!0,textStroke:"#FFC000",iconVisible:!1,locationSpot:"0 0.5 0 0",textAlign:"left",category:"autoText",loc:go.Point.stringify(i.copy().offset(145*Math.cos(45*Math.PI/180),-150*Math.sin(45*Math.PI/180))),movable:!0,group:r},m={text:"总结2",deletable:!0,textStroke:"#cb1c27",iconVisible:!1,locationSpot:"0 1 0 0",textAlign:"left",category:"autoText",loc:go.Point.stringify(i.copy().offset(145*Math.cos(70*Math.PI/180),-140*Math.sin(70*Math.PI/180))),movable:!0,group:r};e&&(u.text=e.shiText,p.text=e.centerText,m.text=e.xuText),t.model.addNodeData(u),t.model.addNodeData(p),t.model.addNodeData(m),t.model.addNodeData(c),t.model.addNodeData(s),t.model.addNodeData(g),t.model.addNodeData(l),t.model.addNodeData(d),t.commitTransaction("addCbian")}},{key:"adjustTextAngle",value:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];T(t)}},{key:"addOlive",value:function(e,t){console.log("addOliveaddOlive");var a=this.diagram;if(e||(e=a.selection.first()),e){var o=0,n=e.containingGroup.findSubGraphParts().iterator;for(e.containingGroup.data.oliveWidth;n.next();){"wave"==n.value.data.category&&o++}var r=50;if(null!=e.containingGroup.data.maxOlive&&(r=e.containingGroup.data.maxOlive),!(o>r)){var i=this.diagram.findNodeForKey(e.data.shiText),d=this.diagram.findNodeForKey(e.data.xuText);a.startTransaction("dspiral");var l=1e3;null!=e.data.order&&(l=Number(e.data.order)+.5);var c=JSON.parse(JSON.stringify(e.data));Object.assign(c,{key:w.guid(),order:l,text:""}),t&&(c.text=t.centerText),delete c.centerText,delete c.__gohashid,delete c.hyperlink,delete c.remark;var s=JSON.parse(JSON.stringify(i.data));delete s.__gohashid,delete s.textAlign,delete s.hyperlink,delete s.remark,delete s.nloc,Object.assign(s,{key:w.guid(),order:l,olive:c.key,text:""}),t&&(s.text=t.shiText);var g=JSON.parse(JSON.stringify(d.data));delete g.__gohashid,delete g.textAlign,delete g.hyperlink,delete g.remark,delete g.nloc,Object.assign(g,{key:w.guid(),order:l,olive:c.key,text:""}),t&&(g.text=t.xuText),c.shiText=s.key,c.xuText=g.key,console.log("orderorderorderorder:",l),e.containingGroup&&(e.containingGroup.layout.isOngoing=!0,e.containingGroup.layout.isValidLayout=!1,e.containingGroup.containingGroup&&(e.containingGroup.containingGroup.layout.isOngoing=!0,e.containingGroup.containingGroup.layout.isValidLayout=!1)),c.isNew=!0,a.model.addNodeData(c),a.model.addNodeData(s),a.model.addNodeData(g),a.commitTransaction("dspiral")}}}},{key:"getAxisGroupData",value:function(e){var t=this.diagram.lastInput,a=t.documentPoint,o=go.Point.stringify(a),n=w.guid(),r=w.guid(),i=w.guid(),d=w.guid(),l=w.guid(),c=w.guid(),s=w.guid(),g=w.guid(),u=w.guid(),p=w.guid(),m=w.guid(),f=w.guid(),h=w.guid(),y=w.guid(),v=w.guid(),k=w.guid(),b=w.guid(),T=w.guid(),x=w.guid(),S=[{category:"labelGroup",group:n,role:"labelGroup",isGroup:!0,level:0,key:r,loc:go.Point.stringify(a.copy().offset(30,700)),deletable:!1,selectable:!1},{category:"waveGroup",maxOlive:15,deletable:!1,haveTail:!0,oliveType:"Wave",shiStroke:"#0e399d",xuStroke:"#cb1c27",centerStroke:"rgba(9, 166, 9, 1)",oliveWidth:150,oliveHeight:120,isGroup:!0,level:0,key:i,loc:o,angle:330.08938180947,group:n,movable:!1,desiredSize:"700 120",textAngle:"horizontal",centerTextAngle:"independent",centerTextMode:"independent"},{category:"axisGroup",isGroup:!0,level:0,key:n,loc:o,angle:0,desiredSize:"300 150"},{category:"line",level:0,key:-11,loc:o,desiredSize:"700 1",width:1400,height:1,group:i,angle:330.08938180947,role:"centerLine",selectable:!1,stroke:"rgba(9, 166, 9, 1)"},{category:"line",level:0,key:-8,loc:"-91.91674008334496 -140.02427812707117",desiredSize:"606.7630471788291 10",width:1400,height:1,angle:0,group:n,role:"axisX",selectable:!1,stroke:"#0e399d"},{category:"line",level:0,key:-7,loc:"-91.91674008334496 -140.02427812707117",desiredSize:"349.05387059630493 10",width:1400,height:1,angle:270,group:n,role:"axisY",selectable:!1,stroke:"#cb1c27"},{text:"能量",deletable:!1,font:"24px 'Microsoft YaHei'",category:"autoText",loc:"-101.91674008334496 -489.0781487233761",key:-12,role:"axisYText",locationSpot:"1 0.5 0 0",group:n,movable:!0},{text:"主题",role:"themeText",deletable:!1,font:"24px 'Microsoft YaHei'",category:"autoText",loc:go.Point.stringify(a.copy().offset(-30,0)),key:-13,level:0,group:n,locationSpot:"0.5 0 0 0",movable:!0,width:300},{text:"时间",deletable:!1,font:"24px 'Microsoft YaHei'",category:"autoText",loc:"514.8463070954841 -140.02427812707117",key:-14,role:"axisXText",group:n,locationSpot:"0.5 0 0 0"},{text:"实线：",deletable:!1,fill:"#cb1c27",iconVisible:!0,locationSpot:"0 0 0 0",textAlign:"start",category:"autoText",loc:go.Point.stringify(a.copy().offset(30,-350)),role:"labelText1",movable:!0,group:r,visible:!0,minSize:"120 30"},{text:"虚线：",deletable:!1,fill:"#0e399d",iconVisible:!0,locationSpot:"0 0 0 0",textAlign:"start",category:"autoText",loc:go.Point.stringify(a.copy().offset(30,-310)),role:"labelText2",movable:!0,group:r,visible:!0,minSize:"120 30"},{text:"中线：",deletable:!1,fill:"#3f5369",iconVisible:!0,locationSpot:"0 0 0 0",textAlign:"start",category:"autoText",loc:go.Point.stringify(a.copy().offset(30,-270)),role:"labelText3",movable:!0,group:r,visible:!0,minSize:"120 30"},{category:"wave",text:"",role:"waveTail",deletable:!1,selectable:!1,level:0,key:"2d6ff2f1-0966-36bf-4e85-f5775ca0652b",group:i,loc:"710.0826118675676 -829.1890319396903",desiredSize:"75 120",order:999,oliveType:"Wave",angle:330.08938180947,textAlign:"center",shiStroke:"#0e399d",xuStroke:"#cb1c27",centerText:"df53d882-fe51-d78e-d8e3-8d9681578cb8",textVisible:!1,isNew:null}];return e||(S=S.concat([{category:"wave",text:"最多添加13个拓扑\n",level:0,key:d,group:i,desiredSize:"150 120",order:1,shiText:g,xuText:u,angle:330.08938180947,loc:"-91.91674008334496 -140.02427812707123",oliveType:"Ellipse",textAlign:"center",shiStroke:"#cb1c27",xuStroke:"#0e399d",centerText:k,textVisible:!1},{deletable:!1,text:"",font:"18px 'Microsoft YaHei'",category:"autoText",key:g,width:150,role:"shiText",level:0,group:i,order:1,olive:d,loc:"4.128618140465704 -125.47989214278559",locationSpot:"0 0 0 0",textStroke:"#cb1c27",showBorder:!0,angle:0,minSize:"120 30",textAlign:"center"},{deletable:!1,text:"",font:"18px 'Microsoft YaHei'",category:"autoText",key:u,width:150,role:"xuText",level:0,group:i,order:1,olive:d,loc:"-56.2078366340385 -230.36321886941172",locationSpot:"1 1 0 0",textStroke:"#0e399d",showBorder:!0,angle:0,minSize:"120 30",textAlign:"center"},{category:"wave",text:"拓扑多了页面可能会卡，刷新网页可以提速\n",level:0,key:l,group:i,desiredSize:"150 120",order:3,shiText:p,xuText:m,angle:330.08938180947,loc:"168.12456585043884 -289.61879409691636",oliveType:"Ellipse",textAlign:"center",shiStroke:"#cb1c27",xuStroke:"#0e399d",centerText:b,textVisible:!1},{deletable:!1,text:"",font:"18px 'Microsoft YaHei'",category:"autoText",key:p,width:150,role:"shiText",level:0,group:i,order:3,olive:l,loc:"264.16992407424954 -275.07440811263075",locationSpot:"0 0 0 0",textStroke:"#cb1c27",showBorder:!0,angle:0,minSize:"120 30",textAlign:"center"},{deletable:!1,text:"",font:"18px 'Microsoft YaHei'",category:"autoText",key:m,width:150,role:"xuText",level:0,group:i,order:3,olive:l,loc:"203.83346929974533 -379.9577348392569",locationSpot:"1 1 0 0",textStroke:"#0e399d",showBorder:!0,angle:0,minSize:"120 30",textAlign:"center"},{category:"wave",text:"新增的拓扑最多有15个橄榄\n",level:0,key:c,group:i,desiredSize:"150 120",order:2,shiText:f,xuText:h,angle:330.08938180947,loc:"38.10391288354694 -214.8215361119938",oliveType:"Ellipse",textAlign:"center",shiStroke:"#cb1c27",xuStroke:"#0e399d",centerText:T,textVisible:!1},{deletable:!1,text:"",font:"18px 'Microsoft YaHei'",category:"autoText",key:f,width:150,role:"shiText",level:0,group:i,order:2,olive:c,loc:"73.8128163328534 -305.1604768543343",locationSpot:"1 1 0 0",textStroke:"#cb1c27",showBorder:!0,angle:0,minSize:"120 30",textAlign:"center"},{deletable:!1,text:"",font:"18px 'Microsoft YaHei'",category:"autoText",key:h,width:150,role:"xuText",level:0,group:i,order:2,olive:c,loc:"134.1492711073576 -200.27715012770815",locationSpot:"0 0 0 0",textStroke:"#0e399d",showBorder:!0,angle:0,minSize:"120 30",textAlign:"center"},{category:"wave",text:"页面性能跟电脑配置有关\n",level:0,key:s,group:i,desiredSize:"150 120",order:4,shiText:y,xuText:v,angle:330.08938180947,loc:"298.1452188173308 -364.41605208183887",oliveType:"Ellipse",textAlign:"center",shiStroke:"#cb1c27",xuStroke:"#0e399d",centerText:x,textVisible:!1},{deletable:!1,text:"",font:"18px 'Microsoft YaHei'",category:"autoText",key:y,width:150,role:"shiText",level:0,group:i,order:4,olive:s,loc:"333.8541222666372 -454.7549928241794",locationSpot:"1 1 0 0",textStroke:"#cb1c27",showBorder:!0,angle:0,minSize:"120 30",textAlign:"center"},{deletable:!1,text:"",font:"18px 'Microsoft YaHei'",category:"autoText",key:v,width:150,role:"xuText",level:0,group:i,order:4,olive:s,loc:"394.1905770411414 -349.87166609755326",locationSpot:"0 0 0 0",textStroke:"#0e399d",showBorder:!0,angle:0,minSize:"120 30",textAlign:"center"},{text:"最多添加13个拓扑\n",minSize:"120 30",deletable:!1,textAlign:"center",font:"18px 'Microsoft YaHei'",category:"autoText",key:k,width:120,role:"centerText",level:0,group:i,order:1,visible:!0,layerName:"Foreground",locationSpot:"0.5 0.5 0 0",selectable:!1,olive:d,loc:"-26.039609246786398 -177.92155550609866",angle:0},{text:"新增的拓扑最多有15个橄榄\n",minSize:"120 30",deletable:!1,textAlign:"center",font:"18px 'Microsoft YaHei'",category:"autoText",key:T,width:120,role:"centerText",level:0,group:i,order:2,visible:!0,layerName:"Foreground",locationSpot:"0.5 0.5 0 0",selectable:!1,olive:c,loc:"103.9810437201055 -252.71881349102122",angle:0},{text:"拓扑多了页面可能会卡，刷新网页可以提速\n",minSize:"120 30",deletable:!1,textAlign:"center",font:"18px 'Microsoft YaHei'",category:"autoText",key:b,width:120,role:"centerText",level:0,group:i,order:3,visible:!0,layerName:"Foreground",locationSpot:"0.5 0.5 0 0",selectable:!1,olive:l,loc:"234.00169668699743 -327.5160714759438",angle:0},{text:"页面性能跟电脑配置有关\n",minSize:"120 30",deletable:!1,textAlign:"center",font:"18px 'Microsoft YaHei'",category:"autoText",key:x,width:120,role:"centerText",level:0,group:i,order:4,visible:!0,layerName:"Foreground",locationSpot:"0.5 0.5 0 0",selectable:!1,olive:s,loc:"364.0223496538893 -402.3133294608663",angle:0}])),S}},{key:"addAxisGroup",value:function(e){console.log("addOliveaddOlive");for(var t=this.diagram,a=0,o=0;o<t.model.nodeDataArray.length;o++)"axisGroup"==t.model.nodeDataArray[o].category&&(a+=1);if(!(a>13)){var n=this.getAxisGroupData(e);if(n){t.startTransaction("dspiral");for(var o=0;o<n.length;o++)t.model.addNodeData(n[o]);return t.commitTransaction("dspiral"),n}}}},{key:"selectText",value:function(e){var t=this.diagram;if(t.selection.first()){var a=t.selection.first().findObject("TEXT");if(a&&t.commandHandler.editTextBlock(a),w.checkPhone()){var o=t.currentTool.currentTextEditor.mainElement.value;t.currentTool.currentTextEditor.mainElement.selectionStart=o.length,t.currentTool.currentTextEditor.mainElement.selectionEnd=o.length}else w.simulateEnterWithAlt(e)}}},{key:"clearAllTextBorder",value:function(){for(var e=this.diagram.nodes.iterator;e.next();){var t=e.value;"autoText"==t.data.category&&(t.findObject("textBorder").visible=!1)}}},{key:"apiSwitchWaveTail",value:function(){console.log("apiSwitchWaveTailapiSwitchWaveTail");var e=this.diagram.selection.first();if(e){this.diagram.startTransaction();for(var t,a=e.findSubGraphParts().iterator,n=null,r=null;a.next();){var i=a.value;if(r=i,"waveTail"==i.data.role){n=i;break}}if(t=r?r.data.loc:e.data.loc,n)this.diagram.model.removeNodeData(n.data),this.diagram.model.setDataProperty(e.data,"haveTail",!1);else{var d;this.diagram.model.setDataProperty(e.data,"haveTail",!0);var l=(d={category:"wave",text:"",role:"waveTail",deletable:!1,selectable:!1},o(d,"deletable",!1),o(d,"level",0),o(d,"key",w.guid()),o(d,"group",e.data.key),o(d,"loc",t),o(d,"desiredSize",e.data.oliveWidth+" "+e.data.oliveHeight),o(d,"order",2e3),d);this.diagram.model.addNodeData(l)}e.layout.isOngoing=!0,e.layout.isValidLayout=!1,this.diagram.commitTransaction()}}},{key:"apiSwitchToEllipse",value:function(){console.log("apiSwitchToEllipse");var e=this.diagram.selection.first();if(e){this.diagram.startTransaction(),this.diagram.model.setDataProperty(e.data,"oliveType","Ellipse");for(var t=e.findSubGraphParts().iterator,a=null;t.next();){var o=t.value;if("waveTail"==o.data.role){a=o;break}}a&&this.diagram.model.removeNodeData(a.data),e.layout.isOngoing=!0,e.layout.isValidLayout=!1,e.containingGroup&&(e.containingGroup.layout.isOngoing=!0,e.containingGroup.layout.isValidLayout=!1),this.diagram.commitTransaction()}}},{key:"apiSwitchToWave",value:function(){var e=this.diagram.selection.first();if(e){this.diagram.startTransaction("apiSwitchToWave"),this.diagram.model.setDataProperty(e.data,"oliveType","Wave");for(var t,a=e.findSubGraphParts().iterator,n=null,r=null,i=e.data.haveTail;a.next();){var d=a.value;if(r=d,"waveTail"==d.data.role){n=d;break}}if(t=r?r.data.loc:e.data.loc,!n&&1==i){var l,c=(l={category:"wave",text:"",role:"waveTail",deletable:!1,selectable:!1},o(l,"deletable",!1),o(l,"level",0),o(l,"key",w.guid()),o(l,"group",e.data.key),o(l,"loc",t),o(l,"desiredSize",e.data.oliveWidth+" "+e.data.oliveHeight),o(l,"order",2e3),l);this.diagram.model.addNodeData(c)}e.layout.isOngoing=!0,e.layout.isValidLayout=!1,e.containingGroup&&(e.containingGroup.layout.isOngoing=!0,e.containingGroup.layout.isValidLayout=!1),this.diagram.commitTransaction("apiSwitchToWave")}}},{key:"apiSwitchTextAngle",value:function(e){var t=this.diagram.selection.first();if(t){var a={horizontal:"vertical",vertical:"horizontal"};console.log("apiSwitchTextAngle"),t.diagram.startTransaction("apiSwitchTextAngle"),e&&["horizontal","vertical"].indexOf(e)>-1?(t.diagram.model.setDataProperty(t.data,"textAngle",e),t.data.textAngle=e):(e=a[t.data.textAngle]||"horizontal",t.diagram.model.setDataProperty(t.data,"textAngle",e),t.data.textAngle=e),t.layout.isOngoing=!0,t.layout.isValidLayout=!1,t.diagram.commitTransaction("apiSwitchTextAngle")}}},{key:"getDefaultCustomMenuDivStr",value:function(){return'\n        <ul>\n            <li trtd_action="addFollower"><a class="i18n" data-lang="insertsl">插入同级节点</a></li>\n            <li trtd_action="startNewSpiral"><a class="i18n" data-lang="icn">插入子节点</a></li>\n            <li trtd_action="apiDuplicateNode"><a class="i18n" data-lang="duplicateNode">复制节点</a></li>\n            <li trtd_action="apiDeleteSelection"><a class="i18n" data-lang="remove">删除</a></li>\n            <li trtd_action="splitOlive2Cbian"><a class="i18n" data-lang="remove">分离</a></li>\n            <li trtd_action="splitOlive2Half"><a class="i18n" data-lang="remove">拆分</a></li>\n            <li trtd_action="orderChildNode"><a class="i18n" data-lang="ordernode">子节点编号</a></li>\n            <li trtd_action="clearOrderChildNode"><a class="i18n" data-lang="clearordernode">取消子节点编号</a></li>\n            <li trtd_action="clearNodeTextMenu"><a class="i18n" data-lang="emptynodetext">清空节点文本</a></li>\n            <li trtd_action="apiInsertTianpanNode"><a class="i18n" data-lang="insertnodetianpan">插入天盘节点</a></li>\n            <li trtd_action="addTextNode"><a class="i18n" data-lang="inserttext">插入文本</a></li>\n            <li trtd_action="locateRootNodeMenu"><a class="i18n" data-lang="locaterootnode">定位根节点</a></li>\n            <li trtd_action="showAllNodesMenu"><a class="i18n" data-lang="displayallnodes">显示所有节点</a></li>\n            <li trtd_action="fixPictureMenu"><a class="i18n" data-lang="fixnode">固定节点</a></li>\n            <li trtd_action="activePictureMenu"><a class="i18n" data-lang="cancelfix">取消固定</a></li>\n            <li trtd_action="apiSwitchToEllipse"><a class="i18n" data-lang="cancelfix">切换为橄榄形状</a></li>\n            <li trtd_action="apiSwitchToWave"><a class="i18n" data-lang="cancelfix">切换为螺旋形状</a></li>\n            <li trtd_action="apiSwitchWaveTail"><a class="i18n" data-lang="cancelfix">添加/删除尾巴</a></li>\n            <li trtd_action="apiSwitchTextAngle"><a class="i18n" data-lang="cancelfix">切换文字方向</a></li>\n            <li trtd_action="addCbian"><a class="i18n" data-lang="cancelfix">添加总结图</a></li>\n            <li trtd_action="addAxisGroup"><a class="i18n" data-lang="cancelfix">插入拓扑</a></li>\n            <li trtd_action="showRect"><a class="i18n" data-lang="cancelfix">显示矩形线</a></li>\n            <li trtd_action="hideRect"><a class="i18n" data-lang="cancelfix">隐藏矩形线</a></li>\n            <li trtd_action="offShowRedLine"><a class="i18n" data-lang="cancelfix">关闭自动显示红线</a></li>\n            <li trtd_action="autoShowRedline"><a class="i18n" data-lang="cancelfix">自动显示自旋红线</a></li>\n            <li trtd_action="bringupLayer"><a class="i18n" data-lang="cancelfix">上移一层</a></li>\n            <li trtd_action="bringdownLayer"><a class="i18n" data-lang="cancelfix">下移一层</a></li>\n            <li trtd_action="bringToBackground"><a class="i18n" data-lang="cancelfix">置于底层</a></li>\n            <li trtd_action="bringToForeground"><a class="i18n" data-lang="cancelfix">置于顶层</a></li>\n            <li trtd_action="addDimTtext"><a class="i18n" data-lang="cancelfix">增加维度</a></li>\n        </ul>\n        '}},{key:"getShowContextMenus",value:function(e){var t=null;return console.log("getShowContextMenus"),e?(["axisGroup"].indexOf(e.data.category)>-1&&(t="addCbian,apiDeleteSelection"),["picGroup"].indexOf(e.data.category)>-1&&(t="apiDeleteSelection"),["3"].indexOf(e.data.category)>-1&&(t="bringupLayer,apiDeleteSelection,bringdownLayer,bringToBackground,bringToForeground"),["wave"].indexOf(e.data.category)>-1&&(null!=e.data.deletable?e.data.deletable&&(t="apiDeleteSelection,splitOlive2Cbian,splitOlive2Half"):e.deletable&&(t="apiDeleteSelection,splitOlive2Cbian,splitOlive2Half")),console.log("waveGroupwaveGroup"),["waveGroup"].indexOf(e.data.category)>-1&&(t="apiSwitchTextAngle,","Ellipse"==e.data.oliveType?t+="apiSwitchToWave":t+="apiSwitchToEllipse,apiSwitchWaveTail"),["yunGroup"].indexOf(e.data.category)>-1&&(t="",e.data.showShape?t+="hideRect":t+="showRect","line"!=e.data.beginSpark?t+=",autoShowRedline":t+=",offShowRedLine"),["autoText"].indexOf(e.data.category)>-1&&["shiText","xuText"].indexOf(e.data.role)<0&&(t="apiDeleteSelection"),"dimText"==e.data.subRole&&"yunpanGroup"==e.containingGroup.data.category&&(t="apiDeleteSelection,addDimTtext"),"shapeText"==e.data.category&&"yunpanGroup"==e.containingGroup.data.category&&(t="apiDeleteSelection")):t="addCbian,addAxisGroup",t}},{key:"addDimTtext",value:function(){var e=this.diagram.selection.first();this.diagram;if(e&&"dimText"==e.data.subRole){var t=0,a=e.containingGroup.findSubGraphParts().iterator,o=[],n=null,r="X",i="Y",d="verticalLine";for(0==e.data.dimX&&(r="Y",i="X",d="horizontalLine");a.next();){var l=a.value;"dimText"==l.data.subRole&&0==l.data["dim"+i]&&t++,"yunpanText"==l.data.subRole&&l.data["order"+r]==e.data["dim"+r]&&o.push(l.data),"line"==l.data.category&&l.data.role==d&&l.data.order==e.data["dim"+r]&&(n=l)}if(!(t>=30)){for(this.diagram.startTransaction("addDimTtext"),a.reset();a.next();){var l=a.value;"dimText"==l.data.subRole&&0==l.data["dim"+i]&&l.data["dim"+r]>e.data["dim"+r]&&l.diagram.model.setDataProperty(l.data,"dim"+r,l.data["dim"+r]+1),"yunpanText"==l.data.subRole&&l.data["order"+r]>e.data["dim"+r]&&l.diagram.model.setDataProperty(l.data,"order"+r,l.data["order"+r]+1),"line"==l.data.category&&l.data.role==d&&l.data.order>e.data["dim"+r]&&l.diagram.model.setDataProperty(l.data,"order",l.data.order+1)}var c=JSON.parse(JSON.stringify(e.data));if(delete c.key,delete c.__gohashid,n){var s=JSON.parse(JSON.stringify(n.data));delete s.key,delete s.__gohashid,s.order=s.order+1,e.diagram.model.addNodeData(s)}c["dim"+r]=e.data["dim"+r]+1,c.text="维度"+c["dim"+r],e.diagram.model.addNodeData(c),e.containingGroup.layout.isOngoing=!0,e.containingGroup.layout.isValidLayout=!1,this.diagram.commitTransaction("addDimTtext")}}}},{key:"bringToBackground",value:function(){var e=this.diagram.selection.first(),t=this.diagram;t.model.startTransaction(),t.model.setDataProperty(e.data,"layerName","Background"),t.model.setDataProperty(e.data,"zOrder",1),t.model.commitTransaction()}},{key:"bringToForeground",value:function(){var e=this.diagram.selection.first(),t=this.diagram;t.model.startTransaction(),t.model.setDataProperty(e.data,"layerName","Foreground"),t.model.setDataProperty(e.data,"zOrder",999),t.model.commitTransaction()}},{key:"bringdownLayer",value:function(){var e=this.diagram.selection.first(),t=this.diagram;if(e){var a=e.layerName,o=a;e.zOrder;"Foreground"==a&&(o="default"),"default"==a&&(o="Background"),"Background"==a&&(o="Background"),t.model.startTransaction(),t.model.setDataProperty(e.data,"layerName",o),t.model.setDataProperty(e.data,"zOrder",1),t.model.commitTransaction()}}},{key:"bringupLayer",value:function(){var e=this.diagram.selection.first(),t=this.diagram;if(e){var a=e.layerName,o=a;e.zOrder;"Background"==a&&(o="default"),"default"==a&&(o="Foreground"),"Foreground"==a&&(o="Foreground"),t.model.startTransaction(),t.model.setDataProperty(e.data,"layerName",o),t.model.setDataProperty(e.data,"zOrder",999),t.model.commitTransaction()}}},{key:"bringToLayer",value:function(e,t){var a=myDiagram.selection.first();if(myDiagram.model.startTransaction(),a)if(null==e){e=a.data.layerName?a.data.layerName:"";var o=myDiagram.model.copyNodeData(a.data);myDiagram.model.removeNodeData(a.data),myDiagram.model.addNodeData(o)}else myDiagram.model.setDataProperty(a.data,"layerName",e);myDiagram.model.commitTransaction()}},{key:"showRect",value:function(){var e=this.diagram.selection.first();if(console.log("show shape"),e&&"yunGroup"==e.data.category){e.diagram.startTransaction("showRect"),e.diagram.model.setDataProperty(e.data,"showShape",!0);for(var t=e.findSubGraphParts().iterator;t.next();){var a=t.value;"background"==a.data.role&&e.diagram.model.setDataProperty(a.data,"visible",!0)}e.layout.isValidLayout=!1,e.diagram.commitTransaction("showRect")}}},{key:"hideRect",value:function(){var e=this.diagram.selection.first();if(e&&"yunGroup"==e.data.category){e.diagram.startTransaction("hideRect"),e.diagram.model.setDataProperty(e.data,"showShape",!1);for(var t=e.findSubGraphParts().iterator;t.next();){var a=t.value;"background"==a.data.role&&(e.diagram.model.setDataProperty(a.data,"visible",!0),e.diagram.model.setDataProperty(a.data,"stroke","rgba(255,0,0,0)"))}e.diagram.commitTransaction("hideRect")}}},{key:"autoShowRedline",value:function(){var e=this.diagram.selection.first();e&&"yunGroup"==e.data.category&&(e.diagram.startTransaction("beginSpark"),e.diagram.model.setDataProperty(e.data,"beginSpark","line"),e.diagram.commitTransaction("beginSpark"))}},{key:"offShowRedLine",value:function(){var e=this.diagram.selection.first();e&&"yunGroup"==e.data.category&&(e.diagram.startTransaction("offShowRedLine"),e.diagram.model.setDataProperty(e.data,"beginSpark",void 0),e.diagram.commitTransaction("offShowRedLine"))}},{key:"dokeyDownFn",value:function(e){var t=this;console.log("dspirallllllllllllllllllllllllll:");var a=this.diagram,o=this.diagram,e=o.lastInput,n=o.commandHandler;if(e.event.altKey){if("Q"==e.key)return void autoLayoutAll();if("R"==e.key)return void centerNode();if("C"==e.key)return void centerCurrentNode();if("A"==e.key)return void zoomToFit()}if(e.event.keyCode>=65&&e.event.keyCode<=90&&!e.event.altKey&&!e.event.ctrlKey&&!e.event.shiftKey){e.bubbles=!1;var r=o.selection.first();if(!r)return;if("wave"==r.data.category&&r.containingGroup&&"horizontal"==r.containingGroup.data.textAngle&&"independent"==r.containingGroup.data.centerTextAngle){r.findObject("TEXT").visible=!0;var i=r.diagram.findNodeForKey(r.data.centerText);i&&(i.visible=!1)}return setTimeout(function(){t.selectText(e,a)},100),!0}if(13===e.event.keyCode){console.log("dspiral add Follower");var r=o.selection.first();r&&"wave"==r.category&&this.addOlive()}else 9===e.event.keyCode?this.addFollower(!0):"t"===e.key?n.canCollapseSubGraph()?n.collapseSubGraph():n.canExpandSubGraph()&&n.expandSubGraph():"Del"==e.key?e.diagram.commandHandler.deleteSelection():113==e.event.keyCode?this.selectText(e,a):37==e.event.keyCode?this.moveWithinNodes("left",a):38==e.event.keyCode?this.moveWithinNodes("up",a):39==e.event.keyCode?this.moveWithinNodes("right",a):40==e.event.keyCode?this.moveWithinNodes("down",a):go.CommandHandler.prototype.doKeyDown.call(n);e.bubbles=!1}},{key:"findPrevOlive",value:function(e){if(e.data.order<=1)return null;for(var t=null,a=e.containingGroup.findSubGraphParts().iterator;a.next();){var o=a.value;if("wave"==o.data.category&&o.data.order==e.data.order-1){t=o;break}}return t}},{key:"findNextOlive",value:function(e){for(var t=null,a=e.containingGroup.findSubGraphParts().iterator;a.next();){var o=a.value;if("waveTail"!=o.data.role)if("autoText"==e.data.category){if("shiText"==o.data.role&&o.data.order==e.data.order+1){t=o;break}}else if("wave"==o.data.category&&o.data.order==e.data.order+1){t=o;break}}return t}},{key:"findUpOlive",value:function(e){var t=null;return"wave"==e.data.category&&(t=e.data.order%2!=0?this.diagram.findNodeForKey(e.data.xuText):this.diagram.findNodeForKey(e.data.shiText)),"xuText"==e.data.role&&(e.data.order%2!=0||(t=this.diagram.findNodeForKey(e.data.olive))),"shiText"==e.data.role&&e.data.order%2!=0&&(t=this.diagram.findNodeForKey(e.data.olive)),t}},{key:"findDownOlive",value:function(e){var t=null;return"wave"==e.data.category&&(t=e.data.order%2!=0?this.diagram.findNodeForKey(e.data.shiText):this.diagram.findNodeForKey(e.data.xuText)),"xuText"==e.data.role&&e.data.order%2!=0&&(t=this.diagram.findNodeForKey(e.data.olive)),"shiText"==e.data.role&&(e.data.order%2!=0||(t=this.diagram.findNodeForKey(e.data.olive))),t}},{key:"moveWithinNodes",value:function(e){var t=this.diagram,a=t.selection.first();if(a){if("autoText"==a.data.category&&"coreText"==a.data.subRole){if(!a.containingGroup||"yunGroup"!=a.containingGroup.data.category||"yunpanGroup"!=a.containingGroup.data.category)return;var o,n=3e4,r=3e4;switch(a.containingGroup.__yunPointsX&&a.containingGroup.__yunPointsY&&(n=(a.containingGroup.__yunPointsX.length+1)/2,r=(a.containingGroup.__yunPointsY.length+1)/2),e){case"left":if(a.data.orderX==n)return;for(var i=a.containingGroup.findSubGraphParts().iterator;i.next();){var d=i.value;if("coreText"==d.data.subRole&&d.data.dimKey==a.data.dimKey&&Number(d.data.orderX)==Number(a.data.orderX)-1){o=d;break}}break;case"up":if(a.data.orderY==r)return;for(var i=a.containingGroup.findSubGraphParts().iterator;i.next();){var d=i.value;if("coreText"==d.data.subRole&&d.data.dimKey==a.data.dimKey&&Number(d.data.orderY)==Number(a.data.orderY)+1){o=d;break}}break;case"right":if(a.data.orderX==n)return;for(var i=a.containingGroup.findSubGraphParts().iterator;i.next();){var d=i.value;if("coreText"==d.data.subRole&&d.data.dimKey==a.data.dimKey&&Number(d.data.orderX)==Number(a.data.orderX)+1){o=d;break}}break;case"down":if(a.data.orderY==r)return;for(var i=a.containingGroup.findSubGraphParts().iterator;i.next();){var d=i.value;if("coreText"==d.data.subRole&&d.data.dimKey==a.data.dimKey&&Number(d.data.orderY)==Number(a.data.orderY)-1){o=d;break}}}o&&t.select(o)}if("wave"==a.data.category||"shiText"==a.data.role||"xuText"==a.data.role)switch(e){case"left":var l=this.findPrevOlive(a);l&&t.select(l);break;case"up":var c=this.findUpOlive(a);c&&t.select(c);break;case"right":var o=this.findNextOlive(a);o&&t.select(o);break;case"down":var s=this.findDownOlive(a);s&&t.select(s)}}}}]),t}(c);t.default=x,e.exports=t.default},function(e,t,a){"use strict";function o(e){var t=e.diagram;t.startTransaction();var a={text:"双击编辑文本",category:"text"};a.loc=go.Point.stringify(t.lastInput.documentPoint),t.model.addNodeData(a),t.commitTransaction()}var n=go.GraphObject.make;a(9);e.exports=function(e){return n(go.Node,"Spot",{name:"NODE",_controlExpand:!0,layerName:"Background",locationSpot:go.Spot.Center,resizeCellSize:new go.Size(10,10),locationObjectName:"SHAPE",resizable:!0,resizeObjectName:"SHAPE",rotatable:!0,rotateObjectName:"SHAPE",click:function(e,t){},doubleClick:function(e,t){o(e)},selectable:!0,selectionObjectName:"SHAPE",movable:!0,angle:0,layoutConditions:go.Part.LayoutStandard,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,resizeAdornmentTemplate:e.__trtd.nodeResizeAdornmentTemplate(),contextMenu:e.__trtd.getNodeContextMenu()},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),n(go.Shape,{name:"SHAPE",fill:"white",strokeWidth:3,stroke:"black",minSize:new go.Size(50,50)},new go.Binding("fill","fill").makeTwoWay(function(e){return e}),new go.Binding("stroke","stroke").makeTwoWay(function(e){return e}),new go.Binding("strokeWidth","strokeWidth").makeTwoWay(function(e){return e}),new go.Binding("desiredSize","desiredSize",function(e){return e}).ofObject("BACKGROUND"),new go.Binding("angle","angle",function(e){return e}).ofObject("BACKGROUND"),new go.Binding("geometryString","geometryString",function(e){return e})),n(go.Shape,"Rectangle",{name:"BACKGROUND",fill:"rgba(1,1,1,0)",angle:0,stroke:"rgba(1,1,1,0)"},new go.Binding("desiredSize","desiredSize",function(e,t){return e?go.Size.parse(e):t.part.findObject("SHAPE").measuredBounds.size}).makeTwoWay(function(e){return go.Size.stringify(e)})))}},function(e,t,a){"use strict";var o=go.GraphObject.make;a(9);e.exports=function(e){return o(go.Node,"Spot",{name:"NODE",zOrder:10,layerName:"default",padding:0,_controlExpand:!0,locationSpot:go.Spot.LeftCenter,resizeCellSize:new go.Size(1,1),locationObjectName:"SHAPE",resizable:!0,resizeObjectName:"SHAPE",rotatable:!0,mouseDragEnter:function(e,t){console.log("mouseDragEnter line")},mouseDrop:function(e,t){t.part;console.log("mouseDropmouseDropmouseDropmouseDrop line")},click:function(e,t){console.log(t.data)},deletable:!1,doubleClick:function(e,t){if(!t.selectable){var a=e.diagram.findObjectAt(e.documentPoint,function(e){return e.part},function(e){return e.canSelect()&&"wave"==e.data.category});a&&(e.diagram.select(a),a.doubleClick(e,a)),console.log("partpart...........",a)}},selectable:!0,selectionObjectName:"SHAPE",movable:!0,angle:0,layoutConditions:go.Part.LayoutStandard,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,resizeAdornmentTemplate:e.__trtd.nodeResizeAdornmentTemplate(),contextMenu:o(go.Adornment)},new go.Binding("zOrder","zOrder").makeTwoWay(),new go.Binding("selectable","selectable").makeTwoWay(),new go.Binding("locationSpot","locationSpot",function(e){return go.Spot.parse(e)}).makeTwoWay(function(e){return go.Spot.stringify(e)}),new go.Binding("movable","movable").makeTwoWay(),new go.Binding("visible","visible").makeTwoWay(),new go.Binding("deletable","deletable").makeTwoWay(),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("angle","angle").makeTwoWay(function(e,t,a){return e}),o(go.Shape,"LineH",{name:"SHAPE",alignment:go.Spot.Left,alignmentFocus:go.Spot.Left,stretch:go.GraphObject.Horizontal,strokeCap:"round",strokeDashArray:[0,0],width:300,height:20,margin:0,fill:"white",strokeWidth:3,stroke:"black",minSize:new go.Size(NaN,10),maxSize:new go.Size(NaN,20)},new go.Binding("fill","fill").makeTwoWay(function(e){return e}),new go.Binding("stroke","stroke").makeTwoWay(function(e){return e}),new go.Binding("strokeDashArray","strokeDashArray",function(e){return JSON.parse(e)}).makeTwoWay(function(e){return JSON.stringify(e)}),new go.Binding("strokeWidth","strokeWidth").makeTwoWay(function(e){return e}),new go.Binding("desiredSize","desiredSize",function(e,t){return e?go.Size.parse(e):t.part.findObject("SHAPE").measuredBounds.size}).makeTwoWay(function(e){return go.Size.stringify(e)})),o(go.Shape,{name:"BeginArrow",visible:!1,margin:0,alignment:new go.Spot(0,.5,10,0),alignmentFocus:go.Spot.Right,geometryString:"M 0,-4 l -8,4 8,4",strokeCap:"round",fill:"black",width:10,height:15,strokeWidth:3,stroke:"black"},new go.Binding("fill","stroke",function(e){return e}),new go.Binding("stroke","stroke").makeTwoWay(function(e){return e}),new go.Binding("strokeWidth","strokeWidth").makeTwoWay(function(e){return e}),new go.Binding("visible","showBeginArrow")),o(go.Shape,{name:"EndArrow",visible:!1,margin:0,alignment:new go.Spot(1,.5,0,0),alignmentFocus:go.Spot.Right,geometryString:"M 0,-4 l 8,4 -8,4",strokeCap:"round",fill:"black",width:10,height:15,strokeWidth:3,stroke:"black"},new go.Binding("fill","stroke",function(e){return e}),new go.Binding("stroke","stroke").makeTwoWay(function(e){return e}),new go.Binding("strokeWidth","strokeWidth").makeTwoWay(function(e){return e}),new go.Binding("visible","showEndArrow")),o(go.Shape,{name:"Arrow",visible:!0,margin:0,alignment:new go.Spot(1,.5,5,0),alignmentFocus:go.Spot.Right,geometryString:"F M 158,-4 l 8,4 -8,4 2,-4 z",strokeCap:"round",fill:"black",width:20,height:15,strokeWidth:3,stroke:"black"},new go.Binding("fill","stroke",function(e){return e}),new go.Binding("stroke","stroke").makeTwoWay(function(e){return e}),new go.Binding("strokeWidth","strokeWidth").makeTwoWay(function(e){return e}),new go.Binding("visible","showArrow")))}},function(e,t,a){"use strict";function o(e,t){return go.Geometry.parse("M 0,80 A100,80 0 1 1 200,80")}function n(e,t){var a=go.Geometry.parse("M 0,80 A100,80 0 1 0 200,80");return t.isGeometryPositioned=!0,t.position=new go.Point(-100,-100),a}function r(e){var t=e.diagram;t.startTransaction();var a={text:"双击编辑文本",category:"text"};a.loc=go.Point.stringify(t.lastInput.documentPoint),t.model.addNodeData(a),t.commitTransaction()}var i=go.GraphObject.make;a(9);e.exports=function(e){return i(go.Node,"Spot",{name:"NODE",_controlExpand:!0,layerName:"Background",locationSpot:go.Spot.Center,locationObjectName:"BACKGROUND",resizable:!0,resizeObjectName:"BACKGROUND",rotatable:!0,rotateObjectName:"BACKGROUND",click:function(e,t){},doubleClick:function(e,t){r(e)},selectable:!0,movable:!0,angle:0,layoutConditions:go.Part.LayoutStandard&go.Part.LayoutNodeSized&go.Part.LayoutAdded&go.Part.LayoutNodeSized,alignment:go.Spot.Center,alignmentFocus:go.Spot.Center,resizeAdornmentTemplate:e.__trtd.nodeResizeAdornmentTemplate(),contextMenu:e.__trtd.getNodeContextMenu()},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),i(go.Shape,"Rectangle",{name:"BACKGROUND",fill:"rgba(1,1,1,0)",angle:0,stroke:"rgba(1,1,1,1)"},new go.Binding("desiredSize","desiredSize",function(e,t){return go.Size.parse(e)}).makeTwoWay(function(e){return go.Size.stringify(e)})),i(go.Shape,{name:"UP",stroke:"blue",position:new go.Point(0,0),isGeometryPositioned:!0,alignment:go.Spot.Center,stretch:go.GraphObject.Fill},new go.Binding("geometry","",o),new go.Binding("stroke","stroke1").makeTwoWay(function(e){return e}),new go.Binding("strokeWidth","strokeWidth").makeTwoWay(function(e){return e})),i(go.Shape,{name:"DOWN",stroke:"red",alignment:go.Spot.Center,strokeDashArray:[10,10],isGeometryPositioned:!0,position:new go.Point(-100,-100),stretch:go.GraphObject.Fill},new go.Binding("geometry","",n),new go.Binding("stroke","stroke2").makeTwoWay(function(e){return e}),new go.Binding("strokeWidth","strokeWidth").makeTwoWay(function(e){return e})))}},function(e,t,a){"use strict";function o(){go.RotatingTool.call(this),this._initialInfo=null,this._rotatePoint=new go.Point,this.handleAngle=0,this.handleArchetype=r(go.Panel,"Auto",r(go.Shape,"BpmnActivityLoop",{width:30,height:30,stroke:"green",fill:"transparent"}),r(go.Shape,"Rectangle",{width:30,height:30,stroke:"green",fill:"transparent",strokeWidth:0}))}function n(e,t,a){this.relativeLocation=e,this.centerLocationOffset=t,this.rotationAngle=a}var r=go.GraphObject.make;go.Diagram.inherit(o,go.RotatingTool),o.prototype.doActivate=function(){go.RotatingTool.prototype.doActivate.call(this);var e=this.adornedObject.part;if(e instanceof go.Group&&"waveGroup"==e.data.category){this._rotatePoint=e.location;var t=new go.Map(go.Part,n),a=e.data.textAngle||"vertical";this.walkTree(e,t,a),this._initialInfo=t}},o.prototype.walkTree=function(e,t,a){if(!(null===e||e instanceof go.Link||"horizontal"==a&&(console.log("textAngle"),"autoText"==e.data.category))){var o=e.locationObject.getDocumentPoint(go.Spot.Center),r=o.copy().subtract(e.location),i=o.subtract(this._rotatePoint);if(t.add(e,new n(i,r,e.rotateObject.angle)),e instanceof go.Group)for(var d=e.memberParts.iterator;d.next();)this.walkTree(d.value,t,a)}},o.prototype.rotate=function(e){console.log("newangle",e);var t=this.adornedObject.part;if(t instanceof go.Group&&((e+360)%360<300||(e+360)%360>340)&&((e+360)%360<300&&(e=300),(e+360)%360>340&&(e=340),console.log("dayu.................")),go.RotatingTool.prototype.rotate.call(this,e),t instanceof go.Group){var a=e-this.originalAngle,o=this._rotatePoint;t.diagram.startTransaction();for(var n=this._initialInfo.iterator;n.next();){var r=n.key;if(r instanceof go.Link)return;var i=n.value,d=i.rotationAngle+a,l=o.copy().add(i.relativeLocation),c=o.directionPoint(l),s=(a+c)*(Math.PI/180),g=i.centerLocationOffset.copy();g.rotate(a);var u=Math.sqrt(o.distanceSquaredPoint(l)),p=new go.Point(o.x+u*Math.cos(s),o.y+u*Math.sin(s)).subtract(g);t.diagram.model.setDataProperty(r.data,"loc",go.Point.stringify(p)),t.diagram.model.setDataProperty(r.data,"angle",d),console.log("isValidLayoutisValidLayout"),t.layout.isOngoing=!0,t.layout.isValidLayout=!1,t.containingGroup&&(t.containingGroup.layout.isOngoing=!0,t.containingGroup.layout.isValidLayout=!1),t.diagram.commitTransaction()}}},e.exports=o},function(e,t,a){"use strict";!function(e){var t=document.createElement("textarea");t.id="myTextArea",console.log("TextEditorTextEditorTextEditorTextEditorTextEditorTextEditorTextEditorTextEditorTextEditorTextEditorTextEditorTextEditor222222222222"),t.addEventListener("input",function(e){var t=a.tool;if(null!==t.textBlock){var o=t.measureTemporaryTextBlock(this.value),n=this.textScale;this.style.width=20+o.measuredBounds.width*n+"px",this.rows=o.lineCount}},!1),t.addEventListener("keydown",function(e){var t=a.tool;if(null!==t.textBlock){var o=e.which;return 13===o?(!1===t.textBlock.isMultiline&&e.preventDefault(),void t.acceptText(go.TextEditingTool.Enter)):9===o?(t.acceptText(go.TextEditingTool.Tab),void e.preventDefault()):void(27===o&&(t.doCancel(),null!==t.diagram&&t.diagram.doFocus()))}},!1),t.addEventListener("focus",function(e){var o=a.tool;o&&null!==o.currentTextEditor&&(o.state===go.TextEditingTool.StateActive&&(o.state=go.TextEditingTool.StateEditing),o.selectsTextOnActivate&&(t.select(),t.setSelectionRange(0,9999)))},!1),t.addEventListener("blur",function(e){var o=a.tool;o&&null!==o.currentTextEditor&&o.state!==go.TextEditingTool.StateNone&&(t.focus(),o.selectsTextOnActivate&&(t.select(),t.setSelectionRange(0,9999)))},!1);var a=new go.HTMLInfo;a.valueFunction=function(){return t.value},a.mainElement=t,a.show=function(e,o,n){if(console.log("show......................."),e instanceof go.TextBlock){if(a.tool=n,n.state===go.TextEditingTool.StateInvalid)return t.style.border="3px solid red",void t.focus();var r=e.getDocumentPoint(go.Spot.Center),i=o.position,d=o.scale,l=e.getDocumentScale()*d;l<n.minimumEditorScale&&(l=n.minimumEditorScale);var c=e.naturalBounds.width*l+6,s=e.naturalBounds.height*l+2,g=(r.x-i.x)*d,u=(r.y-i.y)*d;t.value=e.text,o.div.style.font=e.font;t.style.position="absolute",t.style.zIndex="100",t.style.font="inherit",t.style.fontSize=100*l+"%",t.style.lineHeight="normal",t.style.width=c+"px",t.style.left=(g-c/2|0)-1+"px",t.style.top=(u-s/2|0)-1+"px",t.style.textAlign=e.textAlign,t.style.margin="0",t.style.padding="1px",t.style.border="0",t.style.outline="none",t.style.whiteSpace="pre-wrap",t.style.overflow="hidden",t.rows=e.lineCount,t.textScale=l,t.className="goTXarea",o.div.appendChild(t),t.focus(),n.selectsTextOnActivate&&(t.select(),t.setSelectionRange(0,9999))}},a.hide=function(e,o){e.div.removeChild(t),a.tool=null},e.TextEditor=a}(window)}])});